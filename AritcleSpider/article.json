{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/4a1407530d4f2086a8ce08b899773549.jpg"], "url_object_id": "c2031fdb29548112c91025f9bbba3f1f", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.phoronix.com/scan.php?page=news_item&amp;px=Solaris-2017-Look-Back\">Michael Larabel</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8803-1.html\">Linux中国/MonkeyDEcho</a>   </div><p>现在看来，Oracle 公司正在通过取消 Solaris 12 而终止 Solaris 的功能开发，这里我们要回顾下多年来在 Phoronix 上最受欢迎的 Solaris 重大事件和新闻。</p>\n<p>这里有许多关于 Solaris 的有趣／重要的回忆。<img src=\"../../upload/2017_08/170823192136556.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><img class=\"alignnone size-full wp-image-112270\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/93e6343916d6c39535b8e3d60d32842b.jpg\" alt=\"170823192136556\"></p>\n<p>在 Sun Microsystems 时期，我真的对 Solaris 很感兴趣。在 Phoronix 上我们一直重点关注 Linux 的同时，经常也有 Solaris 的文章出现。 Solaris 玩起来很有趣，OpenSolaris／SXCE 是伟大的产物，我将 Phoronix 测试套件移植到 Solaris 上，我们与 Sun Microsystems 人员有密切的联系，也出现在 Sun 的许多活动中。</p>\n<p style=\"text-align: center\"><img class=\"alignnone size-full wp-image-112271\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/1cd3d84a19148210405ea50c5cb700d6.jpg\" alt=\"170823192136551\"></p>\n<p style=\"text-align: center\"><em>在那些日子里 Sun 有一些相当独特的活动…</em></p>\n<p>不幸的是，自从 Oracle 公司收购了 Sun 公司， Solaris 就如坠入深渊一样。最大的打击大概是 Oracle 结束了 OpenSolaris ，并将所有 Solaris 的工作转移到专有模式…<img src=\"../../upload/2017_08/170823192136552.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><img class=\"alignnone size-full wp-image-112272\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8f35c72754a3ff32e7d0a0bbc13f3000.jpg\" alt=\"170823192136552\"></p>\n<p>在 Sun 时代的 Solaris 有很多美好的回忆，所以 Oracle 在其计划中抹去了 Solaris 12 之后，我经常在 Phoronix 上翻回去看一些之前 Solaris 的经典文章，期待着能从 Oracle 听到 “Solaris 11” 下一代的消息，重启 Solaris 项目的开发。</p>\n<p style=\"text-align: center\"><img src=\"../../upload/2017_08/170823192136553.jpg\" alt=\"\"><img class=\"alignnone size-full wp-image-112273\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/afbcf1ab8db3a502f127d7208a1ffd08.jpg\" alt=\"170823192136553\"></p>\n<p>虽然在后 Solaris 的世界中，看到 Oracle 对 ZFS 所做的事情以及他们在基于 RHEL 的 Oracle Enterprise Linux 上下的重注将会很有趣，但时间将会告诉我们一切。</p>\n<p style=\"text-align: center\"><img src=\"../../upload/2017_08/170823192136554.jpg\" alt=\"\"><img class=\"alignnone size-full wp-image-112274\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8fef927af40aa7f7db5a27dc2d0be68c.jpg\" alt=\"170823192136554\"></p>\n<p>无论如何，这是回顾自 2004 年以来我们最受欢迎的 Solaris 文章：</p>\n<h4 id=\"toc_1\">2016/12/1 Oracle 或许会罐藏 Solaris</h4>\n<p>Oracle 可能正在拔掉 Solaris 的电源插头，据一些新的传闻说。</p>\n<h4 id=\"toc_2\">2013/6/9 OpenSXCE 2013.05 拯救 Solaris 社区</h4>\n<p>作为 Solaris 社区版的社区复兴，OpenSXCE 2013.05 出现在网上。</p>\n<h4 id=\"toc_3\">2013/2/2 Solaris 12 可能最终带来 Radeon KMS 驱动程序</h4>\n<p>看起来，Oracle 可能正在准备发布自己的 AMD Radeon 内核模式设置（KMS）驱动程序，并引入到 Oracle Solaris 12 中。</p>\n<h4 id=\"toc_4\">2012/10/4 Oracle Solaris 11.1 提供 300 个以上增强功能</h4>\n<p>Oracle昨天在旧金山的 Oracle OpenWorld 会议上发布了 Solaris 11.1 。</p>\n<p style=\"text-align: center\"><img src=\"../../upload/2017_08/170823192136555.jpg\" alt=\"\"><img class=\"alignnone size-full wp-image-112275\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a1407530d4f2086a8ce08b899773549.jpg\" alt=\"170823192136555\"></p>\n<h4 id=\"toc_5\">2012/1/9 Oracle 尚未澄清 Solaris 11 内核来源</h4>\n<p>一个月前，Phoronix 是第一个注意到 Solaris 11 内核源代码通过 Torrent 站点泄漏到网上的信息。一个月后，甲骨文还没有正式评论这个情况。</p>\n<h4 id=\"toc_6\">2011/12/19 Oracle Solaris 11 内核源代码泄漏</h4>\n<p>似乎 Solaris 11的内核源代码在过去的一个周末被泄露到了网上。</p>\n<h4 id=\"toc_7\">2011/8/25 对于 BSD，Solaris 的 GPU 驱动程序的悲惨状态</h4>\n<p>昨天在邮件列表上出现了关于干掉所有旧式 Mesa 驱动程序的讨论。这些旧驱动程序没有被积极维护，支持复古的图形处理器，并且没有更新支持新的 Mesa 功能。英特尔和其他开发人员正在努力清理 Mesa 核心，以将来增强这一开源图形库。这种清理 Mesa，对 BSD 和 Solaris 用户也有一些影响。</p>\n<h4 id=\"toc_8\">2010/8/13 告别 OpenSolaris，Oracle 刚刚把它干掉</h4>\n<p>Oracle 终于宣布了他们对 Solaris 操作系统和 OpenSolaris 平台的计划，而且不是好消息。OpenSolaris 将实际死亡，未来将不会有更多的 Solaris 版本出现 – 包括长期延期的 2010 年版本。Solaris 仍然会继续存在，现在 Oracle 正在忙于明年发布的 Solaris 11，但仅在 Oracle 的企业版之后才会发布 “Solaris 11 Express” 作为 OpenSolaris 的类似产品。</p>\n<h4 id=\"toc_9\">2010/2/22 Oracle 仍然要对 OpenSolaris 进行更改</h4>\n<p>自从 Oracle 完成对 Sun Microsystems 的收购以来，已经有了许多变化，这个 Sun 最初支持的开源项目现在已经不再被 Oracle 支持，并且对其余的开源产品进行了重大改变。 Oracle 表现出并不太开放的意图的开源项目之一是 OpenSolaris 。 Solaris Express 社区版（SXCE）上个月已经关闭，并且也没有预计 3 月份发布的下一个 OpenSolaris 版本（OpenSolaris 2010.03）的信息流出。</p>\n<h4 id=\"toc_10\">2007/9/10 Solaris Express 社区版 Build 72</h4>\n<p>对于那些想要在 “印第安纳项目” 发布之前尝试 OpenSolaris 软件中最新最好的软件的人来说，现在可以使用 Solaris Express 社区版 Build 72。Solaris Express 社区版（SXCE）Build 72 可以从 OpenSolaris.org 下载。同时，预计将在下个月推出 Sun 的 “印第安纳项目” 项目的预览版。</p>\n<h4 id=\"toc_11\">2007/9/6 ATI R500/600 驱动要支持 Solaris 了?</h4>\n<p>虽然没有可用于 Solaris/OpenSolaris 或 * BSD 的 ATI fglrx 驱动程序，现在 AMD 将向 X.Org 开发人员和开源驱动程序交付规范，但对于任何使用 ATI 的 Radeon X1000 “R500” 或者 HD 2000“R600” 系列的 Solaris 用户来说，这肯定是有希望的。将于下周发布的开源 X.Org 驱动程序距离成熟尚远，但应该能够相对容易地移植到使用 X.Org 的 Solaris 和其他操作系统上。 AMD 今天宣布的针对的是 Linux 社区，但它也可以帮助使用 ATI 硬件的 Solaris/OpenSolaris 用户。特别是随着印第安纳项目的即将推出，开源 R500/600 驱动程序移植就只是时间问题了。</p>\n<h4 id=\"toc_12\">2007/9/5 Solaris Express 社区版 Build 71</h4>\n<p>Solaris Express 社区版（SXCE）现已推出 Build 71。您可以在 OpenSolaris.org 中找到有关 Solaris Express 社区版 Build 71 的更多信息。另外，在 Linux 内核峰会上，AMD 将提供 GPU 规格的消息，由此产生的 X.Org 驱动程序将来可能会导致 ATI 硬件上 Solaris/OpenSolaris 有所改善。</p>\n<h4 id=\"toc_13\">2007/8/27 Linux 的 Solaris 容器</h4>\n<p>Sun Microsystems 已经宣布，他们将很快支持适用于 Linux 应用程序的 Solaris 容器。这样可以在 Solaris 下运行 Linux 应用程序，而无需对二进制包进行任何修改。适用于 Linux 的 Solaris 容器将允许从 Linux 到 Solaris 的平滑迁移，协助跨平台开发以及其他优势。当该支持到来时，这个时代就“快到了”。</p>\n<h4 id=\"toc_14\">2007/8/23 OpenSolaris 开发者峰会</h4>\n<p>今天早些时候在 OpenSolaris 论坛上发布了第一次 OpenSolaris 开发人员峰会的消息。这次峰会将在十月份在加州大学圣克鲁斯分校举行。 Sara Dornsife 将这次峰会描述为“不是与演示文稿或参展商举行会议，而是一个亲自参与的协作工作会议，以计划下一期的印第安纳项目。” 伊恩·默多克（Ian Murdock） 将在这个“印第安纳项目”中进行主题演讲，但除此之外，该计划仍在计划之中。 Phoronix 可能会继续跟踪此事件，您可以在 Solaris 论坛上讨论此次峰会。</p>\n<h4 id=\"toc_15\">2007/8/18 Solaris Express 社区版 Build 70</h4>\n<p>名叫 “Nevada” 的 Solaris Express 社区版 Build 70 (SXCE snv_70) 现在已经发布。有关下载链接的通知可以在 OpenSolaris 论坛中找到。还有公布了其网络存储的 Build 71 版本，包括来自 Qlogic 的光纤通道 HBA 驱动程序的源代码。</p>\n<h4 id=\"toc_16\">2007/8/16 IBM 使用 Sun Solaris 的系统</h4>\n<p>Sun Microsystems 和 IBM正在举行电话会议，他们刚刚宣布，IBM 将开始在服务器上使用 Sun 的 Solaris 操作系统。这些 IBM 服务器包括基于 x86 的服务器系统以及 Blade Center 服务器。官方新闻稿刚刚发布，可以在 sun 新闻室阅读。</p>\n<h4 id=\"toc_17\">2007/8/9 OpenSolaris 不会与 Linux 合并</h4>\n<p>在旧金山的 LinuxWorld 2007 上，Andrew Morton 在主题演讲中表示， OpenSolaris 的关键组件不会出现在 Linux 内核中。事实上，莫顿甚至表示 “非常遗憾 OpenSolaris 活着”。OpenSolaris 的一些关键组件包�� Zones、ZFS 和 DTrace 。虽然印第安纳州项目有可能将这些项目转变为 GPLv3 项目… 更多信息参见 ZDNET。</p>\n<h4 id=\"toc_18\">2007/7/27 Solaris Xen 已经更新</h4>\n<p>已经有一段时间了，Solaris Xen 终于更新了。约翰·莱文（John Levon）表示，这一最新版本基于 Xen 3.0.4 和 Solaris “Nevada” Build 66。这一最新版本的改进包括 PAE 支持、HVM 支持、新的 virt-manager 工具、改进的调试支持以及管理域支持。可以在 Sun 的网站上找到 2007 年 7 月 Solaris Xen 更新的下载。</p>\n<h4 id=\"toc_19\">2007/7/25 Solaris 10 7/07 HW 版本</h4>\n<p>Solaris 10 7/07 HW 版本的文档已经上线。如 Solaris 发行注记中所述，Solaris 10 7/07 仅适用于 SPARC Enterprise M4000-M9000 服务器，并且没有 x86/x64 版本可用。所有平台的最新 Solaris 更新是 Solaris 10 11/06 。您可以在 Phoronix 论坛中讨论 Solaris 7/07。</p>\n<h4 id=\"toc_20\">2007/7/16 来自英特尔的 Solaris 电信服务器</h4>\n<p>今天宣布推出符合 NEBS、ETSI 和 ATCA 合规性的英特尔体系的 Sun Solaris 电信机架服务器和刀片服务器。在这些新的运营商级平台中，英特尔运营商级机架式服务器 TIGW1U 支持 Linux 和 Solaris 10，而 Intel NetStructure MPCBL0050 SBC 也将支持这两种操作系统。今天的新闻稿可以在这里阅读。</p>\n<p>然后是 Solaris 分类中最受欢迎的特色文章：</p>\n<h4 id=\"toc_21\">Ubuntu vs. OpenSolaris vs. FreeBSD 基准测试</h4>\n<p>在过去的几个星期里，我们提供了几篇关于 Ubuntu Linux 性能的深入文章。我们已经开始提供 Ubuntu 7.04 到 8.10 的基准测试，并且发现这款受欢迎的 Linux 发行版的性能随着时间的推移而变慢，随之而来的是 Mac OS X 10.5 对比 Ubuntu 8.10 的基准测试和其他文章。在本文中，我们正在比较 Ubuntu 8.10 的 64 位性能与 OpenSolaris 2008.11 和 FreeBSD 7.1 的最新测试版本。</p>\n<h4 id=\"toc_22\">NVIDIA 的性能：Windows vs. Linux vs. Solaris</h4>\n<p>本周早些时候，我们预览了 Quadro FX1700，它是 NVIDIA 的中端工作站显卡之一，基于 G84GL 内核，而 G84GL 内核又源于消费级 GeForce 8600 系列。该 PCI Express 显卡提供 512MB 的视频内存，具有两个双链路 DVI 连接，并支持 OpenGL 2.1 ，同时保持最大功耗仅为 42 瓦。正如我们在预览文章中提到的，我们将不仅在 Linux 下查看此显卡的性能，还要在 Microsoft Windows 和 Sun 的 Solaris 中测试此工作站解决方案。在今天的这篇文章中，我们正在这样做，因为我们测试了 NVIDIA Quadro FX1700 512MB 与这些操作系统及其各自的二进制显示驱动程序。</p>\n<h4 id=\"toc_23\">FreeBSD 8.0 对比 Linux、OpenSolaris</h4>\n<p>在 FreeBSD 8.0 的稳定版本发布的上周，我们终于可以把它放在测试台上，并用 Phoronix 测试套件进行了全面的了解。我们将 FreeBSD 8.0 的性能与早期的 FreeBSD 7.2 版本以及 Fedora 12 和 Ubuntu 9.10 还有 Sun OS 端的 OpenSolaris 2010.02 b127 快照进行了比较。</p>\n<h4 id=\"toc_24\">Fedora、Debian、FreeBSD、OpenBSD、OpenSolaris 基准测试</h4>\n<p>上周我们发布了第一个 Debian GNU/kFreeBSD 基准测试，将 FreeBSD 内核捆绑在 Debian GNU 用户的 Debian GNU/Linux 上，比较了这款 Debian 系统的 32 位和 64 位性能。 我们现在扩展了这个比较，使许多其他操作系统与 Debian GNU/Linux 和 Debian GNU/kFreeBSD 的 6.0 Squeeze 快照直接进行比较，如 Fedora 12，FreeBSD 7.2，FreeBSD 8.0，OpenBSD 4.6 和 OpenSolaris 2009.06 。</p>\n<h4 id=\"toc_25\">AMD 上海皓龙：Linux vs. OpenSolaris 基准测试</h4>\n<p>1月份，当我们研究了四款皓龙 2384 型号时，我们在 Linux 上发布了关于 AMD 上海皓龙 CPU 的综述。与早期的 AMD 巴塞罗那处理器 Ubuntu Linux 相比，这些 45nm 四核工作站服务器处理器的性能非常好，但是在运行 Sun OpenSolaris 操作系统时，性能如何？今天浏览的是 AMD 双核的基准测试，运行 OpenSolaris 2008.11、Ubuntu 8.10 和即将推出的 Ubuntu 9.04 版本。</p>\n<h4 id=\"toc_26\">OpenSolaris vs. Linux 内核基准</h4>\n<p>本周早些时候，我们提供了 Ubuntu 9.04 与 Mac OS X 10.5.6 的基准测试，发现 Leopard 操作系统（Mac）在大多数测试中的表现要优于 Jaunty Jackalope （Ubuntu），至少在 Ubuntu 32 位是这样的。我们今天又回过来进行更多的操作系统基准测试，但这次我们正在比较 Linux 和 Sun OpenSolaris 内核的性能。我们使用的 Nexenta Core 2 操作系统将 OpenSolaris 内核与 GNU/Ubuntu 用户界面组合在同一个 Ubuntu 软件包中，但使用了 Linux 内核的 32 位和 64 位 Ubuntu 服务器安装进行测试。</p>\n<h4 id=\"toc_27\">Netbook 性能：Ubuntu vs. OpenSolaris</h4>\n<p>过去，我们已经发布了 OpenSolaris vs. Linux Kernel 基准测试以及类似的文章，关注 Sun 的 OpenSolaris 与流行的 Linux 发行版的性能。我们已经看过高端 AMD 工作站的性能，但是我们从来没有比较上网本上的 OpenSolaris 和 Linux 性能。直到今天，在本文中，我们将比较戴尔 Inspiron Mini 9 上网本上的 OpenSolaris 2009.06 和 Ubuntu 9.04 的结果。</p>\n<h4 id=\"toc_28\">NVIDIA 图形：Linux vs. Solaris</h4>\n<p>在 Phoronix，我们不断探索 Linux 下的不同显示驱动程序，在我们评估了 Sun 的检查工具并测试了 Solaris 主板以及覆盖其他几个领域之后，我们还没有执行图形驱动程序 Linux 和 Solaris 之间的比较。直到今天。由于印第安纳州项目，我们对 Solaris 更感兴趣，我们决定终于通过 NVIDIA 专有驱动程序提供我们在 Linux 和 Solaris 之间的第一次定量图形比较。</p>\n<h4 id=\"toc_29\">OpenSolaris 2008.05 向 Solaris 提供了一个新面孔</h4>\n<p>2月初，Sun Microsystems 发布了印第安纳项目的第二个预览版本。对于那些人来说，印第安纳州项目是 Sun 的 Ian Murdock 领导的项目的代号，旨在通过解决 Solaris 的长期可用性问题，将 OpenSolaris 推向更多的台式机和笔记本电脑。我们没有对预览 2 留下什么深刻印象，因为它没有比普通用户感兴趣的 GNU/Linux 桌面更有优势。然而，随着 5 月份推出的 OpenSolaris 2008.05 印第安纳项目发布，Sun Microsystems 今天发布了该操作系统的最终测试副本。当最后看到项目印第安纳时， 我们对这个新的 OpenSolaris 版本的最初体验是远远优于我们不到三月前的体验的。</p>\n<h4 id=\"toc_30\">快速概览 Oracle Solaris 11</h4>\n<p>Solaris 11 在周三发布，是七年来这个前 Sun 操作系统的第一个主要更新。在过去七年中，Solaris 家族发生了很大变化，OpenSolaris 在那个时候已经到来，但在本文中，简要介绍了全新的 Oracle Solaris 11 版本。</p>\n<h4 id=\"toc_31\">OpenSolaris、BSD &amp; Linux 的新基准测试</h4>\n<p>今天早些时候，我们对以原生的内核模块支持的 Linux 上的 ZFS 进行了基准测试，该原生模块将被公开提供，以将这个 Sun/Oracle 文件系统覆盖到更多的 Linux 用户。现在，尽管作为一个附加奖励，我们碰巧有了基于 OpenSolaris 的最新发行版的新基准，包括 OpenSolaris、OpenIndiana 和 Augustiner-Schweinshaxe，与 PC-BSD、Fedora 和 Ubuntu相比。</p>\n<h4 id=\"toc_32\">FreeBSD/PC-BSD 9.1 针对 Linux、Solaris、BSD 的基准</h4>\n<p>虽然 FreeBSD 9.1 尚未正式发布，但是基于 FreeBSD 的 PC-BSD 9.1 “Isotope”版本本月已经可用。本文中的性能指标是 64 位版本的 PC-BSD 9.1 与 DragonFlyBSD 3.0.3、Oracle Solaris Express 11.1、CentOS 6.3、Ubuntu 12.10 以及 Ubuntu 13.04 开发快照的比较。</p>\n<hr>\n<p>作者简介：</p>\n<p>Michael Larabel 是 Phoronix.com 的作者，并于 2004 年创立了该网站，该网站重点是丰富多样的 Linux 硬件体验。 Michael 撰写了超过10,000 篇文章，涵盖了 Linux 硬件支持，Linux 性能，图形驱动程序等主题。 Michael 也是 Phoronix 测试套件、 Phoromatic 和 OpenBenchmarking.org 自动化基准测试软件的主要开发人员。可以通过 Twitter 关注他或通过 MichaelLarabel.com 联系他。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112268\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112268votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112268\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/25", "fav_nums": 0, "tags": "IT技术,Linux", "url": "http://blog.jobbole.com/112268/", "front_image_path": "full/25c01fba3f23ba887baf904514a2ccb08fc515e4.jpg", "praise_nums": "1", "title": "一个时代的结束：Solaris 系统的那些年，那些事", "comment_nums": 0}
{"front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/08/CPU-2-1024x571.jpg"], "url_object_id": "8ca27b6e450717e1a86cd115d118ba44", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>对计算机来讲，所谓的计算，不过是将存储在各个地方的数据通过数据总线进行传输，然后经过算术逻辑单元执行一系列预设好的规则，最终再将输出写入到某个位置。</p>\n<p>在计算能力有限、存储成本偏高的情况下，就需要利用好计算机的资源，让它的计算能力发挥出最大的价值，所以在编程初期用指令直接操作硬件，例如汇编语言中常见的操纵寄存器，本质上都是为了减少数据传输的时间，充分利用CPU的计算能力，避免因为数据的长时间传输导致CPU进行过长的等待。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/CPU-2.jpg\"><img class=\"aligncenter size-large wp-image-5162\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/CPU-2-1024x571.jpg\" alt=\"\" width=\"700\" height=\"390\"></a></p>\n<h3>分布式计算的到来</h3>\n<p>随着科技的发展，“数据存储”领域有了质和量的双向发展，除了稳定性、安全性的提升外，容量也呈指数级增长。因此可以在单机上直接构建整套服务，类似LAMP类似的这种一键搭建服务器的套装软件有了更多的应用场景。</p>\n<p>然而随着业务的发展，另一个问题逐渐显现出来：虽然磁盘容量增加了，但是机器的访问速度并没有变快。</p>\n<p>什么意思呢？举个例子：虽然20年前一个盘最大的存储空间只有100MB，但是读取完整磁盘只需要1分钟。如今虽然磁盘容量可以轻易的变成1TB、1PB，然而读取完整个盘的数据需要数小时之上。</p>\n<p>这背后的问题在于技术发展的限制：磁头在磁道上移动速度的增速远远低于磁盘容量的增长。用通俗的话来说就是，仓库的面积已经从10平米扩展到100平米甚至到1000平米了，但是一个搬运工一天搬运货物的速度并没有显著的提升，所以虽然仓库的容量越来越大，但是搬完整个仓库的货物需要的时间却越来越多。</p>\n<p>不过好在我们还有另一个好消息：带宽逐渐变得廉价。相比20年前，GB带宽的光纤已经非常普遍，网络能够实现一秒传输，数据量已经远远超过了整块盘的容量。于是一个大胆的想法被提出来了：既然读取完一个盘的数据需要几个小时，那把数据分成N份，分别放在不同的机器上并行读取，是不是一秒钟就读取完了？</p>\n<p>采用网络并行的方式进行读取，将瓶颈从磁头移动转移到了网络，而要增加一条高速带宽，已经不需要付出多么大的代价。</p>\n<p>还是仓库的例子，既然一个搬运工速度这么慢，搬完1000平米仓库需要1000分钟，那么我用1000个搬运工搬1000平米是不是1分钟就完了？这个时候影响搬运工的，仅仅是大门的大小，需要同时容纳1000个搬运工进出而已，但是开个大门似乎成本并不高，大不了把四面的墙都拆了做成门嘛。</p>\n<h3>MR一代</h3>\n<p>一个优秀的思想被提出来后，总会有许多追随者尝试将其落地，Google率先丢出了三大论文：BigTable、GFS、MapReduce，从理论上讲述了在分布式下如何做到数据的存储、计算，甚至提出了可以在分布式下做结构化的检索。</p>\n<p>三大论文开启了分布式计算的时代，然而对于工程界来说，仅有三篇论文并不足以解决生产上的问题，Google并没有将内部实现的内容进行开源，于是另一帮团队：Yahoo，自行根据论文进行实现，而后将其贡献给Apache，逐渐发展成时至今日依旧如日中天的：HDFS、Mapreduce、HBase。</p>\n<p>其中尤为重要的分布式计算模型：MapReuce，我们常称为第一代MR，也就是：MRV1。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1.png\"><img class=\"aligncenter size-large wp-image-5150\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1-1024x485.png\" alt=\"\" width=\"700\" height=\"332\"></a></p>\n<p>上图是MRV1的主要架构图，我们可以看到，在MRV1里面，主要分为两个部分：运行环境和编程模型，所谓的运行环境，指的是用来进行分布式任务调度、资源分配等任务运行过程中涉及到的信息，而编程模型，则指的是提供给开发人员进行开发的接口。</p>\n<p>对于MRV1来说，它的运行结构图如下所示：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MapReuce.png\"><img class=\"aligncenter size-large wp-image-5151\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MapReuce-1024x514.png\" alt=\"\" width=\"700\" height=\"351\"></a></p>\n<p>可以看到，在MRV1里面，当我们的一个任务被提交上去之后，由统一的调度器进行任务的监控、分发，以及资源的申请、回收控制等操作。</p>\n<p>MRV1有着明显的两个阶段：Map和Reduce，Map阶段主要负责处理输入，每一个Map任务对应一个分片的数据，而后将数据送入到一个特有的数据结构：环形缓冲区。所谓的环形缓冲区，是用来记录数据和索引的一个区域。当环形缓冲区快要溢出的时候，数据将会被落地到磁盘。在数据输入完成后，将会调用用户自己实现的map函数，而后通过与jobtracker的通信，保持着联系，然后分别进入到reduce的阶段，renduce阶段会汇集所有的数据，这个动作在广义上会被很多人称为：shuffle。实际上shuffle并不是reduce才发生的，对于MR来说，从数据从HDFS上加载开始，shuffle就已经开始了，一直伴随到reduce结束。</p>\n<p>MRV1类似于工厂生产辣椒酱，很多工人负责把流水线送到自己身边的辣椒切碎，这个就是Map操作，所有工人切碎的辣椒汇集在一起做成辣椒酱，这个就是Reduce操作。也许某个工人把辣椒切成块的速度赶不上流水线送给他辣椒的速度，那么他就需要把辣椒从流水线拿下来放在他的自己的某个地方存着慢慢切，这个动作就相当于shuffle操作。因为最后汇总会等到所有的人都把辣椒切成块之后再处理，所以如果有一个人没有完成，就需要等待，这个时候就发生了我们常说的，数据倾斜。</p>\n<h3>MR二代</h3>\n<p>MRV1是统一管理资源的，类似于一家公司的所有决策都需要通过CEO来发出指令，所有人都听命于CEO，每个人做什么事全都是CEO一一安排，所以如果CEO忙不过来了，或者有事联系不上了，整个组织就成了无头苍蝇、完蛋了。</p>\n<p>因此对于MRV1来说，虽然它实现了一个并行计算模型，但是其暴露出来的问题也显而易见：</p>\n<ul>\n<li>固化的两阶段模式，限制了迭代任务的进行</li>\n<li>多次数据落地，整个运行时间大大延长</li>\n<li>所有任务由统一的jobtracker调度，存在单点故障。</li>\n<li>对资源的控制不到位，没有明确的任务优先级</li>\n<li>资源利用不合理，例如在V1里面，资源分为map solt和reduce solt，导致运行map的时候，reduce的solt全部闲置</li>\n<li>安全控制</li>\n</ul>\n<p>在这些问题逐渐暴露出来后，有很多补救的措施逐渐出现，例如Tez就是一个非常好的例子，它通过接管MRV1的输入和输出，减少其落地到磁盘的动作，目前Tez已经是Hive的内置计算模型。</p>\n<p>但是这些补救框架，并不能从根本上解决MRV1的问题，于是第二代MR被研究出来，也就是MRV2，那么对于MRV2来说，它是怎么做的呢？既然一个公司全靠CEO去安排任务和进行管理有风险，那么我们就把公司的所有人分成N个小团队，每个团队有自己的Lead负责进行工作安排，CEO干什么呢？CEO只负责把要做的事情丢给小团队的Lead，小团队的Lead自己去安排手下的人干活。</p>\n<p>大多数时候我们对MRV2这个名字并不熟悉，但是我们一定熟悉一个名字：Yarn。Yarn就是MRV2下最核心的功能。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV2.png\"><img class=\"aligncenter size-large wp-image-5152\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV2-1024x492.png\" alt=\"\" width=\"700\" height=\"336\"></a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Yarn.png\"><img class=\"aligncenter size-large wp-image-5164\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Yarn-1024x399.png\" alt=\"\" width=\"700\" height=\"273\"></a></p>\n<p>通过上面的图我们发现，对于MRV2来说，它的资源的申请、控制、回收，不再由统一的jobtracker（前面举例中的CEO）来调度了。在MRV2里面，它产生了几个新的概念：</p>\n<ul>\n<li>Resource Manager：负责统一管理所有资源</li>\n<li>Application Master：负责一个任务的监控、资源分配、回收等工作（前面例子中的小团队Lead）</li>\n<li>Node Manager：各个节点的资源监控</li>\n</ul>\n<p>这里面并没有提到Yarn，因为Yarn并不是一个技术，而是一个概念，代表V2里面整个任务调度和资源管理系统。我们合并起来统一称为：Yarn。</p>\n<p>我们可以对比一下MRV1和MRV2的机构图：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1-MRV2.png\"><img class=\"aligncenter size-large wp-image-5154\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1-MRV2-1024x455.png\" alt=\"\" width=\"700\" height=\"311\"></a></p>\n<p>在MRV2里面，依旧分为两个部分：运行环境和编程模型。然而不一样的地方在于，每一个应用程序需要实现自己的Application Master，也就是资源管理系统。Resource Manager进行一次统一的资源分配，由Application Master自己去决定怎么把资源分给每一个Task，在实际开发中，我们发现自己似乎并没有写过资源分配相关的代码，MR的代码依旧可以运行，那是因为MRV2里面，默认提供了MR的Application Master，在MRV2里面，API也发生了变化，而为了兼容MRV1，分别存在两套API。</p>\n<p>同时由于MRV2的超高思想，将整个资源调度独立出来，这带来一个好处，那就是Yarn不单单能调度MR计算引擎，还能调度其他计算引擎，例如Spark。虽然目前有Mesos，但是大多数情况下我们还是会选择采用Yarn去作为资源调度器。</p>\n<h3>Spark分布式计算模型</h3>\n<p>看起来似乎MRV2向前迈进了一大步，解决了不少问题，然而对于MRV2来说，依然存在它无法跨越的问题。首先为了兼容MR计算模型，它依然保留着两阶段计算的模型，因为对迭代计算基本乏力。MR模型就像一个工厂流水线要生产辣椒酱，要先把辣椒切碎，然后再汇集起来做成辣椒酱，固定的2步操作，如果想在切碎之前再做点啥，或者做成辣椒酱之后再贴个标签啥的，MR模型就支撑不了，因此“需要任意灵活的进行迭代”这一需求就出来了，这个就是Spark的特点。</p>\n<p>同时，MR的核心思想是：运行在廉价服务器上，挪数据，所以对于实时计算，MVR2基本抓瞎。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Spark.png\"><img class=\"aligncenter size-large wp-image-5153\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Spark-1024x475.png\" alt=\"\" width=\"700\" height=\"325\"></a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/RDD.png\"><img class=\"aligncenter size-large wp-image-5155\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/RDD-1024x493.png\" alt=\"\" width=\"700\" height=\"337\"></a></p>\n<p>在这些问题之上，Spark诞生。Spark的思想比较简单：挪计算不挪数据。既然要挪计算，那怎么去描述这个计算呢？于是通过RDD封装一个针对数据对应关系记录，在这个封装之上来记录计算。所以在Spark里面，操作分为两类：Action和Transformation。</p>\n<p>为什么会有这两类操作？我们可以想一下，如果数据被分散在100个阶段，我们需要做的是查询某个字段大于0的数据，那么这个计算根本不用把数据汇集在一起，统一过滤，分别在不同节点进行过滤就行了。</p>\n<p>而如果我们的操作是统计共有多少条数据，则需要将数据汇总，所以对于Spark来说，Action才真正会触发“挪数据”这个动作，Transformation只是做了一个标记转换。我们对Spark的各种调优，大部分时间也是在尽量减少Action的操作。由于在Spark里面，RDD是只读的，所以每一次操作，都会产生一个新的RDD，因此可以形成一系列的RDD依赖，我们也叫RDD链。</p>\n<h3>模型训练</h3>\n<p>模型训练更多的偏向于AI领域，在AI领域有两个明显的分支：概率论和神经网络。在计算能力欠缺的时候，概率论模型是最为普遍的做法，但是近年来发展起来的计算能力，让深度神经网络模型逐渐的展现出风采，很多框架都表明自己就是一个深度学习框架。</p>\n<p>模型训练本质上是对数据特征的提取，训练本身和大数据没有必然的关系，但是却相辅相成，数据量越大，提取的特征越多，模型训练出来的效果自然越好，然而数据量越大，对计算的要求就越高，也正因为如此，对模型的探索始终是在小数据、抽样领域进行尝试。</p>\n<p>那么什么是特征呢？举个例子，我们如果想要预测一个人能活多少岁，最简单的办法就是返回已知去世的人的平均年龄，无论是谁都返回这个值，要做这样的系统当然没有问题。但是仔细观察就会发现，男性能活多少岁和女性似乎不一样，那么我们可以简单的修改一下，在预测之前先判断一下性别，如果是男的就返回男的平均，女的则返回女性的平均。在这里我们已经无形的用了性别这个特征，是因为我们认为性别对结果是有影响的，而训练就需要找出无数个这样的特征。</p>\n<p>然而目前对于大数据的处理能力，似乎已经发展到了一个非常好的阶段，至少在分布式计算上，理论上是可以通过水平扩展无限的增加计算能力。</p>\n<p>可是模型的训练和应用在工程中的发展一直不是那么顺利，大约总结起来有如下几个原因：</p>\n<ul>\n<li>门槛较高，首先需要有比较专业的背景知识，同时还需要具备较强的编程能力，方能将其应用于工程之上。</li>\n<li>对于模型训练来说，没有大数据量的支持，生产上的效果始终差强人意，而数据量增大，如何去处理数据又成了另外一个领域的问题，能够同时处理好两方面的问题，人员较少。</li>\n<li>在实际工程中，我们获取到的数据集，往往不是训练模型直接能用的，要达到能够直接用于训练模型，还需要非常多的额外处理，这些代价甚至会高于模型训练本身，因此让模型训练这件事的成本变高。</li>\n<li>部分使用者，往往并没有达到模型训练的程度，例如连基本的数据平台都不存在，茫然的使用模型，导致效果不如预期，而将结果归结于模型本身的好坏之上。</li>\n</ul>\n<p>虽然模型训练的发展过程中有诸多问题，但是依旧能够看到其在向前发展，目前来说，基于GPU的训练，已经成了所有做模型训练的人的标配，Google甚至研发了自己的GPU：TPU。而很多芯片研发公司，也在致力于研究开发出专门用于模型训练的芯片。</p>\n<p>对于模型训练来说，目前一般会有两种做法：</p>\n<ul>\n<li>单机模型训练</li>\n<li>分布式模型训练</li>\n</ul>\n<h3>单机模型训练</h3>\n<p>所谓的单机训练，其实就是在一台机器上训练了，对于单机模型训练来讲，瓶颈主要在于提升单机的性能配置，例如不停的提高单个GPU的计算能力。而对于数据来说，大部分都是利用本地数据，虽然我们可以读取分布式文件系统的数据，但是实际上还是经过了shuffle操作，将数据读取到本地，而模型的训练，都是全程单机训练，我们可以通过各种优化算法，例如奇异值分解等手段，来降低计算成本。</p>\n<h3>分布式模型训练</h3>\n<p>对于单机训练来说，单个GPU，始终会陷入瓶颈，所以对于模型训练，也有人开始尝试，是否可以分布式训练？</p>\n<p>模型的分布式，相对于其他分布式计算会困难许多，首先模型依赖于数据，而模型本身的计算又要依赖于GPU，那么要如何将数据和计算能力结合？</p>\n<p>对于目前来讲，模型的分布式一般会有以下几种做法：</p>\n<ul>\n<li>数据分布式训练</li>\n<li>模型分布式训练</li>\n<li>混合训练</li>\n</ul>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/model-parallelism.png\"><img class=\"aligncenter size-large wp-image-5156\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/model-parallelism-1024x480.png\" alt=\"\" width=\"700\" height=\"328\"></a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/date-parallelism.png\"><img class=\"aligncenter size-large wp-image-5157\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/date-parallelism-1024x258.png\" alt=\"\" width=\"700\" height=\"176\"></a></p>\n<p>上面的图片比较形象的描述了几种不同的训练方式，首先对于数据分布式来说，每一个节点都有一个完整模型的副本，而对于模型分布式来说，模型的计算会被分散到不同的节点上，例如Tensorflow就通过图形化的表达方法，将计算描述为一个图，然后再判断图中的哪些计算可以并行运行，分别拆分到不同的节点上进行训练，从而达到分布式训练的效果。在混合训练中，模型训练会被分散，同时数据也会分散，无论是哪种分布式训练，最终都会涉及一个操作：模型的归一。在目前来说，有不同的做法，可以将模型最终归一，例如集成算法就是逻辑上实现了模型的归一。</p>\n<h3>结尾</h3>\n<p>对于大数据和人工智能来讲，现在仅仅是萌芽时期，后面还有大量的工作要做，而模型的训练无论是单机还是分布式，都还没有达到真正稳定的生产批量效果，这些挑战，不仅仅来自于技术的实现，同时也来自于业务的配合，如何利用现有的技术能力，将其推广到业务上解决问题，才是重点需要关注的地方。</p>\n<p>文／ThoughtWorks白发川</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112222\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112222votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112222\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/21", "fav_nums": 3, "tags": "IT技术,spark,分布式计算,模型训练", "url": "http://blog.jobbole.com/112222/", "front_image_path": "full/426ef5967213f8fd73aeffa67da7449970de82dd.jpg", "praise_nums": "1", "title": "从分布式计算到分布式训练", "comment_nums": 3}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/ec8b7891ca44138c9a9a09ee180cf33b.jpg"], "url_object_id": "f82b2deb2e66636ba145fc06d7391f6f", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://rework.withgoogle.com/blog/five-keys-to-a-successful-google-team/\">rework.withgoogle</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><div>\n<h3>Google 成功团队的五大关键</h3>\n<p>小群聚、工作小组、委员会、自治体，无论它叫什么，身处其中，你都是 Google 的一份子，并且你无论在哪工作，都离不开团队。因此，如果我们知道什么能让管理者高效，那么为什么我们不知道什么能让团队高效呢？</p>\n<blockquote><p>更新：点击此处查看：工作指南——<a href=\"https://rework.withgoogle.com/guides/understanding-team-effectiveness/\">理解团队效能</a>之 Google 团队效能的调查全报道，以及有助于营造团队安全感的工具。</p></blockquote>\n<p>我们中的一群人在谷歌的人力运营部（我们称之为 HR）着手使用数据和严格的分析来回答这个问题：<strong><b>是什么让谷歌</b></strong><strong><b>的</b></strong><strong><b>团队</b></strong><strong><b>高效？</b></strong>今天的早些时候，我们与<a href=\"http://bigstory.ap.org/article/8c60341cc1da47e084b8e17e62e83c98/google-searches-itself-build-more-productive-teams\">美联社</a>分享了我们的研究，现在也在这里分享这些发现。</p>\n<p>过去两年我们对 200+ Googlers（谷歌员工）的采访，观察了 180+ 个谷歌活跃团队的 250 多种属性。我们曾非常自信能找到一流团队，一个完美混合了个人特质和必备技能的团队：一个 Rhodes 学者、两个外向的人、一个牛逼的 AngularJS 工程师，还有一个博士。你看看，这就是梦之队的配置，对吧?</p>\n<p>但我们大错特错了。<strong><span id=\"pos_placeholder\" style=\"width: 0px; height: 0px; margin: 0px; padding: 0px;\"></span>一个团队中有什么人，远不如团队成员是如何相互影响、组织工作、看待贡献更重要。</strong>因为神奇的算法，我们发现了更多。</p>\n<p>我们了解到了在 Google 区分成功团队和其他团队的五大关键因素：</p>\n<ol>\n<li><b></b><strong><b>安全感（<strong><b>Psychological safety）</b></strong>：</b></strong>在这个团队里，我们敢冒险，而且不会对此感到不安和难堪？</li>\n<li><b></b><strong><b>可靠性（<strong><b>Dependability</b></strong>）：</b></strong>我们能指望他人准时完成高质量的工作吗？</li>\n<li><b></b><strong><b>结构与清晰度（<strong><b>Structure &amp; clarity</b></strong>）：</b></strong>目标、角色和执行计划都是清楚明确的吗？</li>\n<li><b></b><strong><b>工作意义（<strong><b>Meaning of work）</b></strong>：</b></strong>我们都是在做对各自来说个人意义重大的工作吗？</li>\n<li><b></b><strong><b>工作影响（<strong><b>Impact of work</b></strong>）：</b></strong>我们从根本上认为自己所做的工作重要吗？</li>\n</ol>\n<p>如果上面 5 个问题，你的回答全是“yes”，那么恭喜你，你应该是处在一个高绩效团队里。如果没有，也不代表失去了希望。这只是一个帮助你找出哪里是重点、如何变得更好的快捷方式，一种和你的成员使用结构化方式讨论这种概念的方法。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fithlogdqdj21kw1v1anc.jpg\" width=\"2048\" height=\"2413\"></p>\n<p><a href=\"https://www.youtube.com/watch?v=LhoLuui9gX8\">安全感</a>无疑是五个动力中最重要的，我们发现——它是其他四个动力的支撑。这怎么可能呢？冒险在你的团队成员看来似乎很简单。但是回想你最后一次为一个项目工作的时候。你觉得你可以像一个唯一的局外人一样，忽略风险，只问目的？或是你选择了在没有明确问题的时候继续，只为了避免被视作无知？</p>\n<p>结果是，我们都不愿去做那些会负面影响别人看待我们的能力、意识和积极性的行为。虽然这种自我保护在工作场所是一种自然的策略，但它不利于高效的团队合作。而另一方面，团队成员彼此间感觉越安全，越有可能承认错误、一起合作，以及接受新的角色。它几乎影响着我们所观察雇员的每一个重要维度。在团队中具有较高安全感的个人不太可能离开 Google，<a href=\"http://www.mckinsey.com/insights/organization/why_diversity_matters\">他们更有可能</a>利用队友的<a href=\"http://blogs.wsj.com/atwork/2015/01/20/new-report-finds-a-diversity-dividend-at-work/\">多样化的想法</a>，带来更多的收入，高管常常会认为他们是双倍高效的。</p>\n<p>Googlers 热爱数据。并且他们不想让它闲置，而想做点什么。因此，我们创建了一个名为 gTeams exercise 的工具，包含：一个对五大动力进行的 10 分钟工作评估，一份总结团队是如何工作的报告，一场讨论结果、定制发展资源以帮助团队提高的现场面对面对话。在过去的一年里，已经有 3000 多名 Googlers 在 300 个团队中使用该工具。而这些谷歌团队中，采用了新团队规范的（比如通过在每次团队会议开始前共享上周的风险）安全感评分提高了 6%，结构与清晰度的评分提高了 10%。团队们说，“有一个团队效能的框架和强制方法来讨论这些之前失去的动力，是迄今为止最有效的一部分经历。”</p>\n<p class=\"\">从 Dublin（爱尔兰都柏林）的销售团队到 Mountain View（美国加州山景城）的工程团队，我们已经看到，关注这个框架有助于各种类型的团队提高。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112239\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112239votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112239\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/young605867996\">Lada</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/young605867996\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/B77EEB9D520DE9C7BD42E89DC348FEC7/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            希望了解更多互联网、创业管理、创新思维、前沿技术和设计的知识。渐进明细，持续改进。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/young605867996\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/young605867996/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/young605867996/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 13</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://littlejanery.blog.163.com/\"><i class=\"fa fa-link\"></i></a> <a title=\"QQ：605867996\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：yao605867996\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/23", "fav_nums": 3, "tags": "职场,Google,团队", "url": "http://blog.jobbole.com/112239/", "front_image_path": "full/5630c3d4f4f3f685aa06d550f00a4cdef5d9a492.jpg", "praise_nums": "2", "title": "谷歌用两年时间研究了 180 个团队，发现高效团队有这五个特征", "comment_nums": 3}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/056e0ba2e853feeeca8d93018fa61151.jpg"], "url_object_id": "14cfc2026b582f161bc18bdb5bf704ab", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/\">Kubernetes.io</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8800-1.html\">Linux中国/songshuang00</a>   </div><p>这是一篇 Kubernetes 的概览。</p>\n<p>Kubernetes 是一个<a href=\"http://www.slideshare.net/BrianGrant11/wso2con-us-2015-kubernetes-a-platform-for-automating-deployment-scaling-and-operations\">自动化部署、伸缩和操作应用程序容器的开源平台</a>。</p>\n<p>使用 Kubernetes，你可以快速、高效地满足用户以下的需求：</p>\n<ul>\n<li>快速精准地部署应用程序</li>\n<li>即时伸缩你的应用程序</li>\n<li>无缝展现新特征</li>\n<li>限制硬件用量仅为所需资源</li>\n</ul>\n<p>我们的目标是培育一个工具和组件的生态系统，以减缓在公有云或私有云中运行的程序的压力。</p>\n<h4 id=\"toc_1\">Kubernetes 的优势</h4>\n<ul>\n<li>  <strong>可移动</strong>: 公有云、私有云、混合云、多态云</li>\n<li>  <strong>可扩展</strong>: 模块化、插件化、可挂载、可组合</li>\n<li>  <strong>自修复</strong>: 自动部署、自动重启、自动复制、自动伸缩</li>\n</ul>\n<p>Google 公司于 2014 年启动了 Kubernetes 项目。Kubernetes 是在 <a href=\"https://research.google.com/pubs/pub43438.html\">Google 的长达 15 年的成规模的产品级任务的经验下</a>构建的，结合了来自社区的最佳创意和实践经验。</p>\n<h3 id=\"toc_2\">为什么选择容器?</h3>\n<p>想要知道你为什么要选择使用 <a href=\"https://aucouranton.com/2014/06/13/linux-containers-parallels-lxc-openvz-docker-and-more/\">容器</a>?</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/056e0ba2e853feeeca8d93018fa61151.jpg\"></p>\n<p>程序部署的<em>传统方法</em>是指通过操作系统包管理器在主机上安装程序。这样做的缺点是，容易混淆程序之间以及程序和主机系统之间的可执行文件、配置文件、库、生命周期。为了达到精准展现和精准回撤，你可以搭建一台不可变的虚拟机镜像。但是虚拟机体量往往过于庞大而且不可转移。</p>\n<p>容器部署的<em>新的方式</em>是基于操作系统级别的虚拟化，而非硬件虚拟化。容器彼此是隔离的，与宿主机也是隔离的：它们有自己的文件系统，彼此之间不能看到对方的进程，分配到的计算资源都是有限制的。它们比虚拟机更容易搭建。并且由于和基础架构、宿主机文件系统是解耦的，它们可以在不同类型的云上或操作系统上转移。</p>\n<p>正因为容器又小又快，每一个容器镜像都可以打包装载一个程序。这种一对一的“程序 – 镜像”联系带给了容器诸多便捷。有了容器，静态容器镜像可以在编译/发布时期创建，而非部署时期。因此，每个应用不必再等待和整个应用栈其它部分进行整合，也不必和产品基础架构环境之间进行妥协。在编译/发布时期生成容器镜像建立了一个持续地把开发转化为产品的环境。相似地，容器远比虚拟机更加透明，尤其在设备监控和管理上。这一点，在容器的进程生命周期被基础架构管理而非被容器内的进程监督器隐藏掉时，尤为显著。最终，随着每个容器内都装载了单一的程序，管理容器就等于管理或部署整个应用。</p>\n<p>容器优势总结：</p>\n<ul>\n<li>  <strong>敏捷的应用创建与部署</strong>：相比虚拟机镜像，容器镜像的创建更简便、更高效。</li>\n<li>  <strong>持续的开发、集成，以及部署</strong>：在快速回滚下提供可靠、高频的容器镜像编译和部署（基于镜像的不可变性）。</li>\n<li>  <strong>开发与运营的关注点分离</strong>：由于容器镜像是在编译/发布期创建的，因此整个过程与基础架构解耦。</li>\n<li>  <strong>跨开发、测试、产品阶段的环境稳定性</strong>：在笔记本电脑上的运行结果和在云上完全一致。</li>\n<li>  <strong>在云平台与 OS 上分发的可转移性</strong>：可以在 Ubuntu、RHEL、CoreOS、预置系统、Google 容器引擎，乃至其它各类平台上运行。</li>\n<li>  <strong>以应用为核心的管理</strong>: 从在虚拟硬件上运行系统，到在利用逻辑资源的系统上运行程序，从而提升了系统的抽象层级。</li>\n<li>  <strong>松散耦联、分布式、弹性、无拘束的<a href=\"https://martinfowler.com/articles/microservices.html\">微服务</a></strong>：整个应用被分散为更小、更独立的模块，并且这些模块可以被动态地部署和管理，而不再是存储在大型的单用途机器上的臃肿的单一应用栈。</li>\n<li>  <strong>资源隔离</strong>：增加程序表现的可预见性。</li>\n<li>  <strong>资源利用率</strong>：高效且密集。</li>\n</ul>\n<h4 id=\"toc_3\">为什么我需要 Kubernetes，它能做什么?</h4>\n<p>至少，Kubernetes 能在实体机或虚拟机集群上调度和运行程序容器。而且，Kubernetes 也能让开发者斩断联系着实体机或虚拟机的“锁链”，从<strong>以主机为中心</strong>的架构跃至<strong>以容器为中心</strong>的架构。该架构最终提供给开发者诸多内在的优势和便利。Kubernetes 提供给基础架构以真正的<strong>以容器为中心</strong>的开发环境。</p>\n<p>Kubernetes 满足了一系列产品内运行程序的普通需求，诸如：</p>\n<ul>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/pod/\">协调辅助进程</a>，协助应用程序整合，维护一对一“程序 – 镜像”模型。</li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/storage/volumes/\">挂载存储系统</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\">分布式机密信息</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/\">检查程序状态</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/\">复制应用实例</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/\">使用横向荚式自动缩放</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/services-networking/connect-applications-service/\">命名与发现</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/\">负载均衡</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/run-application/rolling-update-replication-controller/\">滚动更新</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/debug-application-cluster/resource-usage-monitoring/\">资源监控</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/cluster-administration/logging/\">访问并读取日志</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application-introspection/\">程序调试</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/admin/authorization/\">提供验证与授权</a></li>\n</ul>\n<p>以上兼具平台即服务（PaaS）的简化和基础架构即服务（IaaS）的灵活，并促进了在平台服务提供商之间的迁移。</p>\n<h4 id=\"toc_4\">Kubernetes 是一个什么样的平台?</h4>\n<p>虽然 Kubernetes 提供了非常多的功能，总会有更多受益于新特性的新场景出现。针对特定应用的工作流程，能被流水线化以加速开发速度。特别的编排起初是可接受的，这往往需要拥有健壮的大规模自动化机制。这也是为什么 Kubernetes 也被设计为一个构建组件和工具的生态系统的平台，使其更容易地部署、缩放、管理应用程序。</p>\n<p><a href=\"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/\">标签</a>（label）可以让用户按照自己的喜好组织资源。 <a href=\"https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/\">注释</a>（annotation）让用户在资源里添加客户信息，以优化工作流程，为管理工具提供一个标示调试状态的简单方法。</p>\n<p>此外，<a href=\"https://kubernetes.io/docs/concepts/overview/components/\">Kubernetes 控制面板</a>是由开发者和用户均可使用的同样的 <a href=\"https://kubernetes.io/docs/reference/api-overview/\">API</a> 构建的。用户可以编写自己的控制器，比如 <a href=\"https://git.k8s.io/community/contributors/devel/scheduler.md\">调度器</a>（scheduler），使用可以被通用的<a href=\"https://kubernetes.io/docs/user-guide/kubectl-overview/\">命令行工具</a>识别的<a href=\"https://git.k8s.io/community/contributors/design-proposals/extending-api.md\">他们自己的 API</a>。</p>\n<p>这种<a href=\"https://github.com/kubernetes/community/blob/master/contributors/design-proposals/principles.md\">设计</a>让大量的其它系统也能构建于 Kubernetes 之上。</p>\n<h4 id=\"toc_5\">Kubernetes 不是什么？</h4>\n<p>Kubernetes 不是传统的、全包容的平台即服务（Paas）系统。它尊重用户的选择，这很重要。</p>\n<p>Kubernetes：</p>\n<ul>\n<li>  并不限制支持的程序类型。它并不检测程序的框架 (例如，<a href=\"http://wildfly.org/\">Wildfly</a>)，也不限制运行时支持的语言集合 (比如， Java、Python、Ruby)，也不仅仅迎合 <a href=\"https://12factor.net/\">12 因子应用程序</a>，也不区分 <em>应用</em> 与 <em>服务</em> 。Kubernetes 旨在支持尽可能多种类的工作负载，包括无状态的、有状态的和处理数据的工作负载。如果某程序在容器内运行良好，它在 Kubernetes 上只可能运行地更好。</li>\n<li>  不提供中间件（例如消息总线）、数据处理框架（例如 Spark）、数据库（例如 mysql），也不把集群存储系统（例如 Ceph）作为内置服务。但是以上程序都可以在 Kubernetes 上运行。</li>\n<li>  没有“点击即部署”这类的服务市场存在。</li>\n<li>  不部署源代码，也不编译程序。持续集成 (CI) 工作流程是不同的用户和项目拥有其各自不同的需求和表现的地方。所以，Kubernetes 支持分层 CI 工作流程，却并不监听每层的工作状态。</li>\n<li>  允许用户自行选择日志、监控、预警系统。（ Kubernetes 提供一些集成工具以保证这一概念得到执行）</li>\n<li>  不提供也不管理一套完整的应用程序配置语言/系统（例如 <a href=\"https://github.com/google/jsonnet\">jsonnet</a>）。</li>\n<li>  不提供也不配合任何完整的机器配置、维护、管理、自我修复系统。</li>\n</ul>\n<p>另一方面，大量的 PaaS 系统运行<em>在</em> Kubernetes 上，诸如 <a href=\"https://www.openshift.org/\">Openshift</a>、<a href=\"http://deis.io/\">Deis</a>，以及 <a href=\"http://eldarion.cloud/\">Eldarion</a>。你也可以开发你的自定义 PaaS，整合上你自选的 CI 系统，或者只在 Kubernetes 上部署容器镜像。</p>\n<p>因为 Kubernetes 运营在应用程序层面而不是在硬件层面，它提供了一些 PaaS 所通常提供的常见的适用功能，比如部署、伸缩、负载平衡、日志和监控。然而，Kubernetes 并非铁板一块，这些默认的解决方案是可供选择，可自行增加或删除的。</p>\n<p>而且， Kubernetes 不只是一个<em>编排系统</em> 。事实上，它满足了编排的需求。 <em>编排</em> 的技术定义是，一个定义好的工作流程的执行：先做 A，再做 B，最后做 C。相反地， Kubernetes 囊括了一系列独立、可组合的控制流程，它们持续驱动当前状态向需求的状态发展。从 A 到 C 的具体过程并不唯一。集中化控制也并不是必须的；这种方式更像是<em>编舞</em>。这将使系统更易用、更高效、更健壮、复用性、扩展性更强。</p>\n<h4 id=\"toc_6\">Kubernetes 这个单词的含义？k8s？</h4>\n<p><strong>Kubernetes</strong> 这个单词来自于希腊语，含义是 <em>舵手</em> 或 <em>领航员</em> 。其词根是 <em>governor</em> 和 <a href=\"http://www.etymonline.com/index.php?term=cybernetics\">cybernetic</a>。 <em>K8s</em> 是它的缩写，用 8 字替代了“ubernete”。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112243\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112243votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112243\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/23", "fav_nums": 1, "tags": "IT技术,容器", "url": "http://blog.jobbole.com/112243/", "front_image_path": "full/5a5136cb07db18c3ddd05b650d26aa95a4c39b84.jpg", "praise_nums": "1", "title": "一文了解 Kubernetes 是什么？", "comment_nums": 1}
{"front_image_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2017/08/1-DevOps-700x436.png"], "url_object_id": "fea447f655adc5e5a294480152ef9eb8", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><blockquote><p>“你在团队里是做什么的？”“DevOps。”</p>\n<p>“DevOps是什么呢？”</p>\n<p>“DevOps是一种文化、一种实践，目标是加快软件迭代速度，让团队更快交付价值。”</p>\n<p>“能不能具体点，你们日常工作的主要内容是什么？”</p>\n<p>“修Pipeline…”</p></blockquote>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/1-DevOps-700x436.png\" alt=\"\"></p>\n<p>作为一名开发，在刚涉足DevOps领域的时候，最难的就是和传统运维撇清关系；等到DevOps不再被当成是运维，又容易被当成是专职修Pipeline的人。</p>\n<p>DevOps在一遍遍被人们提及、一次次在项目中被实践时，也在不断地被重新定义，DevOps是什么？这个问题可能到现在也比较难说清楚，但是项目中的“DevOps”做了些什么，却是清晰可见的。</p>\n<p>本文就结合笔者的切身经历，谈一谈关于DevOps交付的价值以及在企业转型过程中遇到的一些问题。</p>\n<h3 id=\"toc_0\">背景介绍</h3>\n<p>客户是一家澳洲大型金融保险企业，其IT部门总人数在千人以上，维护应用两百余个。在经历了几年的收购和合并之后，在业务上指定了“将收购来的多个品牌进行整合”的大方针，于是IT部门也开始面临系统整合、业务线整合、网站合并的问题，同时客户正在将他们的服务逐渐从自建数据中心向AWS公有云服务上迁移。</p>\n<h3 id=\"toc_1\">团队概览</h3>\n<p>在数字化转型的漫漫长路中，该企业已经在内部搭建起了一套持续交付系统，以<a href=\"https://jenkins.io/\">Jenkins</a>为中心，有制品库、依赖管理、代码管理、任务管理系统，敏捷实践成熟。</p>\n<p>我所在的团队是在整个组织向DevOps转型中的一个比较关键的团队，肩负着CI/CD优化、持续交付改进、运维能力输出的重任。类似的团队应该在很多DevOps转型的组织里都有，负责维护CI/CD基础设施、搭建应用开发脚手架、维护基础设施变更、做各种自动化的工作（姑且就将这类团队称之为Platform团队）。</p>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/2-Platform-700x402.png\" alt=\"\"></p>\n<p>比较特殊的是我在的这个团队实行轮岗制，由产品团队的成员（通常是开发人员）定期轮换到Platform团队，带着在产品团队遇到但是没能解决的问题，在这个团队中寻求最佳实践和解决方案，一段时间后（通常是三个月），开发人员从Platform团队回到开发团队，同时将DevOps技能和最佳实践带到产品开发团队。</p>\n<p>整个Platform团队基本维持在3-5人的规模，有一个IM（Iteration Manager迭代经理），其余全是开发人员。</p>\n<h3 id=\"toc_2\">取得的成就</h3>\n<p>回顾过去的五个月，Platform团队一共经历了10个迭代（每个迭代两个星期），我梳理了一下每个迭代的工作内容，整理出主要成就如下：</p>\n<ul>\n<li>围绕CI/CD做了很多优化，比如简化Jenkins slave创建流程、给自动化脚本（基础设施代码）贡献了许多新功能。</li>\n<li>新技术试点，比如尝试将静态文件部署到<a href=\"https://aws.amazon.com/cn/s3/\">AWS S3</a>中代替<a href=\"https://httpd.apache.org/\">Apache</a>服务。</li>\n<li>为应用设置监控，更新了基础设施脚本用于开启监控，并协助应用团队将配置脚本应用到各个环境。</li>\n<li>团队之间的沟通，了解开发团队痛点，帮助开发团队找到能够解决问题的团队（权限、责任划分、知识传递），技能培训等。</li>\n<li>响应变化，解决技术难题（虽然我认为这更像是一个沟通+权限的问题，但是其他所有团队都认为是技术难题，那我也就这样认为吧），以及修复一些类似于硬盘空间已满、网络延迟、权限的问题。</li>\n</ul>\n<h3 id=\"toc_3\">遇到的问题</h3>\n<p>当然在交付价值的同时，有很多痛点是非常折磨人的：</p>\n<ul>\n<li><strong>权限分配：</strong>作为一个跨开发团队工作的团队，不但没有拥有比开发团队更多的权限，甚至连开发团队的一些权限都没有，比如不能向开发团队的代码库提交代码(修改基础设施代码需要这个权限)，比如缺少Linux权限导致服务器底层问题没法直接修复，再比如 Jenkins 的问题追踪到了服务层需要维护Jenkins的团队支持，因为涉及到CI／CD的应用是由别的团队在管理。</li>\n<li><strong>沟通效率：</strong>为了解决一个bug，有时候要花上两周的时间发邮件，找关键人物，组织会议，跟不同的人解释五遍以上的上下文（技术细节的上下文是很繁琐的），最后解决问题的人还很有可能不是自己团队的（没有权限）。因为大家平时都很忙，而且建卡工作的方式让一部分人对团队请求帮助的问题不是很热心，这种情况在沟通的时候如果表现得情商不够高，对方就会要你发邮件给他们团队然后等 IM 建卡，规划到迭代里再说了，我遇到过一次这样的情况，最后还是通过社工手段拿下了这个关键人物，过程不可谓不曲折。</li>\n<li><strong>明确需求：</strong>Platform团队并不交付业务价值，因此没有BA(Business analyst业务分析师，通常扮演梳理需求的角色)，建卡的事基本都由IM和Dev来做，虽然感觉上是合理的，但实施起来却遇到很多问题，究其根本就是对需求的定义和划分不够明确，导致最后挪卡的时候大家都说不准这张卡算不算完成了，只能用拍脑袋的方式来决定。</li>\n<li><strong>质量分析：</strong>同上，团队缺少QA(Quality Assurance，质量工程师，测试人员)，Dev们都是自己做卡自己测，有时候会结对测试，但也会因为对需求理解不充分，或者说拆卡拆得有问题，导致一些卡完成得质量不够，直接影响受依赖的卡。举个例子，部署监控需要自动化脚本的两个模块支持，两个模块被分为两张卡，在做第一张卡的时候遇到了诸多问题，好不容易把代码提交到别人的版本库里了，在做第二张卡的时候却发现第一张卡代码里多写了一对引号，导致整个逻辑实现失败，这个时候再回过头来改之前的代码，又要重新解决之前遇到的各种问题（沟通、权限，PS：这个时候做第一张卡的人还下了项目），周期和浪费的工时是可想而知的。</li>\n<li><strong>人员轮岗：</strong>这是 IM 一直很头疼的一件事，Platform团队大量的时间花在给新来的团队成员输入上下文、同时又有成员离开团队要交接工作、尤其在沟通重要的工作中，成员的离开意味着需要新的人重新和干系人建立联系，再者，一些成员因为项目上的痛点，不是很有心思工作在团队的事务上，而是更关心自己过段时间会被分配到那个团队，如此种种都对团队的价值交付造成了很大的困扰。举一个例子，有一个端到端测试工具一直由Platform团队维护，从我加入Platform团队开始，这个测试工具就打算新增一个集成远程浏览器引擎的功能，这是一个非常有价值的功能，因为开发团队长期苦于浏览器版本支持过少，端到端测试不稳定；但是在实现过程中一直存在一个网络问题，这张卡先后被关闭、开启、标记完成、又重新开启，经历了大概五六个人的手，困扰我们的网络问题直到Platform团队解散，都没能解决。</li>\n<li><strong>关键角色管理：</strong>做了什么很重要，有时候让别人知道你做了什么比做了什么更重要。这一点在 Platform 团队体现的得尤为明显；在交付团队中，开发如果发现资源不足，需要和TL(Tech Lead 或是Team Lead，可以理解为项目组长)或者PM(Production Manager 产品经理)沟通，如果缺少合适的汇报对象，一方面在团队需要外部支持或更多资源（比如权限）的时候得不到及时的支持，另一方面意味着团队缺少了更高的视角来实时回顾自己做的事情是否是正确的，方向有没有走偏，或者是不是又在造别人造过的轮子。我在团队解散后的回顾会议中，IM还坚持认为我们团队被解散是因为没有一个强有力的领导在背后支持，这也从侧面反映了我们没有找到合适的汇报人，告诉他，我们在做什么，听他说，我们下一步可以做什么。</li>\n</ul>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/4-Tech-Lead-1-700x390.jpg\" alt=\"\"></p>\n<h3 id=\"toc_4\">分析</h3>\n<h4 id=\"toc_5\">问题背后的原因及可能的改进方案</h4>\n<p>团队解散后经过一段时间的沉淀，我针对以上痛点与过往的成员一一交谈，了解了他们的想法，总结分析出了以下原因，以及可能的解决方案。</p>\n<h4 id=\"toc_6\">原因1：团队方向不清晰</h4>\n<p>不同于交付业务价值的产品团队，Platform团队不对某一个具体的产品负责，也不直接产出业务价值，加上Platform团队对交付的价值缺乏有效的指标度量，造成了团队方向不清晰的状况。</p>\n<p><strong>可能的改进方案：</strong>Platform 团队应该是属于架构师的一个机动团队，在团队方向不清晰的时候应该立即与利益相关者(Stakeholder)沟通，即与架构师取得联系，取得高视角的资源，最好能建立交付价值指标，比如Platform团队的目标是加快持续交付，提高交付质量，那就可视化开发团队发布周期、质量报告，让每个团队成员看到Platform团队交付价值的体现，从而明确团队方向。</p>\n<h4 id=\"toc_7\">原因2：团队角色缺失</h4>\n<p>在架构师不能全权参与团队工作的情况下（甚至Platform团队还可能没有IM），一帮Dev就很容易失去对团队整体的感知，每个Dev只关心自己手里的工作，迭代开始初期容易考虑不到全局影响、不能准确建卡，迭代进行时因为没有合适的汇报人因而跨团队交流困难，迭代结束时没有优质的回顾。 在Micromanagement Culture（微观管理文化）中有一个Alignment(校准)和Autonomy(自治)两个互斥的指标，我们使用这两个指标作为向量构成四个象限，如下图所示：</p>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/5-Spotify-Engineering-Culture.png\" alt=\"\"></p>\n<p style=\"text-align: center;\">图片来源：<a href=\"https://www.youtube.com/watch?v=4GK1NDTWbkY\">Spotify Engineering Culture</a></p>\n<ul>\n<li>高校准、低自治的团队由领导决定做什么以及怎么做，团队只需要执行，这样会形成“领导说什么就是什么”的局面；</li>\n<li>而高校准且高自治的团队是由领导指出要解决的问题以及原因，然后由团队成员相互合作共同找到问题的解决方案；</li>\n<li>低校准、低自治的团队则缺乏活力，只能循规蹈矩；</li>\n<li>而高自治、低校准的团队成员可以做任何他们想做的事情，领导则很无助因为没有人关心真正需要解决的问题。</li>\n</ul>\n<p>在敏捷团队中，如果团队成员只剩下Dev，情形则很有可能变成图中左下象限（也有些许右下）的情况，要想达到右上象限的期望状态，需要提高自治，更多的是校准。</p>\n<p><strong>可能的改进方案：</strong>在意识到这个问题的时候，团队需要一个关键人物出面充当领导者的角色，扮演这个角色的人必须关注团队交付价值、目标和方向，并且有强大的沟通能力让团队成员目标一致；和利益相关者加强沟通，保证团队方向不会跑偏。</p>\n<h4 id=\"toc_8\">根本原因</h4>\n<p>Platform团队成立初期被定义为一个立意高远（DevOps转型）的组织，但是在项目实施过程中变得越来越边缘化，其中有“人”的原因，有组织架构的原因，当然还有一些客观原因。但我突然意识到这背后有一个原因一直忽视了，那就是——我们在实践DevOps反模式。</p>\n<p>国内近年来一直在对DevOps如何落地争论不休，DevOps提倡的是打破开发和运维的部门墙，将开发和运维（的能力）放在一个团队。然而国内大部分项目的现状是，开发不具备运维技能和意识，也不愿意做“背锅侠”（要求开发做运维一定程度上牺牲了开发的利益，比如亚马逊的开发每隔一周会被要求24小时On-call）。</p>\n<p>因此一些公司选择了在项目中先成立一个 “DevOps团队” 作为过渡，再慢慢将CI/CD的理念和技能扩散到其他团队，但是这种方式稍不注意就会变成“换了个名字的Ops ”，因为工作内容相似，写脚本、做高可用，这些是传统运维也会做的事情，这种形式非常不利于团队思维的转变，“团队整体对最终交付物负责”才是DevOps的精要，而不是把团队按职责划分（只对流程负责）。</p>\n<p>这样的要求无异是给项目成员增加了工作量和责任，对他们提出了更高的要求。然而很多职员不愿意无回报地多背负一些责任，比如说开发，谁不愿意每天写点代码一提交就早早回家，DevOps要求他们得看着新功能上线，确保无误之后才能离开；所以DevOps的推行在产品团队中是有阻力的，因此DevOps的成功不光需要团队内部努力，也需要得到高层支持并扫除障碍。</p>\n<h3 id=\"toc_9\">反思</h3>\n<blockquote><p>在一个不确定性多发的时代，快速的从成败经验中学习比找寻正确的路径更加重要。——ThoughtWorks高级咨询师顾宇</p></blockquote>\n<ul>\n<li><strong>尽早找到关键角色，并且管理好利益相关人。</strong>这一点在一个扁平化组织里往往是最容易被忽视的，在意识到要和 Stackholders(利益相关者)建立联系之前，Platform 团队走了很多弯路，也错失了很多机会。</li>\n<li><strong>让事情发生比如何发生更重要。</strong>应该说在这5个月的工作中，我认为最有价值的是最后两个迭代开始真正搜集来自应用团队的需求，开始在两地组织各个团队的 TL 开会搜集痛点和解决方案。作为 Platform 团队的一员，这件事其实我早就意识到会是非常有价值的，但始终没有去做，总是顾虑不知道怎么去开始、去推动，担心TL 们提出的问题不能得到真正解决。但是最后这件事终于发生了，才意识到真的是非常有价值，而且早该这么做了。关于这点在我还在 ThoughtWorks 试用期的时候我的 Buddy(由公司安排负责伴随新员工渡过试用期的人) 给了我一个非常好的建议，就是决定在讲一个分享之前先把日程表（邀请邮件）发出来，这种看似是“Deadline driven(截止日期驱动)”的方式，背后暗含了“这件事情必须发生”的道理，这和 MVP(Minumum viable product，产品原型) 的原理也是一样的，先上线，再搜集反馈，迭代改进；就算它是一个错误的行为，这也是一次有价值的试错。</li>\n</ul>\n<h3 id=\"toc_10\">我们是否还需要DevOps团队</h3>\n<p>结合我自身的经历，“DevOps 团队”应该是一次有价值的试错，让我看到了这种方式的一些弊端，应用开发团队自身如果不具备产品思维，要由一个独立的团队去影响它们是很难的，这种实践下的 DevOps 团队就像是披着 DevOps 外衣的 Ops 团队，不能产生理想的价值。</p>\n<p>相比之下如果有一种自上而下的方式让开发团队基于已有业务基础之上去优化交付流程，并对每一个提交的最终价值负责，将产品思维真正植入到开发团队，从而达到全局优化的效果，这种做法才更符合真正的 DevOps 精神。</p>\n<p>（文／ThoughtWorks杜屹东）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112237\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112237votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112237\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/23", "fav_nums": 1, "tags": "IT技术,DevOps", "url": "http://blog.jobbole.com/112237/", "front_image_path": "full/7a7918d976b65d75d9b90138280a1268fb97e0b4.jpg", "praise_nums": "1", "title": "DevOps 团队之殇", "comment_nums": 1}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/09/64a7802a3a60295a4726c49e90604108.png"], "url_object_id": "7a050b13630b4c2a96626bde9331cd01", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.fluentcpp.com/2017/06/23/7-ways-better-cpp-summer/\">Jonathan Boccara</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>夏天时常会谈到大海、太阳、沙滩、大山或者你的家庭住宅。<strong>更充裕的时间</strong>也是夏天带来的好处之一。可能是因为你在休假，也可能是因为这段时间工作没有那么忙。无论是哪种情况，与一年中的其他季节相比，夏天的时间似乎更加宽裕。</p>\n<p>你有两个选择：1）把所有夏季空闲时间都用来休整，适当放松一下没什么不可以。2）或者你可以投入一部分空闲时间来提升你的技能，尤其是 C++，用 C++ 水平的提高（boost C++）来开始新的一年。</p>\n<p>如果你觉得选择1）更适合你，那么关掉手机和笔记本吧，真正地放松一下！但是如果你倾向于选择2），那么这篇文章就是为你准备的。</p>\n<p>有 7 种方法帮助你利用夏天真正提高 C++。之后我会给你一些小技巧来帮助你<strong>真正实现</strong>所选的目标。</p>\n<h3>1）开始一个项目</h3>\n<p>用 C++ 来建一个你自己的小项目是一个很好的试验方法，而且能通过这个项目真正理解程序的运行。另一个优点在于你可以完全自由地决定使用什么组件。这样你能够提升这一年没有权限/时间使用的语言特性和库组件。</p>\n<p>在我去年的夏季项目中，我实现了一些区间适配器，这让我学到了超多东西。所以我会把这个项目的细节告诉你，这样你能够得到一些灵感来构建你自己的项目：</p>\n<ul>\n<li>如果你不熟悉 C++ 中的区间（Ranges），请参考<a href=\"http://www.fluentcpp.com/2017/01/12/ranges-stl-to-the-next-level/\">《Ranges: the STL to the Next Level》</a></li>\n<li>实现 transform_iterator，</li>\n<li>实现变换区间适配器（transform range adaptor），</li>\n<li>实现 filter_iterator，</li>\n<li>实现筛选区间适配器（filter range adaptor），</li>\n<li>实现 zip 适配器（zip adaptor），然后结合变换区间适配器使用。Zip 适配器需要两个区间，并且返回到来自这两个区间的成对对象的视图</li>\n<li>为 zip 适配器一般化，要令 zip 适配器能够使用任意数量的区间，</li>\n<li>实现<a href=\"http://www.fluentcpp.com/2017/04/14/understand-ranges-better-with-the-new-cartesian-product-adaptor/\">笛卡尔积区间适配器（Cartesian product range adaptor）</a>，</li>\n<li>实现你自己的新区间适配器！</li>\n</ul>\n<p>是否完美，是否完整或者是否遵从上述指示都不重要，重要的是你要去<strong>试验</strong>。但是上面这些任务能给你带来的是：</p>\n<ul>\n<li>明确理解区间，而区间是当下一个非常流行的 C++ 特性，</li>\n<li>练习变参模板（variadic templates）的使用，</li>\n<li>初步接触模板元编程（template metaprogramming），</li>\n</ul>\n<p>并且这些都是逐渐才能体会到的。</p>\n<p>如果你在这种项目上有任何需要帮助的地方，我都愿意效劳。另外我在这个项目上的所有尝试都写在 <a href=\"https://github.com/joboccara/ranges\">GitHub 的代码仓库</a>中了，希望对你们有用。</p>\n<h3>2）读一本好书</h3>\n<p>我会发布一个 C++ 的书单，但是我现在要给你一个选择。我认为作为一个程序员要读的第一本书就是 Steve McConnell 的《<a href=\"https://www.amazon.cn/gp/product/B0061XKRXA/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0061XKRXA&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">代码大全</a>》。尽管这本书不是专注于 C++ 的，但是它把写好代码要注意的几乎所有方面都教给你了。从写一个 if 语句（没错，有好多方法把 if 语句搞砸）到分配类责任，再到代码审查，《代码大全》涵盖了软件架构的所有方面。在读完这本书以后你永远不会还用一样的方法来编程。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/9a741bac0b81b0471c32da6d8611496f.jpg\"><img class=\"aligncenter wp-image-112252 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9a741bac0b81b0471c32da6d8611496f.jpg\" alt=\"Code-complete-246x300\" width=\"246\" height=\"300\"></a></p>\n<p>如果你还没有读过《代码大全》，你应该去看看 Scott Meyers 的《<a href=\"https://www.amazon.cn/gp/product/B004G72P24/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B004G72P24&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">Effective C++</a>》。我建议《Effective C++》要读<strong>两遍</strong>。我已经读过三遍了，但是我想两遍的效果应该一样好。尽管这本书是在 C++11 之前写的，但是大部分内容在今天也仍然是有用的。而且《<a href=\"https://www.amazon.cn/gp/product/B016OFO492/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B016OFO492&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">Effective Modern C++</a>》涵盖了C++11 和 C++14 中的特性，可以作为这本书的补充材料。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/59eb3be85b04e023cb4b9a0561c76068.jpg\"><img class=\"aligncenter wp-image-112253 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/59eb3be85b04e023cb4b9a0561c76068.jpg\" alt=\"Code-complete-246x300\" width=\"243\" height=\"300\"></a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3efe96caf01c1d258a4158313c5ba2c6.png\"><img class=\"aligncenter wp-image-112255 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3efe96caf01c1d258a4158313c5ba2c6.png\" alt=\"Effective-modern-C-249x300\" width=\"249\" height=\"300\"></a></p>\n<p>今年夏天我要看的是 Eric Evans 的著名书籍——《<a href=\"https://www.amazon.cn/gp/product/B01GZ6T12K/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B01GZ6T12K&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">领域驱动设计</a>》（Domain Driven Design）。《领域驱动设计》涵盖了领域专家和开发人员之间的密集交流，建立领域模型以及在讨论模型与代码时使用<strong>同一种语言</strong>。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ee2d35e20bea6c8b6dba2692c6d53deb.jpg\"><img class=\"aligncenter wp-image-112256 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ee2d35e20bea6c8b6dba2692c6d53deb.jpg\" alt=\"Code-complete-246x300\" width=\"227\" height=\"300\"></a></p>\n<p>尽管这本书的内容很有价值，但是读起来并不容易。我发现一个有用的小技巧：对每一小节<strong>先读第一段，再读最后一段，最后读其余部分</strong>。这样你能更好地理解作者的写作方向，节省时间。</p>\n<p>我希望通过显示代码中的域，来找到使代码具有表达性的灵感。当然啦，我会在博客上分享这些灵感的。</p>\n<p>这只是一个选择，我还会做一个更全面的书单。</p>\n<h3>3）学习一个新的语言</h3>\n<p>虽然听起来很稀奇，但是学习一种新的语言可以让你对你所的专注语言获得更深层次的理解，而且是最有效的方法之一。并且新的语言和你自己使用的语言差别越大，效果越好。</p>\n<p>新的观点认为，其他编程语言会让你对编程有更一般的理解。由于你太熟悉自己所用的语言，往往会忽略它的特性，而用不同的方法解决问题能够使这些特性凸显出来。即使你不会使用新语言来写产品代码，所接触到的新概念也能为你提供可以应用到主语言中的思路。</p>\n<p>如果你用的是 C++，那么我推荐你去学习一下 Haskell 语言。Haskell 是一种<strong>函数型编程</strong>语言。如果你还没有试用过函数型编程，那么你能从它的概念中获得启发，并从新的角度看待 C++，尤其是 STL。</p>\n<p>我已经花了很长时间比较网络上各种学习 Haskell 的资源。2013 年（单指那一年）<a href=\"http://www.seas.upenn.edu/~cis194/spring13/lectures.html\">宾夕法尼亚大学的课程</a>是我找到的最好的资源。它解释得很清楚，没有太多理论，课程练习也很良心而且有指导性，并且它还是免费的。</p>\n<p>一旦你学完这门课程，你可以在<a href=\"https://github.com/tonymorris/fp-course\"> data61 课程</a>中获得很多 Haskell 的练习，包括填空补充代码。你能够通过这些练习来整理不寻常的函数型编程的相关知识。</p>\n<p>如果你想了解更多函数型编程语言以及它们在 C++中的应用，我推荐 Quentin Duval 的博客：<a href=\"https://deque.blog/\">deque.blog</a>。</p>\n<p>今年夏天我要学习的语言是 <strong>Lisp</strong> 。我明白它是一种非常强大的语言，能够全面提升对编程的理解。一些语言是从它衍生出来的。它不会消失一定是有原因的！</p>\n<p>我还没有完成对网上资源的调查，但是我计划使用《<a href=\"https://www.amazon.cn/gp/product/B0011AP7RY/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0011AP7RY&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">计算机程序的构造和解释</a>》（Structure and Interpretation of Computer Programs）。如果你有任何关于学习 Lisp 的想法，请告诉我！</p>\n<h3>4）提升使用 STL 的能力</h3>\n<p>STL 是 C++ 中处理容器和算法的部分。它很强大而且并不难用，却没有它应有的名气。要想掌握 STL 需要有相当的知识积累，但是这是值得的。它是一个神奇的方法，能使你的 C++ 代码更具有表达性也更健壮。</p>\n<p>我正在整理帮你掌握 STL 的资料，叫做 <a href=\"http://www.fluentcpp.com/stl/\">STL 学习资源</a>。还没有完成，但是有很大一部分已经做完了，我想足够让你在这个夏天的大部分时间都很充实了。</p>\n<h3>5）紧跟现代C++的特性</h3>\n<p>C++11，C++14 和C++17给C++ 和标准库带来了很多新的特性。即使你现在，比如今年夏天，没有在产品代码中使用它们，它们也都来了。并且你可以立即把它们应用在你的项目中（看上面的第1条）。</p>\n<p>有些特性很好掌握，比如 <strong>lambdas</strong>。尽管精通 lambda 表达式需要掌握很多细节上的东西，但是学会它们的基础用法不需要花太多精力。</p>\n<p>所以部分特性很好理解，只需要一些好资源和时间来熟悉它们。比如 Scott Meyers 的《<a href=\"https://www.amazon.cn/gp/product/B016OFO492/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B016OFO492&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">Effective Modern C++</a>》（见上面的第2点）涵盖了 C++11和 C++14 的大部分特性。</p>\n<p>我特别喜欢Bartek博客上的一份 <a href=\"http://www.bfilipek.com/2017/01/cpp17features.html\">C++17 特性列表</a>，它可以帮你快速上手 C++17 新特性。内容详实，而且你可以通过给一个特定的特性添加信息来贡献自己的一份力量。Bartolomiej 提供了所有的资源和 Github 权限，所以你能够非常轻松地添加信息。这样即使你还不了解 C++17 也能够贡献自己的力量，并且<strong>在这个过程中学到很多东西</strong>。</p>\n<p>如果你不练习的话，是无法理解很多特性的。尤其是<strong>变参模板</strong>，它是现代标准 C++ 的一个重要特性。上面第一点中的项目和其他任何包含变参模板的项目都可以作为练习。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/f468e87715fe3659f2a508a9c5ef91ed.jpg\"><img class=\"aligncenter wp-image-112257 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/f468e87715fe3659f2a508a9c5ef91ed.jpg\" alt=\"Code-complete-246x300\" width=\"640\" height=\"360\"></a></p>\n<h3>6）提高你对 boost 的了解</h3>\n<p>Boost 是设计良好的 C++ 库的集合，可移植且开源。很多现代 C++ 的特性都源自 Boost。</p>\n<p>了解 Boost 的内容很重要。有两个原因：第一，在代码中确实需要它们，因为 boost 主要应用于综合使用；第二，更重要的原因是即使你在产品代码中没有使用 boost，它可以给你一个通用的精心设计的 API 和 C++ 代码模型。<strong>留心 boost 中的内容可以给你自己的设计带来灵感</strong>。</p>\n<p>学习大量的 boost 库的一个方法是阅读 Boris Schäling 的书——《<a href=\"https://www.amazon.cn/gp/product/0982219199/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=0982219199&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">The boost C++ Libraries</a>》。这本书有<a href=\"https://theboostcpplibraries.com/\">电子版</a>，但是纸质版可以放进沙滩包供你躺在沙滩上阅读（真的，我去年夏天就读的这本书）。不过这本书是基于 boost 1.55.0 的，所以它包含了很多库，但并不是所有。</p>\n<p>特别地，它没有包含 Boost Hana。Boost Hana 是一个流行的现代 C++ 元程序库。实际上，学习 Boost Hana 可以作为今年夏天的一个目标。</p>\n<p>我询问了 Louis Dionne（Boost Hana 的创始人）怎么样才能有效地学习 Boost Hana。从<a href=\"http://www.boost.org/doc/libs/1_61_0/libs/hana/doc/html/index.html\">官方指导</a>入手是一个好的开始，而且你可以看他的<a href=\"https://youtu.be/Oc4enqNH-Mc\"> ACCU 演讲</a>（或者<a href=\"https://www.youtube.com/watch?v=X_p9X5RzBJE\">Meeting C++ keynote</a>，内容相似）来获取初步的介绍。这里是<a href=\"http://ldionne.com/talks/\"> Louis 的所有演讲</a>，大多数都与元编程和 HANA 有关，可以帮助加深你的了解。</p>\n<h3>7）观看网络视频</h3>\n<p>C++ 社区上有超多网络视频，尤其是年会的视频。今年夏天是观看这些视频的好时机。</p>\n<p>下面是一些我觉得有近期指导性的演讲：</p>\n<ul>\n<li>Patrice Roy – <a href=\"https://youtu.be/Fno6suiXLPs\">异常处理（The Exception Situation）</a>。这个演讲让你对在 C++ 中使用异常处理对你的代码意味着什么有一个大致了解。该演讲结构合理，而且 Patrice 的演讲风格很让人愉快。</li>\n<li>Arthur O’Dwyer – <a href=\"https://youtu.be/vwrXHznaYLA\">Template Normal Programming</a>。在这个演讲中，Arthur 在不用模板元编程的情况下，展示了关于模板的所有知识，同样有板有眼。</li>\n<li>Stephan T. Lavave  – <a href=\"https://www.youtube.com/watch?v=JhgWFYfdIho\"> tuple＜＞：新特点以及它的用法（tuple＜＞: What’s New and How it Works）</a>。这里有很多关于 tuples 的有用信息和练习帮助你更了解标准库。</li>\n<li>Howard Hinnant – <a href=\"https://youtu.be/P32hvk8b13M\">chrono 导论（A ＜chrono＞ Tutorial）</a>。这个演讲教你使用 chrono 库，告诉你它是怎么用强类型来完成安全又表达清楚的代码。</li>\n<li>David Sankel –<a href=\"https://youtu.be/DiisKQAkGM4\"> Monoids, Monads, and Applicative Functors: Repeated Software Patterns</a>。David Sankel 展示了纯函数概念如何应用于 C++。</li>\n<li>David Sankel – <a href=\"https://youtu.be/k3O4EKX4z1c\">Variants：过去，现在和未来（Variants: Past, Present, and Future）</a>。一个关于 variant 的优秀展示，并且 variant 在 C++17 中被放进标准库里了。</li>\n<li>Dietmar Kühl – <a href=\"https://youtu.be/xWmdcvTedbc\">Constant Fun</a>。一个关于 constexpr 的优秀展示。</li>\n<li>Jason Turner –<a href=\"https://www.youtube.com/channel/UCxHAlbZQNFU2LgEtiqd2Maw\"> C++周刊（C++ Weekly）</a>。在这个周系列中，Jason 制作了一些短视频（5 到 10 分钟），每个视频都展示了一个 C++ 的精彩应用。我通常把这系列视频描述为“精彩 5 分钟”。</li>\n</ul>\n<p>这个列表绝没有包括所有优秀的视频。我看到过其他好视频，并且会有很多我没看过的。但是我觉得这个列表里的视频是个好开始。</p>\n<h3>实现你的夏季目标</h3>\n<p>现在已经有<strong>很多事要做</strong>啦。一个夏天之内不可能做完这些所有事情。所以你应该选择其中一部分来做，并且<strong>提前定好目标</strong>。不要从一件事情跳到另一件事情上，否则夏天会很快过去而且你也完不成任何一件事。</p>\n<p>此外，要想完成你的目标，你需要<strong>集中注意力</strong>。一个实用的方法是使用<a href=\"https://en.wikipedia.org/wiki/Pomodoro_Technique\">番茄工作法</a>，我是用 <a href=\"https://kanbanflow.com/\">kanbanflow</a> 来实现的。我现在就在使用这个方法而且结果也不错。</p>\n<p>我今年夏天的目标是读完《领域驱动设计》并且对 Lisp 有适当的理解。你的目标是什么呢？</p>\n<p>现在就选择<strong>两个目标</strong>吧，写在评论区内让我了解一下你们的选择。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112246\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112246votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112246\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/24", "fav_nums": 1, "tags": "C/C++,开发,C++", "url": "http://blog.jobbole.com/112246/", "front_image_path": "full/f5d4611e2094787b56111e18af07ad9bad0e04f6.jpg", "praise_nums": "1", "title": "提升 C++ 技能的 7 种方法", "comment_nums": 1}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/07/Nginx-Logo.jpg"], "url_object_id": "1a6ec2a64adc4d7e67f112d418752843", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://tech.lede.com/2017/07/21/rd/server/crossdomain/\">网易乐得 - 张捷</a>   </div><h3 id=\"1-前言\">1. 前言</h3>\n<p>贵金属wap版直播间上线后，偶尔有用户反馈，在进入wap直播间的时候，出现空白页面，但是重新刷新又可以正常显示了。我们曾一度认为是网络请求异常或兼容问题，直到开发PC版直播间，在进行调试中，同样遇到了“白屏”问题，才引起了足够重视，并进行了问题跟踪与分析。现在跟大家分享一下，这种偶然现象出现的原因。</p>\n<p>我们的直播间落地页在fa.163.com 系统，而直播间内容，是通过 向直播间系统 qz.fa.163.com 发起Ajax请求获取的。在出现“白屏”的时候，可以通过浏览器的调试窗口，可以看到出现下面的报错</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/a12fbf3c168315a7d1b5b5a2ca4b6129.png\"><img class=\"alignnone size-full wp-image-112226\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a12fbf3c168315a7d1b5b5a2ca4b6129.png\" alt=\"p1\"></a></p>\n<h3 id=\"2-问题分析\">2. 问题分析</h3>\n<p>从上述错误提示文案中可以看到，问题首先和 <strong>跨域</strong> 有关。</p>\n<blockquote><p><strong>何为跨域</strong></p>\n<p>从字面上理解为“跨域名”，<br>\n浏览器不能执行其他网站的脚本，然而，跨域不仅仅局限于域名这一项。只要协议、域名、端口有任何一个不同，都被当作是不同的域。 这是由于&gt;同源策略的限制，从一个域上加载的脚本不允许访问另外一个域的文档属性。虽然在浏览器中，&lt;script&gt;、&lt;img&gt;、&lt;iframe&gt;、&lt;link&gt;等标签都&gt;可&gt;以加载跨域资源，而不受同源限制，但浏览器会限制脚本中发起的跨域请求。比如，使用 XMLHttpRequest 对象和Fetch发起 HTTP 请求就必须遵守同源策略。</p>\n<p><strong>同源策略/SOP（Same origin policy）</strong>是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到XSS、CSFR等攻击。SOP要求两个通讯地址的协议、域名、端口号必须相同，否则两个地址的通讯将被浏览器视为不安全的，并被block下来。</p>\n<p style=\"text-align: center\">举个例子：从贵金属主站 <a href=\"http://fa.163.com\" target=\"_blank\" rel=\"external\">http://fa.163.com</a> 发起请求访问以下url：<br>\n<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/b26b0c19bf035ea217c4df11feb23328.png\"><img class=\"alignnone size-full wp-image-112227\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/b26b0c19bf035ea217c4df11feb23328.png\" alt=\"p6\"></a></p>\n<p><strong>解决跨域</strong></p>\n<p>在实际应用中有多种方式来解决跨域问题，相信在实践中都会用到其中的某些方案：</p>\n<p>1.JSONP （无状态连接，不能获悉连接状态和错误事件，而且只能走GET的形式）</p>\n<p>2.iframe形式</p>\n<p>3.服务器代理</p>\n<p>页面直接向同域的服务端发请求，服务端进行跨域处理或爬虫后，再把数据返回给客户端页。</p>\n<p>4.CORS</p>\n<p>CORS(Cross-Origin Resource Sharing)跨域资源共享，定义了必须在访问跨域资源时，浏览器与服务器应该如何沟通。CORS背后的基本思想就&gt;是使用自定义的HTTP头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功还是失败。目前，所有浏览器都支持该功能，IE浏览器不能低&gt;于IE10。整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏&gt;览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。</p>\n<p>CORS方式实现：</p>\n<p>浏览器在发出CORS请求时会在头信息之中增加一个Origin字段；</p>\n<p>后端返回代码中增加三个字段</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599fbe1b41a86541123741\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nheader(“Access-Control-Allow-Origin”:“”);           // 必选 允许所有来源访问\r\nheader(“Access-Control-Allow-Credentials”:“true”);  //可选 是否允许发送cookie\r\nheader(“Access-Control-Allow-Method”:“POST,GET”);   //可选 允许访问的方式</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a86541123741-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599fbe1b41a86541123741-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a86541123741-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599fbe1b41a86541123741-1\"><span class=\"crayon-e\">header</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-v\">Access</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Allow</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Origin</span>”<span class=\"crayon-o\">:</span>“”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 必选 允许所有来源访问</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599fbe1b41a86541123741-2\"><span class=\"crayon-e\">header</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-v\">Access</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Allow</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Credentials</span>”<span class=\"crayon-o\">:</span>“<span class=\"crayon-t\">true</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//可选 是否允许发送cookie</span></div><div class=\"crayon-line\" id=\"crayon-599fbe1b41a86541123741-3\"><span class=\"crayon-e\">header</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-v\">Access</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Allow</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Method</span>”<span class=\"crayon-o\">:</span>“<span class=\"crayon-v\">POST</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">GET</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">//可选 允许访问的方式</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>nginx是一个高性能的web服务器，常用作反向代理服务器。nginx作为反向代理服务器，就是把http请求转发到另一个或者一些服务器上。通过把本地一个url前缀映射到要跨域访问的web服务器上，就可以。</p></blockquote>\n<p>为了解决跨域问题，我们选择方案d ， 在直播间的过滤器中，统一添加了如下代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599fbe1b41a90293940847\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n   &lt;a href=\"http://www.jobbole.com/members/wx610506454\"&gt;@Override&lt;/a&gt;\r\n   public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\r\n    // 加入响应头\r\n    String origin = request.getHeader(\"Origin\");\r\n    if(\"http://fa.163.com\".equals(origin) || \"https://fa.163.com\".equals(origin) ) {\r\n        response.addHeader(\"Access-Control-Allow-Origin\", origin);\r\n        response.addHeader(\"Access-Control-Allow-Credentials\", \"true\");\r\n    }\r\n    return true;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a90293940847-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599fbe1b41a90293940847-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a90293940847-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599fbe1b41a90293940847-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a90293940847-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599fbe1b41a90293940847-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a90293940847-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599fbe1b41a90293940847-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a90293940847-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599fbe1b41a90293940847-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599fbe1b41a90293940847-1\"><span class=\"crayon-h\">   </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx610506454\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599fbe1b41a90293940847-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preHandle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletRequest </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599fbe1b41a90293940847-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 加入响应头</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599fbe1b41a90293940847-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">origin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Origin\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599fbe1b41a90293940847-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://fa.163.com\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://fa.163.com\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599fbe1b41a90293940847-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Access-Control-Allow-Origin\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599fbe1b41a90293940847-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Access-Control-Allow-Credentials\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"true\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599fbe1b41a90293940847-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599fbe1b41a90293940847-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599fbe1b41a90293940847-10\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>从错误提示文案中，我们还可以看到错误提示的关键点 “<a href=\"http://fa.163.com%E2%80%9D\" target=\"_blank\" rel=\"external\">http://fa.163.com”</a> that is not equal to the supplied origin. Origin ‘<a href=\"https://fa.163.com\" target=\"_blank\" rel=\"external\">https://fa.163.com</a>‘ is therefore not allowed access.<br>\n目前我们的系统同时支持http访问和https访问，但是为什么使用 http访问 ，返回的header中却是 https 协议呢？<br>\n通过多次模拟，确认出现问题的请求中，Request URL使用的协议和 response返回的headers中的 Access-Control-Allow-Origin 中的 协议确实不一致，且还有一个特性，X-Cached 为 HIT，如下图：</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c7581ea997ecc2922a2e162ed57aef52.jpg\"><img class=\"alignnone size-full wp-image-112228\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c7581ea997ecc2922a2e162ed57aef52.jpg\" alt=\"p2\"></a></p>\n<p>命中了缓存的请求，出现了协议不一致？</p>\n<p>突然想到，这个接口，我们配置了nginx 缓存，那必然和nginx缓存有关了。</p>\n<blockquote><p><strong>Nginx 缓存</strong></p>\n<p>Nginx (engine x) 是一个高性能的HTTP和反向代理服务器。<br>\n首先从源服务器（内部网络上的web服务器）上获取内容，然后把内容返回给用户，同时，也会把内容保存到代理服务器上一份，这样日后再接收同样的信息请求时，他会把本地缓存里的内容直接发给用户，以此减少后端web服务器的压力，提高响应速度。这其实就是缓存服务器所实现的功能。如下图所示。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d93182a8d7f7fe0c1129b5c36ab6aad8.png\"><img class=\"alignnone size-full wp-image-112229\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d93182a8d7f7fe0c1129b5c36ab6aad8.png\" alt=\"p3\"></a></p></blockquote>\n<p>进入直播间后，首先需要查询直播内容是否有更新，而这个接口客户端会以5s间隔轮询，为了减少tomcat的压力，我们配置了nginx缓存。配置如下</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ecf29cf6d154c4ad3cfe0f5d4acfa2a4.png\"><img class=\"alignnone size-full wp-image-112231\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ecf29cf6d154c4ad3cfe0f5d4acfa2a4.png\" alt=\"p4\"></a></p>\n<p>其中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599fbe1b41a95884204351\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nproxy_cache_methods： 用来设置HTTP哪些方法会被缓存，直播间接口配置了GET、HEAD、POST；\r\nproxy_cache_valid:    用来设置对不同HTTP状态码的不同缓存时间。直播间接口配置了对于 返回值为200的状态码，缓存5秒；\r\nproxy_cache_min_uses: 用来设置多少次访问后，应答值会被缓存，配置为3次；\r\nproxy_cache_key:      设置Web缓存的key\r\nproxy_cache:          用来设置哪个缓存区将被使用，并定义缓存区的名称\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a95884204351-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599fbe1b41a95884204351-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a95884204351-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599fbe1b41a95884204351-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599fbe1b41a95884204351-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599fbe1b41a95884204351-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599fbe1b41a95884204351-1\"><span class=\"crayon-v\">proxy_cache</span><span class=\"crayon-sy\">_</span>methods：<span class=\"crayon-h\"> </span>用来设置<span class=\"crayon-i\">HTTP</span>哪些方法会被缓存，直播间接口配置了<span class=\"crayon-i\">GET</span>、<span class=\"crayon-i\">HEAD</span>、<span class=\"crayon-i\">POST</span>；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599fbe1b41a95884204351-2\"><span class=\"crayon-v\">proxy_cache_valid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span>用来设置对不同<span class=\"crayon-i\">HTTP</span>状态码的不同缓存时间。直播间接口配置了对于<span class=\"crayon-h\"> </span>返回值为<span class=\"crayon-cn\">200</span>的状态码，缓存<span class=\"crayon-cn\">5</span>秒；</div><div class=\"crayon-line\" id=\"crayon-599fbe1b41a95884204351-3\"><span class=\"crayon-v\">proxy_cache_min_uses</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>用来设置多少次访问后，应答值会被缓存，配置为<span class=\"crayon-cn\">3</span>次；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599fbe1b41a95884204351-4\"><span class=\"crayon-v\">proxy_cache_key</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span>设置<span class=\"crayon-i\">Web</span>缓存的<span class=\"crayon-e\">key</span></div><div class=\"crayon-line\" id=\"crayon-599fbe1b41a95884204351-5\"><span class=\"crayon-v\">proxy_cache</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span>用来设置哪个缓存区将被使用，并定义缓存区的名称</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599fbe1b41a95884204351-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>通过上述配置，我们可以看到 proxy_cache_key 配置中，只配置了host + uri + 参数，但没有配置协议，所以无论用http访问，还是https访问，只要被缓存后，返回的内容都是一样的，而不会区分http或https。从而引起了跨域问题。<br>\n至此，问题分析完毕。</p>\n<h3 id=\"3-问题解决\">3. 问题解决</h3>\n<p>跟运维同学沟通后，通过修改nginx配置，将协议类型scheme加入到缓存查找的判断参数中，配置如下。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ce493ab2cec7b730fd5801c8cd15fa69.png\"><img class=\"alignnone size-full wp-image-112230\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ce493ab2cec7b730fd5801c8cd15fa69.png\" alt=\"p5\"></a></p>\n<p>问题得到了解决。</p>\n<h1 id=\"4-总结\">4. 总结</h1>\n<p>上述“惨案” ，是 跨域、nginx缓存、http/https协议 这三种条件同时出现引发的。<br>\n如果不涉及跨域，混用 http/https协议 + nginx缓存，其实也是没有问题的。但是一旦出现了跨域使用，必须 在nginx 缓存配置中，配置 scheme + host + uri +　参数。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112224\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112224votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112224\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/21", "fav_nums": 4, "tags": "IT技术,Nginx,数据库", "url": "http://blog.jobbole.com/112224/", "front_image_path": "full/2d4fd40c8eaec8319c1de2f154b3275aecd23f9d.jpg", "praise_nums": "1", "title": "Nginx 缓存引发的跨域惨案", "comment_nums": 4}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "url_object_id": "ffadf132787e6e34490e266051346177", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/most-useful-linux-command-line-tricks\">Seco Max</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/most-useful-linux-command-line-tricks\">开源中国 - leoxu</a>   </div><p>我们可能每天都会要使用到很多的 <a href=\"https://likegeeks.com/main-linux-commands-easy-guide/\" target=\"_blank\" rel=\"nofollow\">Linux 命令行</a>。 我们也会网络上知晓一些使用它们的小技巧，但是如果我们没有时常来进行练习，就有可能会忘掉怎么去使用它们。 所以我就决定把那些你可能会忘记的小提示和小技巧，或者对你而言可能是全新的东西都列表来。</p>\n<h3>将输出内容以表格的形式显示出来</h3>\n<p>有时，在你看到命令行执行的输出时，因为字符串过度拥挤（比如说 mount 命令的输出）导致输出内容难以识别。如果我们看到的内容是一张表格会如何呢？其实这是很容易做到的！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8e2fc36f3911960017\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmount | column –t:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8e2fc36f3911960017-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8e2fc36f3911960017-1\"><span class=\"crayon-i\">mount</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">column</span> –<span class=\"crayon-v\">t</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8105f229bd5aab1933e69a673b050b77.png\"></p>\n<p>在此例中，由于内容中留了空格，所以输出的形式就美观了起来。 那如果想要的分隔符是别的什么符号，比如说冒号，又该怎么去做呢？ （例如，在 cat/etc/passwd 的输出内容中使用）</p>\n<p>这时候只需要使用 -s 参数指定分隔符就行了，像下面这样。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8e2fc36fe413310355\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat /etc/passwd | column -t -s:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8e2fc36fe413310355-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8e2fc36fe413310355-1\"><span class=\"crayon-i\">cat</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">passwd</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">column</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span> <span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ef22e95df16fb93a17c96954e6950305.png\"></p>\n<h3>重复执行一个命令，直到它运行成功</h3>\n<p>如果在 Google 上搜索这个功能，你会发现很多人都问到了如何重复执行命令，直到这个命令成功返回并且运行正常。 Google上的建议里就包括 ping 服务器，直到它变得空闲为止，还有就是检查是否有向特定的目录上传了具有特定扩展名的文件，还有就是检查特定的URL是否已经存在，诸如此类的办法。</p>\n<p>其实你还可以使用 while true 的循环来实现来实现这个功能：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/aa7339a9cd7cf1369192fd1007cb76cc.png\"></p>\n<p>在上面这个示例中，&gt;/dev/null 2&gt;＆1 会让程序的输出重定向到 /dev/ null。标准错误和标准输出都会被包含进去。</p>\n<p>这是我认为最酷的Linux命令行技巧之一。</p>\n<h3>按内存资源的使用量对进程进行排序</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8e2fc3703939970121\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nps aux | sort -rnk 4:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8e2fc3703939970121-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8e2fc3703939970121-1\"><span class=\"crayon-i\">ps</span> <span class=\"crayon-i\">aux</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">sort</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">rnk</span> <span class=\"crayon-cn\">4</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/02ff6a80a4e1632d459fbe1ff580d8fb.png\"></p>\n<h3>按 CPU 资源的使用量对进程进行排序</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8e2fc3706002400464\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nps aux | sort -nk 3:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8e2fc3706002400464-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8e2fc3706002400464-1\"><span class=\"crayon-i\">ps</span> <span class=\"crayon-i\">aux</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">sort</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">nk</span> <span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a71a5974b1fbae9a9614f2f65d66bfdd.png\"></p>\n<p>如果想要检查你的机器架构，那就执行 getconf LONG_BIT。</p>\n<h3>可以同时查看多个日志文件</h3>\n<p>毫无疑问，你可能已经会使用 tail  命令来查看日志文件了，但可能有时候你还想着能同时查看多个日志文件。 使用 multi-tail 命令就支持支持文本的高亮显示，内容过滤以及更多你可能需要的功能：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ba6ceb511883799d251d17f9b4e28f0e.png\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d81c3712dd9b9986860c3e89467852fb.png\"></p>\n<p>如果系统里还没有这个命令，运行 apt-get install multitail 命令就可以把它给装上。</p>\n<h3>回到你操作过的上一个目录去</h3>\n<p>只需敲入 cd – 就会返回到你操作过的上一个目录中去。</p>\n<h3>让非交互式 Shell 会话可进行交互</h3>\n<p>想要这样做，那就把设置从 ~/.bashrc 改成 ~/.bash_profile 吧。</p>\n<h3>定时的监视性命令输出</h3>\n<p>使用 watch 命令（watch df -h），你就可以查看到任何命令的任何输出。例如，你可以查看可用空间以及它的使用量增长情况。</p>\n<p>通过利用 watch 命令来操作会变化的数据，你可以尽情想象自己能拿这个来做些什么哦。</p>\n<h3>在会话关掉以后继续运行程序</h3>\n<p>如果你在后台运行了什么程序，然后你关掉了的 shell 会话，那么这个后台运行的程序就会被你的 shell 杀掉。关闭 shell 以后怎么让程序继续运行下去呢？</p>\n<p>这个可以用 nohup 命令做到 – 该指令表示不做挂断操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8e2fc370b502378568\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnohup wget site.com/file.zip</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8e2fc370b502378568-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8e2fc370b502378568-1\"><span class=\"crayon-i\">nohup</span> <span class=\"crayon-i\">wget</span> <span class=\"crayon-v\">site</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">zip</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>此命令是最容易被遗忘的 Linux 命令行技巧之一，因为我们许多人都会使用另外一个类命令的 screen 环境：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8e6ac97ad36188d5a566a851d1e2c8c5.png\"></p>\n<p>这样会在同一个目录下生成一个名称为 nohup.out 的文件，其中包含了正在运行的程序的输出内容：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/73f4a9d25594c685db6714ee46d96810.png\"></p>\n<p>命令很酷，对吧？</p>\n<h3>自动对任何命令回答 Yes 或者 No</h3>\n<p>如果你想自动化需要向用户说的 Yes 的过程，可以使用 yes 命令来实现：yes | apt-get update。</p>\n<p>也许你想做的是自动地说“No”。这个可以使用 yes no | 命令来实现。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9d3ada6e55c6b9738b0dc40667db4c50.png\"></p>\n<h3>创建具有指定大小的文件</h3>\n<p>可以使用 dd 命令来创建出具有指定大小的文件：dd if=/dev/zero of=out.txt bs=1M count=10。</p>\n<p>这样就会创建出一个 10 MB 的文件，填充零作为内容：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/caf1d4163993de8e51e0eb04e45c59d6.png\"></p>\n<h3>以根目录用户来运行最后一个命令</h3>\n<p>有时，你会忘记在需要 root 权限的命令之前敲入 sudo。这时候你没必要去重写命令; 只要输入 sudo 就行了！</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/1f79f8f42fcd5f08552b17cc3398d258.png\"></p>\n<h3>对命令行会话进行记录</h3>\n<p>如果想要把自己在 shell 屏幕上敲的内容记录下来，可以使用 script 命令将所有敲写的内容保存到一个名为 typescriptscript 的文件中去。</p>\n<p>等你敲入 exit 命令以后，所有命令就都会被写入该文件，以便你事后再回过头去查看。</p>\n<h3>用标签符号替换空格符</h3>\n<p>可以使用 tr 命令替换任何字符，这个用起来非常方便：cat geeks.txt | tr ‘:[space]:’ ‘\\t’ &gt; out.txt.</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7dcc5cc23045ed18fd3ed993c3065028.png\"></p>\n<h3>将文件内容转换为大写或者小写</h3>\n<p>可以这样实现：cat myfile | tr a-z A-Z&gt; output.txt。</p>\n<h3>强大的 Xargs 命令</h3>\n<p>xargs 命令是最重要的 Linux 命令行技巧之一。你可以使用这个命令将命令的输出作为参数传递给另一个命令。例如，搜索 png 文件然后对其进行压缩或者其它操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8e2fc370f755190224\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind. -name *.png -type f -print | xargs tar -cvzf images.tar.gz</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8e2fc370f755190224-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8e2fc370f755190224-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">.</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span> <span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">png</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span> <span class=\"crayon-i\">f</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">print</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">xargs</span> <span class=\"crayon-i\">tar</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">cvzf</span> <span class=\"crayon-v\">images</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">gz</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>又或者你的文件中有一个 URL 的列表，而你想要做的是以不同的方式下载或者处理这些 URL，可以这样做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8e2fc3713366387569\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat urls.txt | xargs wget</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8e2fc3713366387569-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8e2fc3713366387569-1\"><span class=\"crayon-i\">cat</span> <span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">xargs</span> <span class=\"crayon-v\">wget</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/219b583b1bb3cac2c59130e9bb7e62bf.png\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/fc0b4e63f0d1e1009371efcca207fb23.png\" alt=\"xargs command\" width=\"881\" height=\"119\"></p>\n<p>请你要记得，第一个命令的输出会在 xargs 命令结尾处传递。</p>\n<p>那如果命令需要中间过程的输出，该怎么办呢？这个简单！</p>\n<p>只需要使用 {} 并结合 -i 参数就行了。如下所示，替换在第一个命令的输出应该去的地方的参数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8e2fc3716863993726\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls /etc/*.conf | xargs -i cp {} /home/likegeeks/Desktop/out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8e2fc3716863993726-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8e2fc3716863993726-1\"><span class=\"crayon-i\">ls</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">conf</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-e\">xargs</span> <span class=\"crayon-o\">-</span><span class=\"crayon-e\">i</span> <span class=\"crayon-e\">cp</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">likegeeks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这只是 Linux 命令行技巧其中的几个而已。你可以使用其他命令来做一些更 HAPPY 的事情，比如 awk 命令和 sed 命令！</p>\n<p>如果你知道一些我在这里没有提到的任何其它的极客命令，欢迎评论。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112265\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112265votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112265\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/24", "fav_nums": 1, "tags": "IT技术,Linux", "url": "http://blog.jobbole.com/112265/", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg", "praise_nums": "1", "title": "最实用的 Linux 命令行使用技巧", "comment_nums": 1}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/fd582ce02602d145acd4982f8b868c92.png"], "url_object_id": "697cda33f7258dcfabbacb139fb85b20", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/Tan-sir/p/7272652.html\">目不识丁</a>   </div><h2>1.1从Hello World说起</h2>\n<p>目的：从最基本的编译，静态链接到操作系统如何转载程序，动态链接及运行库和标准库的实现，和一些操作系统的机制。了解计算机上程序运行的一个基本脉络。</p>\n<h2>1.2变不离其宗</h2>\n<p>计算机最关键的三个部分：CPU,内存,I/O控制芯片。</p>\n<ul>\n<li>早期的计算机：没有复杂的图形功能，CPU和内存频率一样，都连接在同一个总线上。</li>\n<li>CPU频率提升：内存跟不上CPU，产生了和内存频率一致的系统总线，CPU使用倍频的方式和总线通信。</li>\n<li>图形界面的出现：图形芯片需要和内存和CPU大量交换数据，慢速的I/O总线无法满足图形设备的巨大需求。为了高效处理数据，设计了一个高速的北桥芯片。后来有设计处理低速处理设备南桥芯片，磁盘，USB，键盘都是连接在南桥上。在由南桥将它们汇总到北桥上。</li>\n</ul>\n<h5><strong>北桥</strong></h5>\n<ul>\n<li>北桥左边CPU和cache：CPU负责所有控制和运算。</li>\n<li>北桥下面PCI总线</li>\n<li>北桥右边memory</li>\n</ul>\n<h5>SMP和多核</h5>\n<p>现在CPU已经达到物理极限，被4GHz所限制，于是，开始通过增加CPU数量来提高计算机速度。<br>\n<strong>对称多处理器（SMP）</strong>：最常见的一种形式。每个CPU在系统中所处的地位和所发挥的功能是一样，是相互对称的。但在处理程序时，我们并不能把他们分成若干个不相干的子问题，所以，使得多处理器速度实际提高得并没有理论上那么高。当对于相互独立的问题，多处理器就能最大效能的发挥威力了（比如：大型数据库,网络服务等）。<br>\n对处理器由于造价比较高昂，主要用在商用电脑上，对于个人电脑，主要是<strong>多核处理器</strong>。<br>\n多核处理器：其实际上是(SMP)的简化版，思想是将多个处理器合并在一起打包出售，它们之间共享比较昂贵的缓存部件，只保留了多个核心。在逻辑上看，它们和SMP完全相同。</p>\n<h2>1.3站得高,看得远</h2>\n<p><strong>系统软件</strong>：一般用于管理计算机本地的软件。</p>\n<p>主要分为两块：</p>\n<ul>\n<li>平台性的：操作系统内核，驱动程序，运行库。</li>\n<li>程序开发：编译器，汇编器，链接器。</li>\n</ul>\n<p>计算机系统软件体系结构采用一种<strong>层</strong>的结构。<br>\n每个层次之间都需要相互通信，那么它们之间就有通信协议，我们将它称为接口，接口下层是提供者，定义接口。上层是使用者，使用接口实现所需功能。<br>\n除了硬件和应用程序，其他的都是中间层，每个中间层都是对它下面的那层的包装和扩展。它们使得应用程序和硬件之间保持相对独立。<br>\n从整个层次结构来看，开发工具与应用程序属于同一个层次，因为它们都使用同一个接口—操作系统<strong>应用程序编程接口</strong>。应用程序接口提供者是运行库，什么样的运行库提供什么样的接口。winsows的运行库提供Windows API，Linux下的Gliba库提供POSIX的API。<br>\n运行库使用操作系统提供的<strong>系统调用接口</strong>。<br>\n系统调用接口在实现中往往以<strong>软件中断</strong>的方式提供。<br>\n操作系统内核层对于硬件层来说是硬件接口的使用者，而硬件是接口的定义者。这种接口叫做<strong>硬件规格</strong>。</p>\n<h2>1.4操作系统做了什么</h2>\n<p>操作系统的一个功能是提供抽象的接口，另外一个主要功能是管理硬件资源。<br>\n一个计算机中的资源主要分CPU,存储器（包括内存和磁盘）和I/O设备。下面从这3个方面来看如何挖机它们。</p>\n<h3>1.4.1不要让CPU打盹</h3>\n<p><strong>多道程序</strong>：编译一个监控程序，当程序不需要使用CPU时，将其他在等待CPU的程序启动。但它的弊端是不分轻重缓急，有时候一个交互操作可能要等待数十分钟。<br>\n改进后<br>\n<strong>分时系统</strong>：每个CPU运行一段时间后，就主动让出给其他CPU使用。完整的操作系统雏形在此时开始出现。但当一个程序死机的时候，无法主动让出CPU，那么，整个系统都无法响应。<br>\n目前操作系统采用的方式<br>\n<strong>多任务系统</strong>：操作系统接管了所有的硬件资源，并且本身运行在一个受硬件保护的级别。所有的应用都以<strong>进程</strong>的方式运行在比操作系统更低的级别，每个进程都有自己独立的地址空间，使得进程之间的地址空间相互隔离。CPU由操作系统进行同一分配，每个进程根据进程优先级的高低都有机会获得CPU，但如果运行超过一定的时间，CPU会将资源分配给其他进程，这种CPU分配方式是<strong>抢占式</strong>。如果操作系统分配每个进程的时间很短，就会造成很多进程都在同时运行的假象，即所谓的<strong>宏观并行，微观串行</strong>。</p>\n<h5><a name=\"%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8\"></a>设备驱动</h5>\n<p>操作系统作为硬件层的上层，它是对硬件的管理和抽象。<br>\n对于操作系统上面的运行库和应用程序来说，它们只希望看到一个统一的硬件访问模式。<br>\n当成熟的操作系统出现后，硬件逐渐成了抽象的概念。在UNIX中，硬件设备的访问形式和访问普通的文件形式一样。在Windows系统中，图形硬件被抽象成GDI，声音和多媒体设备被抽象成DirectX对象，磁盘被抽象成普通文件系统。<br>\n这些繁琐的硬件细节全都交给了操作系统中的硬件驱动。<br>\n文件系统管理这磁盘的存储方式。<br>\n<strong>磁盘的结构</strong>：一个硬盘往往有多个盘片，每个盘片分两面，每面按照同心圆划分为若干磁道，每个磁道划分为若干扇区，每个扇区一般512字节。<br>\n<strong>LBA</strong>：整个硬盘中所有扇区从0开始编号，一直到最后一个扇区，这个扇区编号叫做<strong>逻辑扇区号</strong>。<br>\n文件系统保存了这些文件的存储结构，负责维护这些数据结构并且保证磁盘中的扇区能有效的组织和利用。</p>\n<h2>1.5内存不够怎么办</h2>\n<p>在早期计算机中，程序是直接运行在物理内存上的，程序所访问的都是物理地址。<br>\n那么如何将计算机有限的地址分配给多个程序使用。<br>\n直接按物理内存分配将产生很多问题：</p>\n<ul>\n<li><strong>地址空间不隔离</strong>：所有的程序都直接访问物理地址，导致程序使用的物理地址不是相互隔离的，恶意的程序很容易串改其他程序的内存数据。</li>\n<li><strong>内存使用效率低</strong>：由于没有有效的内存管理机制，通常一个程序执行的时候，监控程序要将整个程序读入。内存不够的时候，需要先将内存中的程序读出，保存在硬盘上，才能将需要运行的程序读入。这样会使得整个过程有大量数据换入换出。</li>\n<li><strong>程序运行地址不确定</strong>：每次程序运行都需要内存分配一块足够大的内存空间，使得这个地址是不确定的。但在程序编写的时候，他访问的数据和指令跳转的目标地址都是固定的，这就涉及到了程序的<strong>重定向</strong>问题。</li>\n</ul>\n<p>一种解决办法：<br>\n<strong>中间层</strong>：使用一种间接的地址访问方法，我们把程序给出的地址看作一种<strong>虚拟地址</strong>。虚拟地址是物理地址的映射，只要处理好这个过程，就可以起到隔离的作用。</p>\n<h3>1.5.1关于隔离</h3>\n<p>普通的程序它只需要一个简单的执行环境，一个单一的地址空间，有自己的CPU。<br>\n地址空间比较抽象，如果把它想象成一个数组，每一个数组是一字节，数组大小就是地址空间的长度，那么32位的地址空间大小就是2^32=4294967296字节，即4G，地址空间有效位是0x00000000~0xFFFFFFFF。<br>\n地址空间分为两种：<br>\n<strong>物理空间</strong>：就是物理内存。32位的机器，地址线就有32条，物理空间4G，但如果值装有512M的内存，那么实际有效的空间地址就是0x00000000~0x1FFFFFFF，其他部分都是无效的。<br>\n虚拟空间：每个进程都有自己独立的虚拟空间，而且每个进程只能访问自己的空间地址，这样就有效的做到了进程隔离。</p>\n<h3>1.5.2分段<a name=\"152%E5%88%86%E6%AE%B5\"></a></h3>\n<p>基本思路：把一段与程序所需要的内存空间大小的虚拟空间映射到某个地址空间。虚拟空间的每个字节对应物理空间的每个字节。这个映射过程由软件来完成。<br>\n分段的方式可以解决之前的第一个（地址空间不隔离）和第三个问题（程序运行地址不确定）<br>\n第二问题内存使用效率问题依旧没有解决。</p>\n<h3>1.5.3分页</h3>\n<p>基本方法：把地址空间人为的分成固定大小的页，每一页大小有硬件决定或硬件支持多种大小的页，由操作系统决定页的大小。<br>\n目前几乎所有的PC上的操作系统都是4KB大小的页。<br>\n我们把进程的虚拟地址空间按页分割，把常用的数据和代码页转载到内存中，把不常用的代码和数据保存到磁盘里，当需要的时候从磁盘取出来。<br>\n虚拟空间的页叫做<strong>虚拟页（VP）</strong>,物理内存中页叫做<strong>物理页</strong>，把磁盘中的页叫做<strong>磁盘页</strong>。虚拟空间的有的页被映射到同一个物理页，这样就可以实现内存共享。<br>\n当进程需要一个页时，这个页是磁盘页时，硬件会捕获到这个消息，就是所谓的<strong>页错误</strong>，然后操作系统接管进程，负责从磁盘中读取内容装入内存中，然后再将内存和这个页建立映射关系。<br>\n<strong>保护</strong>也是页映射的目的之一，每个页都可以设置权限属性，只有操作系统可以修改这些属性，这样操作系统就可以保护自己保护进程。<br>\n<strong>虚拟存储</strong>的实现需要依靠硬件支持，所有硬件都采用一个叫做MMU的部件来进行页映射。<br>\nCPU发出虚拟地址经过MMU转换成物理地址，MMU一般都集成在CPU内部。</p>\n<h2>1.6众人拾柴火焰高</h2>\n<h3>1.6.1线程基础<a name=\"161%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80\"></a></h3>\n<p>多线程现在作为实现软件并发执行的一个重要方法，具有越来越重的地位。</p>\n<h5><a name=\"%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B\"></a>什么是线程</h5>\n<p><strong>线程</strong>有时被称为轻量级的进程，是程序执行流的最小单位。</p>\n<p>构成：</p>\n<ul>\n<li>线程ID</li>\n<li>当前指令指针</li>\n<li>寄存器集合</li>\n<li>堆栈空间（代码段，数据段，堆）</li>\n<li>进程级的资源（打开文件和信号）</li>\n</ul>\n<p>线程与进程的关系：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/fd582ce02602d145acd4982f8b868c92.png\" alt=\"\"></p>\n<p>多线程可以互不干扰的并发执行，并共享进程的全局变量和堆的数据。<br>\n使用多线程的原因有如下几点：</p>\n<ul>\n<li>某个操作可能会陷入长时间等待，等待的线程会进入睡眠状态，无法继续执行。</li>\n<li>某个操作会消耗大量的时间，如果只有一个线程，程序和用户之间的交互会中断。</li>\n<li>程序逻辑本身就要求并发操作。</li>\n<li>多CPU或多核计算机，本身具备同时执行多个线程的能力。</li>\n<li>相对于多进程应用，多线程在数据共享方面效率要高很多。</li>\n</ul>\n<h5><a name=\"%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90\"></a>线程的访问权限</h5>\n<p>线程的访问非常自由，它可以访问进程内存里所有数据，包括其他线程的堆栈（如果知道地址的话，情况很少见）。<br>\n线程自己的私用存储空间：</p>\n<ul>\n<li>栈（并发完全无法被其他线程访问）</li>\n<li>线程局部存储。某些操作系统为线程提供私用空间，但容量有限。</li>\n<li>寄存器。执行流的基本数据，为线程私用。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>线程私用</th>\n<th>线程间共享（进程所有）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>局部变量</td>\n<td>全局变量</td>\n</tr>\n<tr>\n<td>函数参数</td>\n<td>堆上数据</td>\n</tr>\n<tr>\n<td>TLS数据</td>\n<td>函数里的静态变量</td>\n</tr>\n<tr>\n<td></td>\n<td>程序代码</td>\n</tr>\n<tr>\n<td></td>\n<td>打开的文件，A线程打开的文件可以由B线程读取</td>\n</tr>\n</tbody>\n</table>\n<h5><a name=\"%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6%E4%B8%8E%E4%BC%98%E5%85%88%E7%BA%A7\"></a>线程调度与优先级</h5>\n<p>不论在多处理器还是单处理器上，线程都是“并发”的。<br>\n线程数量小于处理器数量时，是真正并发的。<br>\n单处理器下，并发是模拟的，操作系统会让这些多线程程序轮流执行，每次都只执行一小段时间，这就称为<strong>线程调度</strong>。<br>\n线程调度中，线程拥有三种状态：</p>\n<ul>\n<li>运行：线程正在执行</li>\n<li>就绪：线程可以立刻运行，但CPU被占用</li>\n<li>等待：线程正在等待某一事件发生，无法立即执行。</li>\n</ul>\n<p>处于运行中的线程拥有一段可以执行的时间，这称为<strong>时间片</strong>，当时间片用尽的时候，进程进入就绪状态，如果在用尽之前开始等待某事件，那么它就进入等待状态。每当一个线程离开运行状态的时候，调度系统就会选择一个其他的就绪线程继续执行。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/98d32af045fd36e5fc3477f9fe4a2758.png\" alt=\"\"></p>\n<p>现在的主流调度方法尽管都不一样，但基本都带有<strong>优先级调度</strong>和<strong>轮转法</strong>。<br>\n轮转法：各个线程轮流执行一段时间。<br>\n优先级调度：按线程的优先级来轮流执行，每个线程都拥有各自的线程优先级。<br>\n在win和lin里面，线程优先级不仅可以由用户手动设置，系统还会根据不同线程表现自动调整优先级。<br>\n一般频繁等待的线程称之为<strong>IO密集型线程</strong>，而把很少等待的线程称为<strong>CPU密集型线程</strong>。<br>\n优先级调度下，存在一种<strong>饿死</strong>现象。<br>\n饿死：线程优先级较低，在它执行之前，总是有较高级的线程要执行，所以，低优先级线程总是无法执行的。<br>\n当一个CPU密集型线程获得较高优先级时，许多低优先级线程就可能被饿死。<br>\n为了避免饿死，操作系统常常会逐步提升那些等待时间过长的线程。<br>\n线程优先级改变一般有三种方式：</p>\n<ul>\n<li>用户指定优先级</li>\n<li>根据进入等待状态的频繁程度提升或降低优先级</li>\n<li>长时间得不到执行而被提升优先级</li>\n</ul>\n<h5><a name=\"%E5%8F%AF%E6%8A%A2%E5%8D%A0%E7%BA%BF%E7%A8%8B%E5%92%8C%E4%B8%8D%E5%8F%AF%E6%8A%A2%E5%8D%A0%E7%BA%BF%E7%A8%8B\"></a>可抢占线程和不可抢占线程</h5>\n<p><strong>抢占</strong>：在线程用尽时间片之后被强制剥夺继续执行的权利，而进入就绪状态。<br>\n在早期的系统中，线程是<strong>不可抢占</strong>的，线程必须主动进入就绪状态。<br>\n在不可抢占线程中，线程主动放弃主要是2种：</p>\n<ul>\n<li>当线程试图等待某个事件（I/O）时</li>\n<li>线程主动放弃时间片</li>\n</ul>\n<p>不可抢占线程有一个好处，就是线程调度只会发生在线程主动放弃执行或线程等待某个事件的时候，这样就可以避免一些抢占式线程时间不确定而产生的问题。</p>\n<h5><a name=\"linux%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B\"></a>Linux的多线程</h5>\n<p>Linux内核中并不存在真正意义上的线程概念。Linux所有执行实体（线程和进程）都称为<strong>任务</strong>，每一个任务概念上都类似一个单线程的进程，具有内存空间，执行实体，文件资源等。Linux不同任务之间可以选择共享内存空间，相当于同一个内存空间的多个任务构成一个进程，这些任务就是进程中的线程。</p>\n<table>\n<thead>\n<tr>\n<th>系统调用</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>fork</td>\n<td>复制当前线程</td>\n</tr>\n<tr>\n<td>exec</td>\n<td>使用新的可执行映像覆盖当前可执行映像</td>\n</tr>\n<tr>\n<td>clone</td>\n<td>创建子进程并从指定位置开始执行</td>\n</tr>\n</tbody>\n</table>\n<p>fork产生新任务速度非常快，因为fork不复制原任务的内存空间，而是和原任务一起共享一个<strong>写时复制</strong>的内存空间。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4c89163b6db707d13e93ae4f5ad6fdca.png\" alt=\"\"></p>\n<p>写时复制：两个任务可以同时自由读取内存，当任意一个任务试图对内存进行修改时，内存就会复制一份单独提供给修改方使用。<br>\nfork只能够产生本任务的镜像，因此需要和exec配合才能启动别的新任务。<br>\n而如果要产生新线程，则使用clone。<br>\nclone可以产生一个新的任务，从指定位置开始执行，并且共享当前进程的内存空间和文件等，实际效果就是产生一个线程。</p>\n<h3>1.6.2线程安全</h3>\n<p>多线程程序处于一个多变的环境中，可访问的全局变量和堆数据随时都可能被其他的线程改变。因此多线程程序在并发时数据的一致性变得非常重要。</p>\n<h5><a name=\"%E7%AB%9E%E4%BA%89%E4%B8%8E%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C\"></a>竞争与原子操作</h5>\n<p>++i的实现方法：</p>\n<ul>\n<li>读取i到某个寄存器X</li>\n<li>X++</li>\n<li>将X的内容存储回i<br>\n单条指令的操作称为<strong>原子的</strong>，单挑指令的执行不会被打断。在windows里，有一套API专门进行一些原子操作，这些API称为Interlocked API。</li>\n</ul>\n<h5><a name=\"%E5%90%8C%E6%AD%A5%E4%B8%8E%E9%94%81\"></a>同步与锁</h5>\n<p>为了防止多个线程读取同一个数据产生不可预料结果，我们将各个线程对一个数据的访问同步。<br>\n<strong>同步</strong>：在一个线程对一个数据访问结束的时候，其他线程不能对同一个数据进行访问。对数据的访问被原子化。<br>\n<strong>锁</strong>：锁是一种非强制机制，每一个线程在访问数据或者资源之前会先获取锁，在访问结束后会释放锁。在锁被占用时候试图获取锁时，线程会等待，知道锁可以重新使用。<br>\n<strong>二元信号量</strong>：最简单的锁，它适合只能被唯一一个线程独占访问的资源，它的两种状态：</p>\n<ul>\n<li>非占用状态：第一个获取该二元信号量的线程会获得该锁，并将二元信号量置为占用状态，其他所有访问该二元信号量线程将会等待。</li>\n<li>占用状态</li>\n</ul>\n<p><strong>信号量</strong>：允许多个线程并发访问的资源。一个初始值为N的信号量允许N个线程并发访问。<br>\n操作如下：</p>\n<ul>\n<li>将信号量值键1</li>\n<li>如果信号量值小于0，就进入等待状态。</li>\n</ul>\n<p>访问完资源后，线程释放信号量：</p>\n<ul>\n<li>将信号量加1</li>\n<li>如果信号量的值小于1，唤醒一个等待中的线程。</li>\n</ul>\n<p><strong>互斥量</strong>：和二元信号量很类似，但和信号量不同的是：信号量在一个系统中，可以被任意线程获取或释放。互斥量要求那个线程获取互斥量，那么哪个线程就释放互斥量，其他线程释放无效。<br>\n<strong>临界区</strong>：比互斥量更加严格的手段。把临界区的锁获取称为进入临界区，而把锁的释放称为离开临界区。临界区和互斥量，信号量区别在与互斥量，信号量在系统中任意进程都是可见的。临界区的作用范围仅限于本线程，其他线程无法获取。其他性质与互斥量相同。<br>\n<strong>读写锁</strong>：致力于一种更加特定的场合的同步。如果使用之前使用的信号量、互斥量或临界区中的任何一种进行同步，对于读取频繁，而仅仅是偶尔写入的情况会显得非常低效。读写锁可以避免这个问题。对于同一个锁，读写锁有两种获取方式：</p>\n<ul>\n<li>共享的</li>\n<li>独占的</li>\n</ul>\n<p>读写锁的总结</p>\n<table>\n<thead>\n<tr>\n<th>读写锁状态</th>\n<th>以共享方式获取</th>\n<th>以独占方式获取</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>自由</td>\n<td>成功</td>\n<td>成功</td>\n</tr>\n<tr>\n<td>共享</td>\n<td>成功</td>\n<td>等待</td>\n</tr>\n<tr>\n<td>独占</td>\n<td>等待</td>\n<td>等待</td>\n</tr>\n</tbody>\n</table>\n<p><strong>条件变量</strong>：作为同步的手段，作用类似于一个栅栏。对于条件变量，线程有两个操作：</p>\n<ul>\n<li>线程可以等待条件变量，一个条件变量可以被多个线程等待</li>\n<li>线程可以唤醒条件变量，此时某个或所有等待此条件变量的线程都会被唤醒并继续支持</li>\n</ul>\n<p>使用条件变量可以让许多线程一起等待某个事件的发生，当事件发生时，所有线程可以一起恢复执行。</p>\n<h5><a name=\"%E5%8F%AF%E9%87%8D%E5%85%A5%E4%B8%8E%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8\"></a>可重入与线程安全</h5>\n<p>一个函数被重入，表示这个函数没有执行完成，由于外部因素或内部调用，又一次进入该函数执行。<br>\n一个函数要被重入，只有两种情况：</p>\n<ul>\n<li>多个线程同时执行这个函数</li>\n<li>函数自身（可能经过多层调用之后）调用自身</li>\n</ul>\n<p>一个函数被称为可重入，表示重入之后不会产生任何不良影响</p>\n<p>可重入函数：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f92d03533d559391135\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint sqr(int x) \r\n{\r\n    return x * x;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f92d03533d559391135-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03533d559391135-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03533d559391135-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03533d559391135-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f92d03533d559391135-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sqr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03533d559391135-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03533d559391135-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">x *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03533d559391135-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>一个函数要成为可重入，必须具有如下特点：</p>\n<ul>\n<li>不使用任何（局部）静态或全局的非const变量</li>\n<li>不返回任何（局部）静态或全部的非const变量的指针</li>\n<li>仅依赖调用方提供的参数</li>\n<li>不依赖任何单个资源的锁</li>\n<li>不调用任何不可重入的函数</li>\n</ul>\n<p>可重入是并发安全的强力保障，一个可重入的函数可以在多程序环境下方向使用</p>\n<h5><a name=\"%E8%BF%87%E5%BA%A6%E4%BC%98%E5%8C%96\"></a>过度优化</h5>\n<p>有时候合理的合理的使用了锁也不一定能保证线程的安全。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f92d035349601243568\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//Thread1\r\nx=0;\r\nlock();\r\nx++;\r\nunlock();\r\n//Thread2\r\nx=0;\r\nlock();\r\nx++;\r\nunlock();</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f92d035349601243568-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035349601243568-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035349601243568-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035349601243568-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035349601243568-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035349601243568-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035349601243568-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035349601243568-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035349601243568-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035349601243568-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f92d035349601243568-1\"><span class=\"crayon-c\">//Thread1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035349601243568-2\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035349601243568-3\"><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035349601243568-4\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035349601243568-5\"><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035349601243568-6\"><span class=\"crayon-c\">//Thread2</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035349601243568-7\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035349601243568-8\"><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035349601243568-9\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035349601243568-10\"><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>上面X的值应该为2，但如果编译器为了提高X的访问速度，把X放到了某个寄存器里面，不同线程的寄存器是各自独立的，因此，如果Thread1先获得锁，则程序的执行可能会呈现如下：<br>\n[Thread1]读取x的值到某个寄存器R [1] (R[1]=0);<br>\n[Thread1]R[1]++(由于之后可能要访问到x,所以Thread1暂时不将R[1]写回x);<br>\n[Thread2]读取x的值到某个寄存器R[2] (R[2]=0);<br>\n[Thread2]R[2]++(R[2]=1);<br>\n[Thread2]将R[2]写回至x(x=1);<br>\n[Thread1] (很久以后)将R[1]写回至x(x=1);<br>\n如果这样，即使加锁也不能保证线程安全</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f92d03534f911411212\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nx=y=0;\r\n//Thread1\r\nx=1;\r\nr1=y;\r\n//Thread2\r\ny=1;\r\nr2=x;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f92d03534f911411212-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03534f911411212-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03534f911411212-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03534f911411212-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03534f911411212-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03534f911411212-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03534f911411212-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f92d03534f911411212-1\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03534f911411212-2\"><span class=\"crayon-c\">//Thread1</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03534f911411212-3\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03534f911411212-4\"><span class=\"crayon-v\">r1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03534f911411212-5\"><span class=\"crayon-c\">//Thread2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03534f911411212-6\"><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03534f911411212-7\"><span class=\"crayon-v\">r2</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>上面代码有可能发生r1=r2=0的情况。<br>\n<strong>CPU动态调度</strong>：在执行程序的时候，为了提高效率有可能交换指令的顺序。<br>\n编译器在进行优化的时候，也可能为了效率交换两个毫不相干的相邻指令的执行顺序。<br>\n上面代码执行顺序可能是这样：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f92d035352944041113\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nx=y=0;\r\n[Thread1]\r\nr1=y;\r\nx=1;\r\n[Thread2]\r\ny=1;\r\nr2=x;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f92d035352944041113-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035352944041113-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035352944041113-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035352944041113-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035352944041113-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035352944041113-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035352944041113-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f92d035352944041113-1\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035352944041113-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Thread1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035352944041113-3\"><span class=\"crayon-v\">r1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035352944041113-4\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035352944041113-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Thread2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035352944041113-6\"><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035352944041113-7\"><span class=\"crayon-v\">r2</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>使用volatile关键字可以阻止过度优化，colatile可以做两件事情：</p>\n<ul>\n<li>阻止编译器为了提高速度将一个变量缓存到寄存器内而不写回</li>\n<li>阻止编译器调整操作volatile变量的指令顺序</li>\n</ul>\n<p>但volatile无法阻止CPU动态调度换序<br>\nC++中，单例模式。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f92d035356309425908\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C++</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvolatile T * pInst = 0;\r\nT * GetInstance() \r\n{\r\n    if (pInst == NULL) \r\n    {\r\n        LOCK();\r\n        if (pInst == NULL)\r\n            pInst = new T;\r\n        unlock();\r\n    }\r\n    return pInst;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f92d035356309425908-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035356309425908-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035356309425908-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035356309425908-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035356309425908-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035356309425908-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035356309425908-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035356309425908-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035356309425908-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035356309425908-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f92d035356309425908-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d035356309425908-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f92d035356309425908-1\"><span class=\"crayon-m\">volatile</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035356309425908-2\"><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f92d035356309425908-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035356309425908-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f92d035356309425908-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035356309425908-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">LOCK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035356309425908-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035356309425908-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035356309425908-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035356309425908-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f92d035356309425908-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d035356309425908-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</div>\n<p>CPU的乱序执行可能会对上面代码照成影响<br>\nC++里的new包含两个步骤：</p>\n<ul>\n<li>分配内存</li>\n<li>调用构造函数</li>\n</ul>\n<p>所以pInst=new T包含三个步骤：</p>\n<ul>\n<li>分配内存</li>\n<li>在内存的位置上调用构造函数</li>\n<li>将内存的地址赋值给pInst</li>\n</ul>\n<p>这三步中2和3的步骤可以颠倒，可能出现这种情况：pInst中的值不是NULL，但对象还是没有构造完成。<br>\n要阻止CPU换序，可以调用一条指令，这条指令常常被称为barrier：它会阻止CPU将该指令之前的指令交换到barrier之后。<br>\n许多体系的CPU都提供了barrier指令，不过，它们的名称各不相同。例如POWERPC提供的指令就叫做lwsync。所以我们可以这样保证线程安全：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f92d03535a248843442\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C++</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define barrier() __asm__ volatile(\"lwsync\")\r\nvolatile T * pInst = 0;\r\nT * GetInstance()\r\n{\r\n    if (pInst == NULL) \r\n    {\r\n        LOCK();\r\n        if (pInst == NULL) \r\n        {\r\n            T * temp = new T;\r\n            barrier();\r\n            pInst = temp;\r\n        }\r\n        unlock();\r\n    }\r\n    return pInst;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f92d03535a248843442-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03535a248843442-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03535a248843442-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03535a248843442-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03535a248843442-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03535a248843442-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03535a248843442-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03535a248843442-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03535a248843442-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03535a248843442-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03535a248843442-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03535a248843442-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03535a248843442-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03535a248843442-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03535a248843442-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f92d03535a248843442-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f92d03535a248843442-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f92d03535a248843442-1\"><span class=\"crayon-p\">#define barrier() __asm__ volatile(\"lwsync\")</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03535a248843442-2\"><span class=\"crayon-m\">volatile</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03535a248843442-3\"><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03535a248843442-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03535a248843442-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03535a248843442-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03535a248843442-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">LOCK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03535a248843442-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f92d03535a248843442-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03535a248843442-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03535a248843442-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">barrier</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03535a248843442-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03535a248843442-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03535a248843442-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03535a248843442-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f92d03535a248843442-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f92d03535a248843442-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n\n</div>\n<h3>1.6.3多线程的内部情况</h3>\n<p>线程的并发执行是由多处理器或操作系统调度来实现的。windows和linux都在内核中提供线程支持，有多处理器或调度来实现并发。用户实际使用线程并不是内核线程，而是存在于用户态的用户线程。用户线程并不一定在操作系统内核里对应同等数量的内核线程。对用户来说，如果有三个线程同时执行，可能在内核中只有一个线程。</p>\n<h5><a name=\"%E4%B8%80%E5%AF%B9%E4%B8%80%E6%A8%A1%E5%9E%8B\"></a>一对一模型</h5>\n<p>对于直接支持线程的系统，一对一模型始终是最为简单的模型。一个用户使用的线程就唯一对应一个内核使用的线程，但返回来，一个内核里面的线程在用户态不一定有对应的线程存在。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a5b98d84c57ecfa88795e674e4a711ec.png\" alt=\"\"></p>\n<p>对于一对一模型，线程之间的并发是真正的并发，一个线程因为某个原因阻塞，并不会影响到其他线程。一对一模型也可以让多线程程序在多处理器的系统上有更好的表现。<br>\n一般直接使用API或者系统调用创建的线程均为一对一线程。<br>\n一对一线程的两个缺点：</p>\n<ul>\n<li>由于许多操作系统限制了内核线程数量，因此一对一线程会让用户的线程数量受到限制。</li>\n<li>许多操作系统内核线程调度是，上下文切换的开销较大，导致用户线程的执行效率下降。</li>\n</ul>\n<h5><a name=\"%E5%A4%9A%E5%AF%B9%E4%B8%80%E6%A8%A1%E5%9E%8B\"></a>多对一模型</h5>\n<p>多对一模型将多个用户线程映射到一个内核线程上，线程之间的切换由用户态的代码来进行，相对于一对一模型，多对一模型的线程切换要快速许多。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a464ae600296b61c454403e9cab160b.png\" alt=\"\"></p>\n<p>多对一模型的问题就是如果一个用户线程阻塞了，那么所有的线程都将无法执行。在多处理系统上，处理器的增多对多对一模型的线程性能不会有明显帮助。多对一模型得到的好处是高效的上下文切换和几乎无限制的线程数量。</p>\n<h5><a name=\"%E5%A4%9A%E5%AF%B9%E5%A4%9A%E6%A8%A1%E5%9E%8B\"></a>多对多模型</h5>\n<p>多对多模型结合了多对一和一对一的特点，将多个用户线程映射到少数但不止一个内核线程上。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/88cf46ce05bf777caef1b92def4dca9d.png\" alt=\"\"></p>\n<p>一个用户线程阻塞并不会使得所有的用户线程阻塞。并且对用户线程数量也没有什么限制，在多处理器系统上，多对多模型的线程也能得到一定的性能提升，不过提升的幅度没有一对一模型高。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112161\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112161votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112161\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 13 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/11", "fav_nums": 3, "tags": "职场,程序员", "url": "http://blog.jobbole.com/112161/", "front_image_path": "full/b019444f07f74231bdbf3445811ed2d3e5e85724.jpg", "praise_nums": "2", "title": "程序员的自我修养：温故而知新", "comment_nums": 3}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/dbe885c03af6141ab8f7f68f5778895d.png"], "url_object_id": "ce3a7725a878dcf107e5503031e8e276", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://unsupervisedmethods.com/over-150-of-the-best-machine-learning-nlp-and-python-tutorials-ive-found-ffce2939bd78\">Robbie Allen</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>机器学习已经发展了很久，它的<a href=\"https://en.wikipedia.org/wiki/Machine_learning#History_and_relationships_to_other_fields\" target=\"_blank\" rel=\"external\">历史</a>可以追溯到1959年，但是如今此领域的发展速度可以说是空前的。在最近的几篇文章中，我讨论了人工智能领域为何会在现在以及不久的将来持续蓬勃发展。如今很多对机器学习感兴趣的同学都普遍表示入门很难。</p>\n<p>在准备博士课题的期间，我尝试在网络上搜索与机器学习和自然语言处理相关的优秀资源。当我找了一个有趣的教程或者视频，从这个教程或者视频出发我又可以找到三四个更多的教程或视频，最终就会出现的画面就是我还没有开始认真研究第一个找到的教程，浏览器已经打开了 20 个标签等待我去浏览了。（注: <a href=\"https://www.tabbundler.com/\" target=\"_blank\" rel=\"external\">Tab Bundler</a> 可以帮助让我们的标签更有条理）。</p>\n<p>在找到了超过 25 个与机器学习相关的速查表后，<a href=\"http://blog.jobbole.com/112009/\" target=\"_blank\">我写了篇文章, 在里面整理了所有优秀的速查表</a>。</p>\n<p>为了给后面学习的童鞋铺路，我将我找到的最好的一些教程内容整理成了一份列表。这份列表并没有包含所有网上能找到的与机器学习相关的教程，否则这份列表将会过于臃肿。我的目标就是将我在机器学习和自然语言处理领域各个方面找到的我认为最好的教程整理出来。</p>\n<p>在教程中，为了能够更好的让读者理解其中的概念，我将避免罗列书中每章的详细内容，而是总结一些概念性的介绍内容。为什么不直接去买本书？当你想要对某些特定的主题或者不同方面进行了初步了解时，我相信这些教程对你可能帮助更大。</p>\n<p>本文中我将分四个主题进行整理：机器学习、自然语言处理、Python 和数学。在每个主题中我将包含一个例子和多个资源。当然我不可能完全覆盖所有的主题啦。</p>\n<p>在将来，我也将会整理一系列类似的资源列表，包括书籍，视频和代码项目等。因为我目前也的确正在编译这些资源。</p>\n<p>如果你发现我在这里遗漏了好的教程资源，请联系告诉我。为了避免资源重复罗列，我在每个主题下只列出了5、6个教程。下面的每个链接都应该链接了和其他链接不同的资源，也会通过不同的方式（例如幻灯片代码段)或者不同的角度呈现出这些内容。</p>\n<h3 id=\"机器学习\">机器学习</h3>\n<ul>\n<li><a href=\"https://medium.com/@ageitgey/machine-learning-is-fun-80ea3ec3c471\" target=\"_blank\" rel=\"external\">Machine Learning is Fun!</a> (medium.com/@ageitgey)</li>\n<li>Machine Learning Crash Course: <a href=\"https://ml.berkeley.edu/blog/2016/11/06/tutorial-1/\" target=\"_blank\" rel=\"external\">Part I</a>, <a href=\"https://ml.berkeley.edu/blog/2016/12/24/tutorial-2/\" target=\"_blank\" rel=\"external\">Part II</a>, <a href=\"https://ml.berkeley.edu/blog/2017/02/04/tutorial-3/\" target=\"_blank\" rel=\"external\">Part III</a> (Machine Learning at Berkeley)</li>\n<li><a href=\"https://www.toptal.com/machine-learning/machine-learning-theory-an-introductory-primer\" target=\"_blank\" rel=\"external\">An Introduction to Machine Learning Theory and Its Applications: A Visual Tutorial with Examples</a>(toptal.com)</li>\n<li><a href=\"https://monkeylearn.com/blog/a-gentle-guide-to-machine-learning/\" target=\"_blank\" rel=\"external\">A Gentle Guide to Machine Learning</a> (monkeylearn.com)</li>\n<li><a href=\"https://blogs.sas.com/content/subconsciousmusings/2017/04/12/machine-learning-algorithm-use/\" target=\"_blank\" rel=\"external\">Which machine learning algorithm should I use?</a> (sas.com)</li>\n</ul>\n<h4 id=\"激活函数和损失函数\">激活函数和损失函数</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap1.html#sigmoid_neurons\" target=\"_blank\" rel=\"external\">Sigmoid neurons</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"https://www.quora.com/What-is-the-role-of-the-activation-function-in-a-neural-network\" target=\"_blank\" rel=\"external\">What is the role of the activation function in a neural network?</a> (quora.com)</li>\n<li><a href=\"https://stats.stackexchange.com/questions/115258/comprehensive-list-of-activation-functions-in-neural-networks-with-pros-cons\" target=\"_blank\" rel=\"external\">Comprehensive list of activation functions in neural networks with pros/cons</a> (stats.stackexchange.com)</li>\n<li><a href=\"https://medium.com/towards-data-science/activation-functions-and-its-types-which-is-better-a9a5310cc8f\" target=\"_blank\" rel=\"external\">Activation functions and it’s types-Which is better?</a> (medium.com)</li>\n<li><a href=\"http://www.exegetic.biz/blog/2015/12/making-sense-logarithmic-loss/\" target=\"_blank\" rel=\"external\">Making Sense of Logarithmic Loss</a> (exegetic.biz)</li>\n<li><a href=\"http://cs231n.github.io/neural-networks-2/#losses\" target=\"_blank\" rel=\"external\">Loss Functions</a> (Stanford CS231n)</li>\n<li><a href=\"http://rishy.github.io/ml/2015/07/28/l1-vs-l2-loss/\" target=\"_blank\" rel=\"external\">L1 vs. L2 Loss function</a> (rishy.github.io)</li>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap3.html#the_cross-entropy_cost_function\" target=\"_blank\" rel=\"external\">The cross-entropy cost function</a> (neuralnetworksanddeeplearning.com)</li>\n</ul>\n<h4 id=\"偏差\">偏差</h4>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/2480650/role-of-bias-in-neural-networks/2499936#2499936\" target=\"_blank\" rel=\"external\">Role of Bias in Neural Networks</a> (stackoverflow.com)</li>\n<li><a href=\"http://makeyourownneuralnetwork.blogspot.com/2016/06/bias-nodes-in-neural-networks.html\" target=\"_blank\" rel=\"external\">Bias Nodes in Neural Networks</a> (makeyourownneuralnetwork.blogspot.com)</li>\n<li><a href=\"https://www.quora.com/What-is-bias-in-artificial-neural-network\" target=\"_blank\" rel=\"external\">What is bias in artificial neural network?</a> (quora.com)</li>\n</ul>\n<h4 id=\"感知器\">感知器</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap1.html#perceptrons\" target=\"_blank\" rel=\"external\">Perceptrons</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"http://natureofcode.com/book/chapter-10-neural-networks/#chapter10_figure3\" target=\"_blank\" rel=\"external\">The Perception</a> (natureofcode.com)</li>\n<li><a href=\"http://computing.dcu.ie/~humphrys/Notes/Neural/single.neural.html\" target=\"_blank\" rel=\"external\">Single-layer Neural Networks (Perceptrons)</a> (dcu.ie)</li>\n<li><a href=\"https://www.toptal.com/machine-learning/an-introduction-to-deep-learning-from-perceptrons-to-deep-networks\" target=\"_blank\" rel=\"external\">From Perceptrons to Deep Networks</a> (toptal.com)</li>\n</ul>\n<h4 id=\"回归\">回归</h4>\n<ul>\n<li><a href=\"http://people.duke.edu/~rnau/regintro.htm\" target=\"_blank\" rel=\"external\">Introduction to linear regression analysis</a> (duke.edu)</li>\n<li><a href=\"http://ufldl.stanford.edu/tutorial/supervised/LinearRegression/\" target=\"_blank\" rel=\"external\">Linear Regression</a> (ufldl.stanford.edu)</li>\n<li><a href=\"http://ml-cheatsheet.readthedocs.io/en/latest/linear_regression.html\" target=\"_blank\" rel=\"external\">Linear Regression</a> (readthedocs.io)</li>\n<li><a href=\"http://ml-cheatsheet.readthedocs.io/en/latest/logistic_regression.html\" target=\"_blank\" rel=\"external\">Logistic Regression</a> (readthedocs.io)</li>\n<li><a href=\"http://machinelearningmastery.com/simple-linear-regression-tutorial-for-machine-learning/\" target=\"_blank\" rel=\"external\">Simple Linear Regression Tutorial for Machine Learning</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://machinelearningmastery.com/logistic-regression-tutorial-for-machine-learning/\" target=\"_blank\" rel=\"external\">Logistic Regression Tutorial for Machine Learning</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://ufldl.stanford.edu/tutorial/supervised/SoftmaxRegression/\" target=\"_blank\" rel=\"external\">Softmax Regression</a> (ufldl.stanford.edu)</li>\n</ul>\n<h4 id=\"梯度下降\">梯度下降</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap1.html#learning_with_gradient_descent\" target=\"_blank\" rel=\"external\">Learning with gradient descent</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"http://iamtrask.github.io/2015/07/27/python-network-part2/\" target=\"_blank\" rel=\"external\">Gradient Descent</a> (iamtrask.github.io)</li>\n<li><a href=\"http://www.kdnuggets.com/2017/04/simple-understand-gradient-descent-algorithm.html\" target=\"_blank\" rel=\"external\">How to understand Gradient Descent algorithm</a> (kdnuggets.com)</li>\n<li><a href=\"http://sebastianruder.com/optimizing-gradient-descent/\" target=\"_blank\" rel=\"external\">An overview of gradient descent optimization algorithms</a> (sebastianruder.com)</li>\n<li><a href=\"http://cs231n.github.io/optimization-1/\" target=\"_blank\" rel=\"external\">Optimization: Stochastic Gradient Descent</a> (Stanford CS231n)</li>\n</ul>\n<h4 id=\"生成学习\">生成学习</h4>\n<ul>\n<li><a href=\"http://cs229.stanford.edu/notes/cs229-notes2.pdf\" target=\"_blank\" rel=\"external\">Generative Learning Algorithms</a> (Stanford CS229)</li>\n<li><a href=\"https://monkeylearn.com/blog/practical-explanation-naive-bayes-classifier/\" target=\"_blank\" rel=\"external\">A practical explanation of a Naive Bayes classifier</a> (monkeylearn.com)</li>\n</ul>\n<h4 id=\"支持向量机\">支持向量机</h4>\n<ul>\n<li><a href=\"https://monkeylearn.com/blog/introduction-to-support-vector-machines-svm/\" target=\"_blank\" rel=\"external\">An introduction to Support Vector Machines (SVM)</a> (monkeylearn.com)</li>\n<li><a href=\"http://cs229.stanford.edu/notes/cs229-notes3.pdf\" target=\"_blank\" rel=\"external\">Support Vector Machines</a> (Stanford CS229)</li>\n<li><a href=\"http://cs231n.github.io/linear-classify/\" target=\"_blank\" rel=\"external\">Linear classification: Support Vector Machine, Softmax</a> (Stanford 231n)</li>\n</ul>\n<h4 id=\"反向传播\">反向传播</h4>\n<ul>\n<li><a href=\"https://medium.com/@karpathy/yes-you-should-understand-backprop-e2f06eab496b\" target=\"_blank\" rel=\"external\">Yes you should understand backprop</a> (medium.com/@karpathy)</li>\n<li><a href=\"https://github.com/rasbt/python-machine-learning-book/blob/master/faq/visual-backpropagation.md\" target=\"_blank\" rel=\"external\">Can you give a visual explanation for the back propagation algorithm for neural networks?</a>(github.com/rasbt)</li>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap2.html\" target=\"_blank\" rel=\"external\">How the backpropagation algorithm works</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"http://www.wildml.com/2015/10/recurrent-neural-networks-tutorial-part-3-backpropagation-through-time-and-vanishing-gradients/\" target=\"_blank\" rel=\"external\">Backpropagation Through Time and Vanishing Gradients</a> (wildml.com)</li>\n<li><a href=\"http://machinelearningmastery.com/gentle-introduction-backpropagation-time/\" target=\"_blank\" rel=\"external\">A Gentle Introduction to Backpropagation Through Time</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://cs231n.github.io/optimization-2/\" target=\"_blank\" rel=\"external\">Backpropagation, Intuitions</a> (Stanford CS231n)</li>\n</ul>\n<h4 id=\"深度学习\">深度学习</h4>\n<ul>\n<li><a href=\"http://nikhilbuduma.com/2014/12/29/deep-learning-in-a-nutshell/\" target=\"_blank\" rel=\"external\">Deep Learning in a Nutshell</a> (nikhilbuduma.com)</li>\n<li><a href=\"http://ai.stanford.edu/~quocle/tutorial1.pdf\" target=\"_blank\" rel=\"external\">A Tutorial on Deep Learning</a> (Quoc V. Le)</li>\n<li><a href=\"http://machinelearningmastery.com/what-is-deep-learning/\" target=\"_blank\" rel=\"external\">What is Deep Learning?</a> (machinelearningmastery.com)</li>\n<li><a href=\"https://blogs.nvidia.com/blog/2016/07/29/whats-difference-artificial-intelligence-machine-learning-deep-learning-ai/\" target=\"_blank\" rel=\"external\">What’s the Difference Between Artificial Intelligence, Machine Learning, and Deep Learning?</a> (nvidia.com)</li>\n</ul>\n<h4 id=\"优化和降维\">优化和降维</h4>\n<ul>\n<li><a href=\"https://www.knime.org/blog/seven-techniques-for-data-dimensionality-reduction\" target=\"_blank\" rel=\"external\">Seven Techniques for Data Dimensionality Reduction</a> (knime.org)</li>\n<li><a href=\"http://cs229.stanford.edu/notes/cs229-notes10.pdf\" target=\"_blank\" rel=\"external\">Principal components analysis</a> (Stanford CS229)</li>\n<li><a href=\"http://videolectures.net/site/normal_dl/tag=741100/nips2012_hinton_networks_01.pdf\" target=\"_blank\" rel=\"external\">Dropout: A simple way to improve neural networks</a> (Hinton @ NIPS 2012)</li>\n<li><a href=\"http://rishy.github.io/ml/2017/01/05/how-to-train-your-dnn/\" target=\"_blank\" rel=\"external\">How to train your Deep Neural Network</a> (rishy.github.io)</li>\n</ul>\n<h4 id=\"长短期记忆-LSTM\">长短期记忆(LSTM)</h4>\n<ul>\n<li><a href=\"http://machinelearningmastery.com/gentle-introduction-long-short-term-memory-networks-experts/\" target=\"_blank\" rel=\"external\">A Gentle Introduction to Long Short-Term Memory Networks by the Experts</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://colah.github.io/posts/2015-08-Understanding-LSTMs/\" target=\"_blank\" rel=\"external\">Understanding LSTM Networks</a> (colah.github.io)</li>\n<li><a href=\"http://blog.echen.me/2017/05/30/exploring-lstms/\" target=\"_blank\" rel=\"external\">Exploring LSTMs</a> (echen.me)</li>\n<li><a href=\"http://iamtrask.github.io/2015/11/15/anyone-can-code-lstm/\" target=\"_blank\" rel=\"external\">Anyone Can Learn To Code an LSTM-RNN in Python</a> (iamtrask.github.io)</li>\n</ul>\n<h4 id=\"卷积神经网络-CNNs\">卷积神经网络(CNNs)</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap6.html#introducing_convolutional_networks\" target=\"_blank\" rel=\"external\">Introducing convolutional networks</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"https://medium.com/@ageitgey/machine-learning-is-fun-part-3-deep-learning-and-convolutional-neural-networks-f40359318721\" target=\"_blank\" rel=\"external\">Deep Learning and Convolutional Neural Networks</a> (medium.com/@ageitgey)</li>\n<li><a href=\"http://colah.github.io/posts/2014-07-Conv-Nets-Modular/\" target=\"_blank\" rel=\"external\">Conv Nets: A Modular Perspective</a> (colah.github.io)</li>\n<li><a href=\"http://colah.github.io/posts/2014-07-Understanding-Convolutions/\" target=\"_blank\" rel=\"external\">Understanding Convolutions</a> (colah.github.io)</li>\n</ul>\n<h4 id=\"循环神经网络-RNNs\">循环神经网络(RNNs)</h4>\n<p><a href=\"http://www.wildml.com/2015/09/recurrent-neural-networks-tutorial-part-1-introduction-to-rnns/\" target=\"_blank\" rel=\"external\">Recurrent Neural Networks Tutorial</a> (wildml.com)<br>\n<a href=\"http://distill.pub/2016/augmented-rnns/\" target=\"_blank\" rel=\"external\">Attention and Augmented Recurrent Neural Networks</a> (distill.pub)<br>\n<a href=\"http://karpathy.github.io/2015/05/21/rnn-effectiveness/\" target=\"_blank\" rel=\"external\">The Unreasonable Effectiveness of Recurrent Neural Networks</a> (karpathy.github.io)<br>\n<a href=\"http://nikhilbuduma.com/2015/01/11/a-deep-dive-into-recurrent-neural-networks/\" target=\"_blank\" rel=\"external\">A Deep Dive into Recurrent Neural Nets</a> (nikhilbuduma.com)</p>\n<h4 id=\"增强学习\">增强学习</h4>\n<ul>\n<li><a href=\"https://www.analyticsvidhya.com/blog/2017/01/introduction-to-reinforcement-learning-implementation/\" target=\"_blank\" rel=\"external\">Simple Beginner’s guide to Reinforcement Learning &amp; its implementation</a> (analyticsvidhya.com)</li>\n<li><a href=\"https://web.mst.edu/~gosavia/tutorial.pdf\" target=\"_blank\" rel=\"external\">A Tutorial for Reinforcement Learning</a> (mst.edu)</li>\n<li><a href=\"http://www.wildml.com/2016/10/learning-reinforcement-learning/\" target=\"_blank\" rel=\"external\">Learning Reinforcement Learning</a> (wildml.com)</li>\n<li><a href=\"http://karpathy.github.io/2016/05/31/rl/\" target=\"_blank\" rel=\"external\">Deep Reinforcement Learning: Pong from Pixels</a> (karpathy.github.io)</li>\n</ul>\n<h4 id=\"生成对抗网络-GANs\">生成对抗网络(GANs)</h4>\n<ul>\n<li><a href=\"https://blogs.nvidia.com/blog/2017/05/17/generative-adversarial-network/\" target=\"_blank\" rel=\"external\">What’s a Generative Adversarial Network?</a> (nvidia.com)</li>\n<li><a href=\"https://medium.com/@ageitgey/abusing-generative-adversarial-networks-to-make-8-bit-pixel-art-e45d9b96cee7\" target=\"_blank\" rel=\"external\">Abusing Generative Adversarial Networks to Make 8-bit Pixel Art</a> (medium.com/@ageitgey)</li>\n<li><a href=\"http://blog.aylien.com/introduction-generative-adversarial-networks-code-tensorflow/\" target=\"_blank\" rel=\"external\">An introduction to Generative Adversarial Networks (with code in TensorFlow)</a> (aylien.com)</li>\n<li><a href=\"https://www.oreilly.com/learning/generative-adversarial-networks-for-beginners\" target=\"_blank\" rel=\"external\">Generative Adversarial Networks for Beginners</a> (oreilly.com)</li>\n</ul>\n<h4 id=\"多任务学习\">多任务学习</h4>\n<ul>\n<li><a href=\"http://sebastianruder.com/multi-task/index.html\" target=\"_blank\" rel=\"external\">An Overview of Multi-Task Learning in Deep Neural Networks</a> (sebastianruder.com)</li>\n</ul>\n<h3 id=\"自然语言处理-NLP\">自然语言处理(NLP)</h3>\n<ul>\n<li><a href=\"http://u.cs.biu.ac.il/~yogo/nnlp.pdf\" target=\"_blank\" rel=\"external\">A Primer on Neural Network Models for Natural Language Processing</a> (Yoav Goldberg)</li>\n<li><a href=\"https://monkeylearn.com/blog/the-definitive-guide-to-natural-language-processing/\" target=\"_blank\" rel=\"external\">The Definitive Guide to Natural Language Processing</a> (monkeylearn.com)</li>\n<li><a href=\"https://blog.algorithmia.com/introduction-natural-language-processing-nlp/\" target=\"_blank\" rel=\"external\">Introduction to Natural Language Processing</a> (algorithmia.com)</li>\n<li><a href=\"http://www.vikparuchuri.com/blog/natural-language-processing-tutorial/\" target=\"_blank\" rel=\"external\">Natural Language Processing Tutorial</a> (vikparuchuri.com)</li>\n<li><a href=\"https://arxiv.org/pdf/1103.0398.pdf\" target=\"_blank\" rel=\"external\">Natural Language Processing (almost) from Scratch</a> (arxiv.org)</li>\n</ul>\n<h4 id=\"深度学习与NLP\">深度学习与NLP</h4>\n<ul>\n<li><a href=\"https://arxiv.org/pdf/1703.03091.pdf\" target=\"_blank\" rel=\"external\">Deep Learning applied to NLP</a> (arxiv.org)</li>\n<li><a href=\"https://nlp.stanford.edu/courses/NAACL2013/NAACL2013-Socher-Manning-DeepLearning.pdf\" target=\"_blank\" rel=\"external\">Deep Learning for NLP (without Magic)</a> (Richard Socher)</li>\n<li><a href=\"http://www.wildml.com/2015/11/understanding-convolutional-neural-networks-for-nlp/\" target=\"_blank\" rel=\"external\">Understanding Convolutional Neural Networks for NLP</a> (wildml.com)</li>\n<li><a href=\"http://colah.github.io/posts/2014-07-NLP-RNNs-Representations/\" target=\"_blank\" rel=\"external\">Deep Learning, NLP, and Representations</a> (colah.github.io)</li>\n<li><a href=\"https://explosion.ai/blog/deep-learning-formula-nlp\" target=\"_blank\" rel=\"external\">Embed, encode, attend, predict: The new deep learning formula for state-of-the-art NLP models</a>(explosion.ai)</li>\n<li><a href=\"https://devblogs.nvidia.com/parallelforall/understanding-natural-language-deep-neural-networks-using-torch/\" target=\"_blank\" rel=\"external\">Understanding Natural Language with Deep Neural Networks Using Torch</a> (nvidia.com)</li>\n<li><a href=\"http://pytorch.org/tutorials/beginner/deep_learning_nlp_tutorial.html\" target=\"_blank\" rel=\"external\">Deep Learning for NLP with Pytorch</a> (pytorich.org)</li>\n</ul>\n<h4 id=\"词向量\">词向量</h4>\n<ul>\n<li><a href=\"https://www.kaggle.com/c/word2vec-nlp-tutorial\" target=\"_blank\" rel=\"external\">Bag of Words Meets Bags of Popcorn</a> (kaggle.com)</li>\n<li>On word embeddings <a href=\"http://sebastianruder.com/word-embeddings-1/index.html\" target=\"_blank\" rel=\"external\">Part I</a>, <a href=\"http://sebastianruder.com/word-embeddings-softmax/index.html\" target=\"_blank\" rel=\"external\">Part II</a>, <a href=\"http://sebastianruder.com/secret-word2vec/index.html\" target=\"_blank\" rel=\"external\">Part III</a> (sebastianruder.com)</li>\n<li><a href=\"https://blog.acolyer.org/2016/04/21/the-amazing-power-of-word-vectors/\" target=\"_blank\" rel=\"external\">The amazing power of word vectors</a> (acolyer.org)</li>\n<li><a href=\"https://arxiv.org/pdf/1411.2738.pdf\" target=\"_blank\" rel=\"external\">word2vec Parameter Learning Explained</a> (arxiv.org)</li>\n<li>Word2Vec Tutorial — <a href=\"http://mccormickml.com/2016/04/19/word2vec-tutorial-the-skip-gram-model/\" target=\"_blank\" rel=\"external\">The Skip-Gram Model</a>, <a href=\"http://mccormickml.com/2017/01/11/word2vec-tutorial-part-2-negative-sampling/\" target=\"_blank\" rel=\"external\">Negative Sampling</a> (mccormickml.com)</li>\n</ul>\n<h4 id=\"编码器-解码器\">编码器-解码器</h4>\n<ul>\n<li><a href=\"http://www.wildml.com/2016/01/attention-and-memory-in-deep-learning-and-nlp/\" target=\"_blank\" rel=\"external\">Attention and Memory in Deep Learning and NLP</a> (wildml.com)</li>\n<li><a href=\"https://www.tensorflow.org/tutorials/seq2seq\" target=\"_blank\" rel=\"external\">Sequence to Sequence Models</a> (tensorflow.org)</li>\n<li><a href=\"https://papers.nips.cc/paper/5346-sequence-to-sequence-learning-with-neural-networks.pdf\" target=\"_blank\" rel=\"external\">Sequence to Sequence Learning with Neural Networks</a> (NIPS 2014)</li>\n<li><a href=\"https://medium.com/@ageitgey/machine-learning-is-fun-part-5-language-translation-with-deep-learning-and-the-magic-of-sequences-2ace0acca0aa\" target=\"_blank\" rel=\"external\">Machine Learning is Fun Part 5: Language Translation with Deep Learning and the Magic of Sequences</a>(medium.com/@ageitgey)</li>\n<li><a href=\"http://machinelearningmastery.com/how-to-use-an-encoder-decoder-lstm-to-echo-sequences-of-random-integers/\" target=\"_blank\" rel=\"external\">How to use an Encoder-Decoder LSTM to Echo Sequences of Random Integers</a>(machinelearningmastery.com)</li>\n<li><a href=\"https://google.github.io/seq2seq/\" target=\"_blank\" rel=\"external\">tf-seq2seq</a> (google.github.io)</li>\n</ul>\n<h3 id=\"Python\">Python</h3>\n<ul>\n<li><a href=\"http://www.kdnuggets.com/2015/11/seven-steps-machine-learning-python.html\" target=\"_blank\" rel=\"external\">7 Steps to Mastering Machine Learning With Python</a> (kdnuggets.com)</li>\n<li><a href=\"http://nbviewer.jupyter.org/github/rhiever/Data-Analysis-and-Machine-Learning-Projects/blob/master/example-data-science-notebook/Example%20Machine%20Learning%20Notebook.ipynb\" target=\"_blank\" rel=\"external\">An example machine learning notebook</a> (nbviewer.jupyter.org)</li>\n</ul>\n<h4 id=\"例子\">例子</h4>\n<ul>\n<li><a href=\"http://machinelearningmastery.com/implement-perceptron-algorithm-scratch-python/\" target=\"_blank\" rel=\"external\">How To Implement The Perceptron Algorithm From Scratch In Python</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://www.wildml.com/2015/09/implementing-a-neural-network-from-scratch/\" target=\"_blank\" rel=\"external\">Implementing a Neural Network from Scratch in Python</a> (wildml.com)</li>\n<li><a href=\"http://iamtrask.github.io/2015/07/12/basic-python-network/\" target=\"_blank\" rel=\"external\">A Neural Network in 11 lines of Python</a> (iamtrask.github.io)</li>\n<li><a href=\"http://www.kdnuggets.com/2016/01/implementing-your-own-knn-using-python.html\" target=\"_blank\" rel=\"external\">Implementing Your Own k-Nearest Neighbour Algorithm Using Python</a> (kdnuggets.com)</li>\n<li><a href=\"http://machinelearningmastery.com/memory-in-a-long-short-term-memory-network/\" target=\"_blank\" rel=\"external\">Demonstration of Memory with a Long Short-Term Memory Network in Python</a>(machinelearningmastery.com)</li>\n<li><a href=\"http://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/\" target=\"_blank\" rel=\"external\">How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks</a>(machinelearningmastery.com)</li>\n<li><a href=\"http://pytlab.org/2017/08/12/%E8%B6%85%E8%BF%87150%E4%B8%AA%E6%9C%80%E5%A5%BD%E7%9A%84%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E5%92%8CPython%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%99%E7%A8%8B/How%20to%20Learn%20to%20Add%20Numbers%20with%20seq2seq%20Recurrent%20Neural%20Networks\">How to Learn to Add Numbers with seq2seq Recurrent Neural Networks</a> (machinelearningmastery.com)</li>\n</ul>\n<h4 id=\"Numpy和Scipy\">Numpy和Scipy</h4>\n<ul>\n<li><a href=\"http://www.scipy-lectures.org/\" target=\"_blank\" rel=\"external\">Scipy Lecture Notes</a> (scipy-lectures.org)</li>\n<li><a href=\"http://cs231n.github.io/python-numpy-tutorial/\" target=\"_blank\" rel=\"external\">Python Numpy Tutorial</a> (Stanford CS231n)</li>\n<li><a href=\"https://engineering.ucsb.edu/~shell/che210d/numpy.pdf\" target=\"_blank\" rel=\"external\">An introduction to Numpy and Scipy</a> (UCSB CHE210D)</li>\n<li><a href=\"http://nbviewer.jupyter.org/gist/rpmuller/5920182#ii.-numpy-and-scipy\" target=\"_blank\" rel=\"external\">A Crash Course in Python for Scientists</a> (nbviewer.jupyter.org)</li>\n</ul>\n<h4 id=\"scikit-learn\">scikit-learn</h4>\n<ul>\n<li><a href=\"http://nbviewer.jupyter.org/github/jakevdp/sklearn_pycon2015/blob/master/notebooks/Index.ipynb\" target=\"_blank\" rel=\"external\">PyCon scikit-learn Tutorial Index</a> (nbviewer.jupyter.org)</li>\n<li><a href=\"https://github.com/mmmayo13/scikit-learn-classifiers/blob/master/sklearn-classifiers-tutorial.ipynb\" target=\"_blank\" rel=\"external\">scikit-learn Classification Algorithms</a> (github.com/mmmayo13)</li>\n<li><a href=\"http://scikit-learn.org/stable/tutorial/index.html\" target=\"_blank\" rel=\"external\">scikit-learn Tutorials</a> (scikit-learn.org)</li>\n<li><a href=\"https://github.com/mmmayo13/scikit-learn-beginners-tutorials\" target=\"_blank\" rel=\"external\">Abridged scikit-learn Tutorials</a> (github.com/mmmayo13)</li>\n</ul>\n<h4 id=\"Tensorflow\">Tensorflow</h4>\n<ul>\n<li><a href=\"https://www.tensorflow.org/tutorials/\" target=\"_blank\" rel=\"external\">Tensorflow Tutorials</a> (tensorflow.org)</li>\n<li><a href=\"https://medium.com/@erikhallstrm/hello-world-tensorflow-649b15aed18c\" target=\"_blank\" rel=\"external\">Introduction to TensorFlow — CPU vs GPU</a> (medium.com/@erikhallstrm)</li>\n<li><a href=\"https://blog.metaflow.fr/tensorflow-a-primer-4b3fa0978be3\" target=\"_blank\" rel=\"external\">TensorFlow: A primer</a> (metaflow.fr)</li>\n<li><a href=\"http://www.wildml.com/2016/08/rnns-in-tensorflow-a-practical-guide-and-undocumented-features/\" target=\"_blank\" rel=\"external\">RNNs in Tensorflow</a> (wildml.com)</li>\n<li><a href=\"http://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/\" target=\"_blank\" rel=\"external\">Implementing a CNN for Text Classification in TensorFlow</a> (wildml.com)</li>\n<li><a href=\"http://pavel.surmenok.com/2016/10/15/how-to-run-text-summarization-with-tensorflow/\" target=\"_blank\" rel=\"external\">How to Run Text Summarization with TensorFlow</a> (surmenok.com)</li>\n</ul>\n<h4 id=\"PyTorch\">PyTorch</h4>\n<ul>\n<li><a href=\"http://pytorch.org/tutorials/\" target=\"_blank\" rel=\"external\">PyTorch Tutorials</a> (pytorch.org)</li>\n<li><a href=\"http://blog.gaurav.im/2017/04/24/a-gentle-intro-to-pytorch/\" target=\"_blank\" rel=\"external\">A Gentle Intro to PyTorch</a> (gaurav.im)</li>\n<li><a href=\"https://iamtrask.github.io/2017/01/15/pytorch-tutorial/\" target=\"_blank\" rel=\"external\">Tutorial: Deep Learning in PyTorch</a> (iamtrask.github.io)</li>\n<li><a href=\"https://github.com/jcjohnson/pytorch-examples\" target=\"_blank\" rel=\"external\">PyTorch Examples</a> (github.com/jcjohnson)</li>\n<li><a href=\"https://github.com/MorvanZhou/PyTorch-Tutorial\" target=\"_blank\" rel=\"external\">PyTorch Tutorial</a> (github.com/MorvanZhou)</li>\n<li><a href=\"http://pytlab.org/2017/08/12/%E8%B6%85%E8%BF%87150%E4%B8%AA%E6%9C%80%E5%A5%BD%E7%9A%84%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E5%92%8CPython%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%99%E7%A8%8B/PyTorch%20Tutorial%20for%20Deep%20Learning%20Researchers\">PyTorch Tutorial for Deep Learning Researchers</a> (github.com/yunjey)</li>\n</ul>\n<h3 id=\"Math\">Math</h3>\n<ul>\n<li><a href=\"https://people.ucsc.edu/~praman1/static/pub/math-for-ml.pdf\" target=\"_blank\" rel=\"external\">Math for Machine Learning</a> (ucsc.edu)</li>\n<li><a href=\"http://www.umiacs.umd.edu/~hal/courses/2013S_ML/math4ml.pdf\" target=\"_blank\" rel=\"external\">Math for Machine Learning</a> (UMIACS CMSC422)</li>\n</ul>\n<h4 id=\"线性代数\">线性代数</h4>\n<ul>\n<li><a href=\"https://betterexplained.com/articles/linear-algebra-guide/\" target=\"_blank\" rel=\"external\">An Intuitive Guide to Linear Algebra</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/matrix-multiplication/\" target=\"_blank\" rel=\"external\">A Programmer’s Intuition for Matrix Multiplication</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/cross-product/\" target=\"_blank\" rel=\"external\">Understanding the Cross Product</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/vector-calculus-understanding-the-dot-product/\" target=\"_blank\" rel=\"external\">Understanding the Dot Product</a> (betterexplained.com)</li>\n<li><a href=\"http://www.cedar.buffalo.edu/~srihari/CSE574/Chap1/LinearAlgebra.pdf\" target=\"_blank\" rel=\"external\">Linear Algebra for Machine Learning</a> (U. of Buffalo CSE574)</li>\n<li><a href=\"https://medium.com/towards-data-science/linear-algebra-cheat-sheet-for-deep-learning-cd67aba4526c\" target=\"_blank\" rel=\"external\">Linear algebra cheat sheet for deep learning</a> (medium.com)</li>\n<li><a href=\"http://cs229.stanford.edu/section/cs229-linalg.pdf\" target=\"_blank\" rel=\"external\">Linear Algebra Review and Reference</a> (Stanford CS229)</li>\n</ul>\n<h4 id=\"概率论\">概率论</h4>\n<ul>\n<li><a href=\"https://betterexplained.com/articles/understanding-bayes-theorem-with-ratios/\" target=\"_blank\" rel=\"external\">Understanding Bayes Theorem With Ratios</a> (betterexplained.com)</li>\n<li><a href=\"http://cs229.stanford.edu/section/cs229-prob.pdf\" target=\"_blank\" rel=\"external\">Review of Probability Theory</a> (Stanford CS229)</li>\n<li><a href=\"https://see.stanford.edu/materials/aimlcs229/cs229-prob.pdf\" target=\"_blank\" rel=\"external\">Probability Theory Review for Machine Learning</a> (Stanford CS229)</li>\n<li><a href=\"http://www.cedar.buffalo.edu/~srihari/CSE574/Chap1/Probability-Theory.pdf\" target=\"_blank\" rel=\"external\">Probability Theory</a> (U. of Buffalo CSE574)</li>\n<li><a href=\"http://www.cs.toronto.edu/~urtasun/courses/CSC411_Fall16/tutorial1.pdf\" target=\"_blank\" rel=\"external\">Probability Theory for Machine Learning</a> (U. of Toronto CSC411)</li>\n</ul>\n<h4 id=\"微积分\">微积分</h4>\n<ul>\n<li><a href=\"https://betterexplained.com/articles/how-to-understand-derivatives-the-quotient-rule-exponents-and-logarithms/\" target=\"_blank\" rel=\"external\">How To Understand Derivatives: The Quotient Rule, Exponents, and Logarithms</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/derivatives-product-power-chain/\" target=\"_blank\" rel=\"external\">How To Understand Derivatives: The Product, Power &amp; Chain Rules</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/vector-calculus-understanding-the-gradient/\" target=\"_blank\" rel=\"external\">Vector Calculus: Understanding the Gradient</a> (betterexplained.com)</li>\n<li><a href=\"http://web.stanford.edu/class/cs224n/lecture_notes/cs224n-2017-review-differential-calculus.pdf\" target=\"_blank\" rel=\"external\">Differential Calculus</a> (Stanford CS224n)</li>\n<li><a href=\"http://ml-cheatsheet.readthedocs.io/en/latest/calculus.html\" target=\"_blank\" rel=\"external\">Calculus Overview</a> (readthedocs.io)</li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c3d3aeee3e50259c10c3524201fc68db.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112185\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112185votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112185\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 17 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3f741a9dd5c4194b365e95b06a56c09.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢写程序的计算化学狗，Python/C/C++/Fortran, 个人博客 http://pytlab.org        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/shaozhengjiang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/shaozhengjiang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://pytlab.org\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/shaowugui\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/PytLab\"><i class=\"fa fa-github\"></i></a> <a title=\"Stack Overflow主页\" target=\"_blank\" href=\"http://stackoverflow.com/users/4014840/pytlab\"><i class=\"fa fa-stack-overflow\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/15", "fav_nums": 7, "tags": "工具与资源,nlp,Python,人工智能,机器学习,深度学习", "url": "http://blog.jobbole.com/112185/", "front_image_path": "full/f02d2e7eb1184040c7a09a8a14f24d219b467b39.jpg", "praise_nums": "2", "title": "150 多个 ML、NLP 和 Python 相关的教程", "comment_nums": 7}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/8d67b7db1e9704c55aad01b886ec4c46.jpg"], "url_object_id": "5eda13472020b0a94aa6bc350676f012", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/maifansnet\">maifans</a> 翻译，<a href=\"http://www.jobbole.com/members/hearingdog\">BEASTQ</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://codeahoy.com/2016/04/03/effective-code-reviews/\">codeahoy</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>代码评审（Code review）是保证代码质量的一种有效手段，做得好的话，对公司来讲是一笔收益颇高的时间投资。但实践起来往往变成了炫耀编程技能、固执己见、恶言相向、同事关系恶化的事，这该如何是好？</p>\n<p>往往代码评审过程中，评审者（Reviewer）往往会过于关心旁枝末节，而忽视主要问题，也就是所谓的自行车棚效应。在批准价值百亿的核电站的建设提案中，专家们往往会浪费大量时间纠结于厂内自行车棚（bikeshed）的颜色；因为核电站太大、太复杂，“专家们”未必真懂，但总不能不说话啊，那就从无关痛痒的自行车棚挑毛病吧。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2013/02/how-to-code-review.jpg\" width=\"400\" height=\"649\"></p>\n<h3>有效的代码评审</h3>\n<p>代码评审是开发人员编写的代码由另一个人检查以查找缺陷和改进的过程。换句话说，开发人员大部分都是独立编写代码的，当代码完成之后，他们会召集一次评审。</p>\n<p>代码评审是提高软件质量的有效途径。在Google，所有代码都要经过同行评审。引用《<a href=\"https://www.amazon.cn/gp/product/B0061XKRXA/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0061XKRXA&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">代码大全（第2版）</a>》中的几个例子：</p>\n<blockquote>\n<ul>\n<li>IBM 的 Orbit 项目有 50 万行代码，使用了 11 级的检查。它提前交付，并且只有通常预期错误的百分之一。</li>\n<li>一份对 AT＆T 的一个 200 多人组织的研究报告显示，在引入评审后，生产率提高了14％，缺陷减少了90％。</li>\n<li>喷气推进实验室估计，通过早期发现和修复缺陷，每次评审节省约 25,000 美元。</li>\n</ul>\n</blockquote>\n<p>然而，不少团队在有效的代码评审争论中，失去了原本的效益。在功能失调的团队和组织中，对所有参与者来说它可以迅速变成一个<b>令人不快的经历</b>：</p>\n<ul>\n<li>它成为评审人员来展示技能的平台。他们在别人的代码中指出“错误”，并强加自己没有价值的“意见”。</li>\n<li>在代码完全就绪前，开发人员会非常抗拒别人审查他们的代码 ——可以说这可能是一件好事，但他没有真正理解评审的意义。</li>\n<li>开发人员放弃代码所有权，并开始依赖他人查找问题。</li>\n</ul>\n<p>在这篇文章中，我将讨论团队和组织可以做的一些事情，让代码评审为所有参与者带来愉快的体验。</p>\n<h3>对管理层的建议：营造健康文化</h3>\n<p><strong>有效的代码评审，需要一个重视质量和卓越的健康文化。</strong>如果团队不以提供高质量的产品为信仰，代码评审将不会给您所期望的结果。你需要一个人人参与的积极文化—立足于建设性批评，智者胜。</p>\n<p><strong>除了创造一个健康文化，并允许花时间和资源进行评审，管理者在代码评审中应保持低姿态。</strong>大多数人不想在上司面前暴露自己的秘密，这已是一种文化。代码评审最好由同行进行，管理层不应该询问可以用来评价人的细节<span style=\"font-family: Helvetica, sans-serif;\">。</span>的确有一些管理人员索要检查表和成绩，以便他们可以<span style=\"font-family: Helvetica, sans-serif;\">“</span>衡量<span style=\"font-family: Helvetica, sans-serif;\">”</span>并评价人。</p>\n<p><strong>可能你已经有一个健康的文化（算你幸运）。</strong>这还不够，营造健康的文化取决于许多因素（团队和组织内部）。这是非常具有挑战性的，没有灵丹妙药。没有正确的文化，代码评审不会带来期望的收获，甚至在极端情况下可能会适得其反。</p>\n<h3>对个人的建议：换位思考</h3>\n<p>Karl Wiegers 在他的《Peer Reviews in Software: A Practical Guide》中写道：</p>\n<blockquote><p>产品的作者与评审者之间的互动至关重要。<span style=\"color: #515151;\">作者必须足够信任和尊重评审者才能接受他们的意见。</span> <span style=\"color: #515151;\">同样，评审者必须尊重作者的才华和辛勤工作。评审者应谨慎选择他们用来提出问题的词汇，重点关注他们对产品的观察。说『我没有看到这些变量被初始化</span> <span style=\"color: #515151;\">』可能会引发建设性的反馈</span>， 而『你没有初始化这些变量』可能会让作者非常不爽。</p></blockquote>\n<p>关注代码很容易，但不要忘记，桌子（或计算机）的另一端有一个人。他有主见有<span style=\"font-family: Helvetica, sans-serif;\">“</span>自我<span style=\"font-family: Helvetica, sans-serif;\">”</span>。请记住，解决问题的方式有很多。</p>\n<ul>\n<li><strong>要谦虚。</strong>我既见过非常高效的评审，也见过因为吹毛求疵而非常低效的评审<span style=\"font-family: Helvetica, sans-serif;\">。</span>不要吹毛求疵<span style=\"font-family: Helvetica, sans-serif;\">！！！</span></li>\n<li><strong>确保您有编码标准<span style=\"font-family: Helvetica, sans-serif;\">。</span></strong>编码标准是在组织中共享的人人都认同的一套准则。如果你没有编码标准，那么不要让讨论变成一个比较编码风格的比赛（大括号 <span style=\"font-family: Helvetica, sans-serif;\"><strong><span style=\"color: #ff0000;\">{</span></strong> </span>在同一行还是下一行！）如果你遇到这样的情况，请在编码标准论坛上离线讨论<span style=\"font-family: Helvetica, sans-serif;\">。</span></li>\n<li><strong>学会良好地沟通。</strong>你必须能够清楚地表达想法和理由。</li>\n<li><strong>编程策略是一个仁者见仁智者见智的问题。</strong>评审者和开发人员应该寻求理解彼此的观点，而不应该成为哲学辩论</li>\n</ul>\n<h3>对评审者的建议：谦虚</h3>\n<ul>\n<li><strong>开发者不是冤大头。</strong>评审的目的不是证明谁是更优秀的程序员而是查找缺陷，并确保代码是简单和可维护的。</li>\n<li><strong>问问题。</strong>不要提出可能听起来带指责的要求或言论。例如，不要说：『你没有遵循标准<span style=\"font-family: Helvetica, sans-serif;\">XYZ</span>』。更好的方式是真正寻求理解开发者的观点：『你对标准 <span style=\"font-family: Helvetica, sans-serif;\">XYZ </span>有什么看法，它是否适用于这里？』，这可以引到我的下一个观点。</li>\n<li><strong>避免『你为什么』，『你为什么不』风格的问题。</strong>它会使人对立。 『为什么把它声明为全局变量？』可以更好地表达为『我不明白为什么这里用一个全局变量』。寻找方法来简化代码。代码评审的目标之一是创建<span style=\"font-family: Helvetica, sans-serif;\">“</span>可维护<span style=\"font-family: Helvetica, sans-serif;\">”</span>软件。</li>\n<li><strong>记住要欣赏并感谢对方。</strong>人们经常忘记一句简单的『干得好』或『它看起来很棒』的影响有多大。</li>\n</ul>\n<p>有些事情，如果看起来像排练过的或以讽刺的语气说出来，就不会奏效。像正常对话一样对待代码评审。你正在聆听他人，应该真正寻求理解他们的观点。需要时提供建议和提示。如果代码很棒，不要强迫找一些消极的来说。</p>\n<h3>对开发者的建议：它不是个人的事情</h3>\n<ul>\n<li><strong>不要感情用事。</strong>记住，别人说的不是，是代码中的缺陷或不足，而不是你。</li>\n<li><strong>意识到你和你的代码是捆绑在一起是正常的事情。</strong>如果你为自己的工作感到自豪，那是一个很好的迹象，说明你是一个关心作品的人。</li>\n<li><strong>有适当的自我。</strong><span style=\"font-family: Helvetica, sans-serif;\">足够信任和捍卫自己的观点，但又不至于盲目拒绝对方的好建议和意见</span>。</li>\n<li><strong>人非圣贤孰能无过。</strong>评审者作为第二双眼，可以指出你可能忽略的事情。问题与具体建议一样有价值。</li>\n<li><strong>提问题要有针对性。</strong>『将所有这些类纳入它们自己的软件包中是否更有意义』</li>\n<li><strong>感谢审稿人的时间和他们可能提供的任何反馈。</strong></li>\n</ul>\n<h3>总结</h3>\n<p><span style=\"font-family: Helvetica, sans-serif;\">同行评审是人们互相交流，而无效（ineffectiveness）则源于社会学问题。然而，管理者花费大量时间在操心使用哪些惊艳的工具。</span>工具会有所帮助，但只有工具并不会神奇地带来结果。立足于正确的文化同时<span style=\"font-family: Helvetica, sans-serif;\">…</span>换位思考，以人为本！<span style=\"font-family: Helvetica, sans-serif;\"> :-)</span></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112050\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112050votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112050\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet\">maifans</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            软件工程师，关注人工智能，关注医疗器械。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/maifansnet\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/maifansnet/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 13</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/15", "fav_nums": 3, "tags": "IT技术,Code Review", "url": "http://blog.jobbole.com/112050/", "front_image_path": "full/dfa8fff3b99c7011381e1666d2c2ba0015a7c34f.jpg", "praise_nums": "1", "title": "如何做有效的Code Review？我有这些建议", "comment_nums": 3}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "url_object_id": "6cbfecaa4a696000b1d800f677cb3f43", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.com/linode-cube/the-what-why-and-wow-behind-the-coreos-container-linux-fa7ceae5593c\">Steven J. Vaughan-nichols</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8768-1.html\">Linux中国/toyijiu</a>   </div><blockquote><p>CoreOS，一款最新的 Linux 发行版本，支持自动升级内核软件，提供各集群间配置的完全控制。</p></blockquote>\n<p>关于使用哪个版本的 Linux 服务器系统的争论，常常是以这样的话题开始的：</p>\n<blockquote><p>你是喜欢基于 <a href=\"https://www.redhat.com/en/technologies/linux-platforms/enterprise-linux\">Red Hat Enterprise Linux （RHEL）</a> 的 <a href=\"https://www.centos.org/\">CentOS</a> 或者 <a href=\"https://getfedora.org/\">Fedora</a>，还是基于 <a href=\"https://www.debian.org/\">Debian</a> 的 <a href=\"https://www.ubuntu.com/\">Ubuntu</a>，抑或 <a href=\"https://www.suse.com/\">SUSE</a> 呢？</p></blockquote>\n<p>但是现在，一款名叫 <a href=\"https://coreos.com/os/docs/latest\">CoreOS 容器 Linux</a> 的 Linux 发行版加入了这场“圣战”。<a href=\"https://www.linode.com/docs/platform/use-coreos-container-linux-on-linode\">这个最近在 Linode 服务器上提供的 CoreOS</a>，和它的老前辈比起来，它使用了完全不同的实现方法。</p>\n<p>你可能会感到不解，这里有这么多成熟的 Linux 发行版本，为什么要选择用 CoreOS ？借用 Linux 主干分支的维护者，也是 CoreOS 顾问的 Greg Kroah-Hartman 先生的一句话：</p>\n<blockquote><p>CoreOS 可以控制发行版的升级（基于 ChromeOS 代码），并结合了 Docker 和潜在的核对/修复功能，这意味着不用停止或者重启你的相关进程，就可以<a href=\"https://plus.google.com/+gregkroahhartman/posts/YvWFmPa9kVf\">在线升级</a>。测试版本已经支持此功能，这是史无前例的。</p></blockquote>\n<p>当 Greg Kroah-Hartman 做出这段评价时，CoreOS 还处于 α 测试阶段，当时也许就是在硅谷的一个车库当中，<a href=\"https://www.wired.com/2013/08/coreos-the-new-linux/\">开发团队正在紧锣密鼓地开发此产品</a>，但 CoreOS 不像最开始的苹果或者惠普，其在过去的四年当中一直稳步发展。</p>\n<p>当我参加在旧金山举办的 <a href=\"https://coreos.com/fest/\">2017 CoreOS 大会</a>时，CoreOS 已经支持谷歌云、IBM、AWS 和微软的相关服务。现在有超过 1000 位开发人员参与到这个项目中，并为能够成为这个伟大产品的一员而感到高兴。</p>\n<p>究其原因，CoreOS 从开始就是为容器而设计的轻量级 Linux 发行版，其起初是作为一个 <a href=\"https://www.docker.com/\">Docker</a> 平台，随着时间的推移， CoreOS 在容器方面走出了自己的道路，除了 Docker 之外，它也支持它自己的容器 <a href=\"https://coreos.com/rkt\">rkt</a> （读作 rocket ）。</p>\n<p>不像大多数其他的 Linux 发行版，CoreOS 没有包管理器，取而代之的是通过 Google ChromeOS 的页面自动进行软件升级，这样能提高在集群上运行的机器/容器的安全性和可靠性。不用通过系统管理员的干涉，操作系统升级组件和安全补丁可以定期推送到 CoreOS 容器。</p>\n<p>你可以通过 <a href=\"https://coreos.com/products/coreupdate/\">CoreUpdate 和它的 Web 界面</a>上来修改推送周期，这样你就可以控制你的机器何时更新，以及更新以多快的速度滚动分发到你的集群上。</p>\n<p>CoreOS 通过一种叫做 <a href=\"https://github.com/coreos/etcd\">etcd</a> 的分布式配置服务来进行升级，etcd 是一种基于 <a href=\"http://yaml.org/\">YAML</a> 的开源的分布式哈希存储系统，它可以为 Linux 集群容器提供配置共享和服务发现等功能。</p>\n<p>此服务运行在集群上的每一台服务器上，当其中一台服务器需要下线升级时，它会发起领袖选举，以便服务器更新时整个Linux 系统和容器化的应用可以继续运行。</p>\n<p>对于集群管理，CoreOS 之前采用的是 <a href=\"https://github.com/coreos/fleet\">fleet</a> 方法，这将 etcd 和 <a href=\"https://www.freedesktop.org/wiki/Software/systemd/\">systemd</a> 结合到分布式初始化系统中。虽然 fleet 仍然在使用，但 CoreOS 已经将 etcd 加入到 <a href=\"https://kubernetes.io/\">Kubernetes</a> 容器编排系统构成了一个更加强有力的管理工具。</p>\n<p>CoreOS 也可以让你定制其它的操作系统相关规范，比如用 <a href=\"https://coreos.com/os/docs/latest/cloud-config.html\">cloud-config</a> 的方式管理网络配置、用户账号和 systemd 单元等。</p>\n<p>综上所述，CoreOS 可以不断地自行升级到最新版本，能让你获得从单独系统到集群等各种场景的完全控制。如 CoreOS 宣称的，你再也不用为了改变一个单独的配置而在每一台机器上运行 <a href=\"https://insights.hpe.com/articles/what-is-chef-a-primer-for-devops-newbies-1704.html\">Chef</a> 了。</p>\n<p>假如说你想进一步的扩展你的 DevOps 控制，<a href=\"https://blogs.dxc.technology/2017/06/08/coreos-moves-in-on-cloud-devops-with-kubernetes/\">CoreOS 能够轻松地帮助你部署 Kubernetes</a>。</p>\n<p>CoreOS 从一开始就是构建来易于部署、管理和运行容器的。当然，其它的 Linux　发行版，比如 RedHat 家族的<a href=\"http://www.projectatomic.io/\">原子项目</a>也可以达到类似的效果，但是对于那些发行版而言是以附加组件的方式出现的，而 CoreOS 从它诞生的第一天就是为容器而设计的。</p>\n<p>当前<a href=\"http://www.zdnet.com/article/what-is-docker-and-why-is-it-so-darn-popular/\">容器和 Docker 已经逐渐成为商业系统的主流</a>，如果在可预见的未来中你要在工作中使用容器，你应该考虑下 CoreOS，不管你的系统是在裸机硬件上、虚拟机还是云上。</p>\n<p>如果有任何关于 CoreOS 的观点或者问题，还请在评论栏中留言。如果你觉得这篇博客还算有用的话，还请分享一下~</p>\n<hr>\n<p>关于博主：Steven J. Vaughan-Nichols 是一位经验丰富的 IT 记者，许多网站中都刊登有他的文章，包括 <a href=\"http://www.zdnet.com/meet-the-team/us/steven-j-vaughan-nichols/\">ZDNet.com</a>、<a href=\"http://www.pcmag.com/author-bio/steven-j.-vaughan-nichols\">PC Magazine</a>、<a href=\"http://www.infoworld.com/author/Steven-J.-Vaughan_Nichols/\">InfoWorld</a>、<a href=\"http://www.computerworld.com/author/Steven-J.-Vaughan_Nichols/\">ComputerWorld</a>、<a href=\"http://www.linuxtoday.com/author/Steven+J.+Vaughan-Nichols/\">Linux Today</a> 和 <a href=\"http://www.eweek.com/cp/bio/Steven-J.-Vaughan-Nichols/\">eWEEK</a> 等。他拥有丰富的 IT 知识 – 而且他曾参加过智力竞赛节目 Jeopardy ！他的相关观点都是自身思考的结果，并不代表 Linode 公司，我们对他做出的贡献致以最真诚的感谢。如果想知道他更多的信息，可以关注他的 Twitter <a href=\"http://www.twitter.com/sjvn\"><em>@sjvn</em></a>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112189\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112189votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112189\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/14", "fav_nums": 0, "tags": "IT技术,Linux,容器", "url": "http://blog.jobbole.com/112189/", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg", "praise_nums": "1", "title": "CoreOS，一款 Linux 容器发行版", "comment_nums": 0}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/0f3b1cf0b9d183fb000f5687784e8852.png"], "url_object_id": "0b8ff310585249119a5b31d70bda767d", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/two-great-uses-cp-command\">Chris Hermansen</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8766-1.html\">bigdimple</a>   </div><blockquote><p>Linux 中高效的备份拷贝命令</p></blockquote>\n<p>在 Linux 上能使用鼠标点来点去的图形化界面是一件很美妙的事……但是如果你喜欢的开发交互环境和编译器是终端窗口、Bash 和 Vim，那你应该像我一样经常和终端打交道。</p>\n<p>即使是不经常使用终端的人，如果对终端环境深入了解也能获益良多。举个例子—— <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令，据 <a href=\"https://en.wikipedia.org/wiki/Cp_(Unix)\">维基百科</a> 的解释，<span style=\"color: #ff0000\"><strong>cp</strong></span> （意即 copy）命令是第一个版本的 <a href=\"https://en.wikipedia.org/wiki/Unix\">Unix</a> 系统的一部分。连同一组其它的命令 <span style=\"color: #ff0000\"><strong>ls</strong></span>、<span style=\"color: #ff0000\"><strong>mv</strong>、<strong>cd</strong>、<strong>pwd</strong>、<strong>mkdir</strong>、<strong>vi</strong>、<strong>sh</strong>、<strong>sed</strong></span> 和<span style=\"color: #ff0000\"> <strong>awk</strong></span> ，还有提到的<span style=\"color: #ff0000\"> <strong>cp</strong> </span>都是我在 1984 年接触 System V Unix 系统时所学习的命令之一。<span style=\"color: #ff0000\"><strong>cp</strong></span> 命令最常见的用法是制作文件副本。像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e00421117314\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp sourcefile destfile</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e00421117314-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e00421117314-1\"><span class=\"crayon-e\">cp </span><span class=\"crayon-e\">sourcefile </span><span class=\"crayon-v\">destfile</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在终端中执行此命令，上述命令将名为 <span style=\"color: #ff0000\"><strong>sourcefile</strong></span> 的文件复制到名为<span style=\"color: #ff0000\"> <strong>destfile</strong></span> 的文件中。如果在执行命令之前 <span style=\"color: #ff0000\"><strong>destfile</strong></span> 文件不存在，那将会创建此文件，如果已经存在，那就会覆盖此文件。</p>\n<p>这个命令我不知道自己用了多少次了（我也不想知道），但是我知道在我编写测试代码的时候，我经常用，为了保留当前正常的版本，而且又能继续修改，我会输入这个命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e0c714909864\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp test1.py test1.bak</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e0c714909864-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e0c714909864-1\"><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bak</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在过去的30多年里，我使用了无数次这个命令。另外，当我决定编写我的第二个版本的测试程序时，我会输入这个命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e10838181370\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp test1.py test2.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e10838181370-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e10838181370-1\"><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这样就完成了修改程序的第一步。</p>\n<p>我通常很少查看 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令的参考文档，但是当我在备份我的图片文件夹的时候（在 GUI 环境下使用 “file” 应用），我开始思考“在 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令中是否有个参数支持只复制新文件或者是修改过的文件。”果然，真的有！</p>\n<h1 id=\"toc_1\">高效用法 1：更新你的文件夹</h1>\n<p>比如说在我的电脑上有一个存放各种文件的文件夹，另外我要不时的往里面添加一些新文件，而且我会不时地修改一些文件，例如我手机里下载的照片或者是音乐。</p>\n<p>假设我收集的这些文件对我而言都很有价值，我有时候会想做个拷贝，就像是“快照”一样将文件保存在其它媒体。当然目前有很多程序都支持备份，但是我想更为精确的将目录结构复制到可移动设备中，方便于我经常使用这些离线设备或者连接到其它电脑上。</p>\n<p><span style=\"color: #ff0000\"><strong>cp</strong></span> 命令提供了一个易如反掌的方法。例子如下：</p>\n<p>在我的 <span style=\"color: #ff0000\"><strong>Pictures</strong></span> 文件夹下，我有这样一个文件夹名字为 <span style=\"color: #ff0000\"><strong>Misc</strong></span>。为了方便说明，我把文件拷贝到 USB 存储设备上。让我们开始吧！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e15229309714\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nme@desktop:~/Pictures$ cp -r Misc /media/clh/4388-D5FE\r\nme@desktop:~/Pictures$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e15229309714-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f8268b7e15229309714-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e15229309714-1\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Misc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">media</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">clh</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4388</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">D5FE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f8268b7e15229309714-2\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>上面的命令是我从按照终端窗口中完整复制下来的。对于有些人来说不是很适应这种环境，在我们输入命令或者执行命令之前，需要注意的是 <span style=\"color: #ff0000\"><strong>me@mydesktop:~/Pictures</strong></span> 这个前缀，<span style=\"color: #ff0000\"><strong>me</strong></span> 这个是当前用户，<span style=\"color: #ff0000\"><strong>mydesktop</strong></span> 这是电脑名称，<span style=\"color: #ff0000\"><strong>~/Pictures</strong></span> 这个是当前工作目录，是 <span style=\"color: #ff0000\"><strong>/home/me/Pictures</strong></span> 完整路径的缩写。</p>\n<p>我输入这个命令 <span style=\"color: #ff0000\"><strong>cp -r Misc /media/clh/4388-D5FE</strong></span> 并执行后 ，拷贝<span style=\"color: #ff0000\"> <strong>Misc</strong></span> 目录下所有文件（这个 <span style=\"color: #ff0000\"><strong>-r</strong></span> 参数，全称 “recursive”，递归处理，意思为本目录下所有文件及子目录一起处理）到我的 USB 设备的挂载目录<span style=\"color: #ff0000\"> <strong>/media/clh/4388-D5FE</strong></span>。</p>\n<p>执行命令后回到之前的提示，大多数命令继承了 Unix 的特性，在命令执行后，如果没有任何异常什么都不显示，在任务结束之前不会显示像 “execution succeeded” 这样的提示消息。如果想获取更多的反馈，就使用 <span style=\"color: #ff0000\"><strong>-v</strong></span> 参数让执行结果更详细。</p>\n<p>下图中是我的 USB 设备中刚刚拷贝过来的文件夹 <span style=\"color: #ff0000\"><strong>Misc</strong></span> ，里面总共有 9 张图片。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3b1cf0b9d183fb000f5687784e8852.png\"><img class=\"aligncenter wp-image-112174 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3b1cf0b9d183fb000f5687784e8852.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"232\" height=\"197\"></a></p>\n<p>假设我要在原始拷贝路径下 <span style=\"color: #ff0000\"><strong>~/Pictures/Misc</strong></span> 下添加一些新文件，就像这样：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ac252c3c4d39bb62fd126ffce53ed5d1.png\"><img class=\"aligncenter wp-image-112172 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ac252c3c4d39bb62fd126ffce53ed5d1.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"272\" height=\"333\"></a></p>\n<p>现在我想只拷贝新的文件到我的存储设备上，我就使用 <span style=\"color: #ff0000\"><strong>cp</strong> </span>的“更新”和“详细”选项。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e1a085939099\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nme@desktop:~/Pictures$ cp -r -u -v Misc /media/clh/4388-D5FE\r\n'Misc/asunder.png' -&gt; '/media/clh/4388-D5FE/Misc/asunder.png'\r\n'Misc/editing tags guayadeque.png' -&gt; '/media/clh/4388-D5FE/Misc/editing tags guayadeque.png'\r\n'Misc/misc on usb.png' -&gt; '/media/clh/4388-D5FE/Misc/misc on usb.png'\r\nme@desktop:~/Pictures$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e1a085939099-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f8268b7e1a085939099-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e1a085939099-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f8268b7e1a085939099-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e1a085939099-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e1a085939099-1\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Misc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">media</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">clh</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4388</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">D5FE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f8268b7e1a085939099-2\"><span class=\"crayon-s\">'Misc/asunder.png'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/media/clh/4388-D5FE/Misc/asunder.png'</span></div><div class=\"crayon-line\" id=\"crayon-599f8268b7e1a085939099-3\"><span class=\"crayon-s\">'Misc/editing tags guayadeque.png'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/media/clh/4388-D5FE/Misc/editing tags guayadeque.png'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f8268b7e1a085939099-4\"><span class=\"crayon-s\">'Misc/misc on usb.png'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/media/clh/4388-D5FE/Misc/misc on usb.png'</span></div><div class=\"crayon-line\" id=\"crayon-599f8268b7e1a085939099-5\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>上面的第一行中是<span style=\"color: #ff0000\"> <strong>cp</strong></span> 命令和具体的参数（<span style=\"color: #ff0000\"><strong>-r</strong></span> 是“递归”， <span style=\"color: #ff0000\"><strong>-u</strong></span> 是“更新”，<span style=\"color: #ff0000\"><strong>-v</strong></span> 是“详细”）。接下来的三行显示被复制文件的信息，最后一行显示命令行提示符。</p>\n<p>通常来说，参数 <span style=\"color: #ff0000\"><strong>-r</strong></span> 也可用更详细的风格 <span style=\"color: #ff0000\"><strong>–recursive</strong></span>。但是以简短的方式，也可以这么连用 <span style=\"color: #ff0000\"><strong>-ruv</strong></span>。</p>\n<h1 id=\"toc_2\">高效用法 2：版本备份</h1>\n<p>回到一开始的例子中，我在开发的时候定期给我的代码版本进行备份。然后我找到了另一种更好用的 <span style=\"color: #ff0000\"><strong>cp</strong></span> 参数。</p>\n<p>假设我正在编写一个非常有用的 Python 程序，作为一个喜欢不断修改代码的开发者，我会在一开始编写一个程序简单版本，然后不停的往里面添加各种功能直到它能成功的运行起来。比方说我的第一个版本就是用 Python 程序打印出 “hello world”。这只有一行代码的程序就像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e20511806988\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint 'hello world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e20511806988-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e20511806988-1\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>然后我将这个代码保存成文件命名为 <span style=\"color: #ff0000\"><strong>test1.py</strong></span>。我可以这么运行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e24245763839\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nme@desktop:~/Test$ python test1.py\r\nhello world\r\nme@desktop:~/Test$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e24245763839-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f8268b7e24245763839-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e24245763839-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e24245763839-1\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f8268b7e24245763839-2\"><span class=\"crayon-e\">hello </span><span class=\"crayon-e\">world</span></div><div class=\"crayon-line\" id=\"crayon-599f8268b7e24245763839-3\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在程序可以运行了，我想在添加新的内容之前进行备份。我决定使用带编号的备份选项，如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e27348957990\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclh@vancouver:~/Test$ cp --force --backup=numbered test1.py test1.py\r\nclh@vancouver:~/Test$ ls\r\ntest1.py &amp;nbsp;test1.py.~1~\r\nclh@vancouver:~/Test$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e27348957990-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f8268b7e27348957990-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e27348957990-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f8268b7e27348957990-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e27348957990-1\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">force</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">numbered </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f8268b7e27348957990-2\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-599f8268b7e27348957990-3\"><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">nbsp</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f8268b7e27348957990-4\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>所以，上面的做法是什么意思呢？</p>\n<p>第一，这个<span style=\"color: #ff0000\"> <strong>–backup=numbered</strong></span> 参数意思为“我要做个备份，而且是带编号的连续备份”。所以一个备份就是 1 号，第二个就是 2 号，等等。</p>\n<p>第二，如果源文件和目标文件名字是一样的。通常我们使用 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令去拷贝成自己，会得到这样的报错信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e2b226453857\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp: 'test1.py' and 'test1.py' are the same file</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e2b226453857-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e2b226453857-1\"><span class=\"crayon-v\">cp</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test1.py'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test1.py'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">same </span><span class=\"crayon-v\">file</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在特殊情况下，如果我们想备份的源文件和目标文件名字相同，我们使用<span style=\"color: #ff0000\"> <strong>–force</strong></span> 参数。</p>\n<p>第三，我使用 <span style=\"color: #ff0000\"><strong>ls</strong> </span>（意即 “list”）命令来显示现在目录下的文件，名字为 <span style=\"color: #ff0000\"><strong>test1.py</strong></span> 的是原始文件，名字为 <span style=\"color: #ff0000\"><strong>test1.py.~1~</strong></span> 的是备份文件</p>\n<p>假如现在我要加上第二个功能，在程序里加上另一行代码，可以打印 “Kilroy was here.”。现在程序文件 <span style=\"color: #ff0000\"><strong>test1.py</strong></span> 的内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e32042220117\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint 'hello world'\r\nprint 'Kilroy was here'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e32042220117-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f8268b7e32042220117-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e32042220117-1\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f8268b7e32042220117-2\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Kilroy was here'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>看到 Python 编程多么简单了吗？不管怎样，如果我再次执行备份的步骤，结果如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e36990193957\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclh@vancouver:~/Test$ cp --force --backup=numbered test1.py test1.py\r\nclh@vancouver:~/Test$ ls\r\ntest1.py test1.py.~1~ test1.py.~2~\r\nclh@vancouver:~/Test$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e36990193957-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f8268b7e36990193957-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e36990193957-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f8268b7e36990193957-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e36990193957-1\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">force</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">numbered </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f8268b7e36990193957-2\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-599f8268b7e36990193957-3\"><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f8268b7e36990193957-4\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>现在我有有两个备份文件：<span style=\"color: #ff0000\"> <strong>test1.py.~1~</strong></span> 包含了一行代码的程序，和<span style=\"color: #ff0000\"> <strong>test1.py.~2~</strong></span> 包含两行代码的程序。</p>\n<p>这个很好用的功能，我考虑做个 shell 函数让它变得更简单。</p>\n<h1 id=\"toc_3\">最后总结</h1>\n<p>第一，Linux 手册页，它在大多数桌面和服务器发行版都默认安装了，它提供了更为详细的使用方法和例子，对于 <span style=\"color: #ff0000\"><strong>cp</strong> </span>命令，在终端中输入如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f8268b7e39079344398\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman cp</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f8268b7e39079344398-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f8268b7e39079344398-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-v\">cp</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>对于那些想学习如何使用这些命令，但不清楚如何使用的用户应该首先看一下这些说明，然后我建议创建一个测试目录和文件来尝试使用命令和选项。</p>\n<p>第二，兴趣是最好的老师。在你最喜欢的搜索引擎中搜索 “linux shell tutorial”，你会获得很多有趣和有用的资源。</p>\n<p>第三，你是不是在想，“为什么我要用这么麻烦的方法，图形化界面中有相同的功能，只用点击几下岂不是更简单？”，关于这个问题我有两个理由。首先，在我们工作中需要中断其他工作流程以及大量使用点击动作时，点击动作可就不简单了。其次，如果我们要完成流水线般的重复性工作，通过使用 shell 脚本和 shell 函数以及 shell 重命名等功能就能很轻松的实现。</p>\n<p>你还知道关于 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令其他更棒的使用方式吗？请在留言中积极回复哦～</p>\n<hr>\n<p><strong>作者简介：</strong></p>\n<p>Chris Hermansen – 1978 年毕业于英国哥伦比亚大学后一直从事计算机相关职业，我从 2005 年开始一直使用 Linux、Solaris、SunOS，在那之前我就是 Unix 系统管理员了，在技术方面，我的大量的职业生涯都是在做数据分析，尤其是空间数据分析，我有大量的编程经验与数据分析经验，熟练使用 awk、Python、PostgreSQL、PostGIS 和 Groovy。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112170\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112170votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112170\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/12", "fav_nums": 9, "tags": "IT技术,命令行", "url": "http://blog.jobbole.com/112170/", "front_image_path": "full/7b24293fbe6045a1275fe33c8ba3bdde76732dbb.jpg", "praise_nums": "1", "title": "cp 命令两个高效的用法", "comment_nums": 9}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/06/real-programmers-code-in-binary.jpg"], "url_object_id": "2b39c6050457697bdcf56fe2481a09cf", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/Yonah\">肖汉松</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h2 id=\"u524D_u8A00\">前言</h2>\n<p>最近在看《代码大全》，可以说是一本软件开发的百科全书，特别厚，但是干货也很多。平时写代码，代码规范是一个最低的要求（很多老代码连最低要求都达不到），为什么要这样规定代码要这么写，而不是那么写？这是一个值得深究的问题。而不是说我照着代码规范写代码就算完了，高质量的代码是一个专业工程师的追求。要知其然知其所以然，最近写发票解析的代码，因为涉及带解析PDF的算法，复杂度比较高，所以花了很多时间在重构，学以致用的时候积累了一些心得。</p>\n<h2 id=\"u4FE1_u606F_u9690_u85CF_u539F_u5219\">信息隐藏原则</h2>\n<p>信息隐藏是面向对象设计的一个原则，是对封装和模块化的一个更高维度的概括。从Java的整个访问限制设计就体现了信息隐藏的原则，各种访问修饰符：<code>public,protect,private</code>，在类设计的时候，我们就要决定什么暴露给外部，什么隐藏起来。</p>\n<p>举一个例子下面的代码表示一个有自增ID的<code>Person</code>类。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f5fb8c7beb678933452\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Person {\r\n    int id;\r\n    private static int G_MAX_ID = 0;\r\n    public Person() {\r\n      this.id = ++G_MAX_ID;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7beb678933452-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7beb678933452-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7beb678933452-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7beb678933452-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7beb678933452-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7beb678933452-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7beb678933452-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f5fb8c7beb678933452-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7beb678933452-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7beb678933452-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7beb678933452-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7beb678933452-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7beb678933452-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7beb678933452-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><span style=\"font-weight: normal;\">上面的类设计有什么问题呢？它违反了信息隐藏的原则，直接将ID分配的方式暴露了，这会给后面的维护带来很多问题：当你想给id的范围做出限制的时候怎么办？当你在所有代码中使用</span><code style=\"font-style: inherit;\">++G_MAX_ID</code><span style=\"font-weight: normal;\">分配ID时突然需要修改ID分配的算法怎么办？是不是需要去改所有</span><code style=\"font-style: inherit;\">++G_MAX_ID</code><span style=\"font-weight: normal;\">出现的地方？更好的设计是将ID的分配算法隐藏起来。</span></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f5fb8c7bf5507571120\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Person {\r\n    int id;\r\n    private static int G_MAX_ID = 0;\r\n    public Person() {\r\n      this.id = NewId();\r\n    }\r\n    private int NewId() {\r\n      return ++G_MAX_ID;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bf5507571120-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7bf5507571120-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bf5507571120-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7bf5507571120-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bf5507571120-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7bf5507571120-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bf5507571120-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7bf5507571120-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bf5507571120-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7bf5507571120-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bf5507571120-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7bf5507571120-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bf5507571120-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7bf5507571120-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bf5507571120-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7bf5507571120-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bf5507571120-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7bf5507571120-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bf5507571120-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7bf5507571120-10\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p><span style=\"font-weight: normal;\">咋一看只是将</span><code style=\"font-style: inherit;\">++G_MAX_ID</code><span style=\"font-weight: normal;\">写到一个方法里面而已，但是它隐藏了ID分配的算法，让调用者不需要关心里面的实现，同时控制了变化，不管ID分配算法怎么变，都不会影响其他的代码。调用者了解的信息越多，受到的影响就越大，信息隐藏可以降低复杂度，控制变化的范围。</span></p>\n<p>上面的例子只是信息隐藏的一个简单应用，下面我们来举几个其他的应用例子：</p>\n<ul>\n<li>为什么不推荐使用魔法值（即未经定义的常量）？：这个明显违反了信息隐藏的原则，当你将字面量直接写在代码里面时，就将信息直接暴露了，后面需要修改的时候，一旦少改了某个地方的字面量，bug就出现了。</li>\n<li>循环依赖（即A调用B，B调用A的情况）：类或方法之间的循环依赖会破坏信息隐藏，一个很直接的影响就是在测试的时候，A，B都需要同时准备好才能进行测试，而无法mock任意一方。</li>\n<li>使用全局变量：这个就不用说了，所有人都可以访问你的时候信息就暴露无疑了，全局变量能不用就不用。</li>\n<li>考虑性能损失：有时候我们为了一些性能上的考虑就破坏信息隐藏原则，将一些变量全局化，这样性能提高得不多，维护成本却上升不少，完全是得不偿失。</li>\n</ul>\n<p>最后总结一下信息隐藏的好处：</p>\n<ul>\n<li>隐藏信息即隐藏了复杂度，降低了编程的负担。</li>\n<li>隐藏信息即隐藏了底层变化，以便于在局部控制变化。</li>\n</ul>\n<h2 id=\"u4E00_u4E9B_u4E0D_u592A_u5E38_u89C1_u7684_u7F16_u7A0B_u6280_u5DE7\">一些不太常见的编程技巧</h2>\n<h3 id=\"u51FD_u6570_28function_29_u4E0E_u8FC7_u7A0B_28procedure_29_u7684_u9009_u62E9\">函数(function)与过程(procedure)的选择</h3>\n<p>我们先来看看函数与过程区别：</p>\n<ul>\n<li>Function：有返回值的方法</li>\n<li>Procedure：没有返回值的方法</li>\n</ul>\n<p>平时我们编程其实没有太区别函数与过程，什么时候用函数，什么时候用过程其实没有过多的考虑，感觉都可以用。一个选择的规则就是<strong>当你的方法的目的是想返回跟你方法名称相符的值的时候用函数，否则用过程</strong></p>\n<p>举个例子，我看过很多<code>XXProcessor</code>接口里面的方法都是<code>XX process()</code>，严格来讲，这样的命名是不符合上面的规则的，<code>process</code>是一个没有含义的命名，但是却有返回值，如果没有返回值那它的命名才是合理的。</p>\n<p>当然了，上面的规则仅供参考，世事无绝对，具体情况具体分析，当你不清楚用函数还是用过程的时候，可以参考这个规则。</p>\n<h3 id=\"u4F7F_u7528boolean_u503C_u6765_u7ED9_u7A0B_u5E8F_u505A_u6CE8_u91CA\">使用boolean值来给程序做注释</h3>\n<p>相信大家看到一个if语句有很多条件的时候都会特别头痛，因为很难理解。例如下面的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f5fb8c7bfb252363691\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif ( ( elementIndex &lt; 0 ) || ( MAX_ELEMENTS &lt; elementIndex ) || elementIndex == lastElementIndex) {\r\n  do....\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bfb252363691-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7bfb252363691-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bfb252363691-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bfb252363691-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MAX_ELEMENTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lastElementIndex</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7bfb252363691-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">do</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bfb252363691-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><span style=\"font-weight: normal;\">但如果换成下面的写法，用boolean值的名字来给if语句注释，看起来就很好理解了。</span></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f5fb8c7bff711112066\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfinished = ( ( elementIndex &lt; 0 ) || ( MAX_ELEMENTS &lt; elementIndex ) );\r\nrepeatedEntry = ( elementIndex == lastElementIndex );\r\nif ( finished || repeatedEntry ) {\r\n...\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bff711112066-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7bff711112066-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bff711112066-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f5fb8c7bff711112066-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f5fb8c7bff711112066-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bff711112066-1\"><span class=\"crayon-v\">finished</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MAX_ELEMENTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7bff711112066-2\"><span class=\"crayon-v\">repeatedEntry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lastElementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bff711112066-3\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">finished</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">repeatedEntry</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f5fb8c7bff711112066-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-599f5fb8c7bff711112066-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p><span style=\"font-family: 'Microsoft YaHei', 宋体, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 24px; font-style: normal; font-weight: normal;\">总结</span></p>\n<p>怎么写高质量的代码是一个很大的话题，这里只是抛砖引玉，其实面向对象设计的很多原则都能够给我们写代码的时候提供指导，写代码的时候要时刻记得学以致用，而不是敷衍了事，专业的软件工程师必然要能写得一手好代码。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/5bf123eeb2d2e5d53b487415f6c0555c.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c7fcb7a46ab889ed5518728242187ab5.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112139\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112139votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112139\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/Yonah\">肖汉松</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/Yonah\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/10/b312ba4ffd5245fa2a1ab819ec0d0347.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            热爱阅读，喜欢挑战。热衷尝试新的技术，关注技术背后的原理。关注领域：Java 服务端开发，网络编程。关注语言：Java, C, Python。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/Yonah\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/yonah/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/Yonah/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 39</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.xiaohansong.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/xiaohansong\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/x-hansong\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/10", "fav_nums": 2, "tags": "开发,代码质量", "url": "http://blog.jobbole.com/112139/", "front_image_path": "full/e4f0172387cbbdb2d04cefa86ba2081b49678dc1.jpg", "praise_nums": "1", "title": "编写高质量代码的思考", "comment_nums": 2}
{"front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1filbc2mwdfj218g0nywhd.jpg"], "url_object_id": "85bd8601e0edbec62fafb940f1ad7501", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/8/reasons-i-come-back-gnome\">Jay LaCroix</a>   译文出处：<a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/1510722\">开源中国</a>   </div><p>摘要: 一位资深 Linux 用户告诉你为什么 GNOME 仍然是最好的 Linux 桌面环境</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1filbc2mwdfj218g0nywhd.jpg\" width=\"690\" height=\"372\"></p>\n<blockquote><p>关于本文作者 Jay LaCroix</p>\n<p>Jay LaCroix 是来自密歇根州的技术专家，专注于 Linux 和开源软件。自 2002 年使用 Linux 以来，Jay 一直是它的“死忠粉”。他目前是云计算系统工程师和自由的咨询顾问，乐于教授他人使用 Linux，以充分利用这个优秀的系统。在空闲时间，Jay 会撰写图书，他是 Linux Mint Essentials, Mastering Linux Network Administration 这些书的作者，最近他成为了 Ubuntu Server 的会员。</p></blockquote>\n<p>我使用 Linux 大概已经有 15 年的时间了，在这期间一直都在尝试使用各种桌面环境。在我职业生涯的大部分时间里，我一直是一个坚定的 KDE Plasma 用户（从 2.x 版开始使用），一直坚持使用 Plasma 至 4.x 系列的大部分版本，最终由于稳定性问题，选择了迁移到其他的桌面环境。此后，我尝试过使用 Xfce, MATE, Openbox 等桌面环境。但自从我选择投入 <a href=\"https://www.gnome.org/gnome-3/\" target=\"_blank\" rel=\"nofollow\">GNOME 3</a> 的怀抱后，我就再没有离开过它了。GNOME 是一个稳定且反应灵敏的桌面环境，它使得我可以专注于自己的工作而尽可能少地受到干扰。</p>\n<p>下面说一下我彻底沉醉于 GNOME 3 Shell 的六个原因。</p>\n<h3 id=\"h2_0\">1. 智能且稳定</h3>\n<p>自从切换到 GNOME 3 以来，我并没有遇到过任何稳定性方面的问题。我已经在三台 System76 机器和两台戴尔 Latitude 笔记本电脑上运行 GNOME 3 了，而且它在每台机器上的表现都十分优秀。总之，在 GNOME 上的体验不能更好了 —— 它十分稳定并且永远不会崩溃，这是十分重要的。</p>\n<p>虽然我使用 GNOME 3 的体验一直都很稳定，但在使用测试的 beta 版时，仍然会遇到一些崩溃的场景。当出现这些通常由错误的 beta 版驱动引起的崩溃时（而不是 GNOME 本身），GNOME 3 的恢复功能仍能允许我从锁定中恢复。如果 shell 已经停止响应，我所要做的是按下 ALT+F2，然后按下 R 和 Enter 来重新启动会话，而这不会丢失正在运行的应用程序。事实上，即使强制重新启动 GNOME Shell，它不仅会把应用程序带回来，还会把它们放回到重新启动之前的同一个显示器/工作区上。</p>\n<p>上面的案例只是想告诉大家 GNOME 是如此的智能和稳定 —— 使用它的期间，我确实没遇到过崩溃的场景。而且 GNOME 内置的恢复功能，使得我可以重启整个会话而不用担心丢失正在运行的作业。</p>\n<h3 id=\"h2_1\">2. 不影响我的使用体验</h3>\n<p>我听过对于 GNOME 3 的一个抱怨是它的桌面组件太大，并且在显示器上占用了太多的空间。但我认为，相比其他的桌面环境，GNOME 3 拥有一个更干净的界面。它的大多数桌面组件都包含在 Activities 的概览中，屏幕顶部只有一个非常窄的面板，让桌面的其余部分用于任何正在进行的工作。GNOME 2.x 和 MATE 的默认布局都有两个面板，因此占用了两倍的空间。虽然可以像 MATE 一样自定义环境来使用单个面板。但 GNOME 3.x 不使用旧的两个面板的布局，为应用程序留出了更多的空间。</p>\n<p>由于 GNOME 的大部分桌面组件都包含在 Activities 概览中，所以它永远不会影响我的使用。如果我想更加专注于某些东西，我可以在使用 GNOME 的终端时按下 F11，使其占满整个屏幕。如果我想再次访问 GNOME 界面，我只需按下 <a href=\"https://help.gnome.org/users/gnome-help/stable/keyboard-key-super.html.en\" target=\"_blank\" rel=\"nofollow\">Super</a> 键。在我尝试过的所有桌面环境中（事实上我已经尝试过所有的桌面环境），GNOME 更能提高我的生产力，并且给我的显示屏留下更多的空间这个特性对我来说真的十分重要。</p>\n<h3>3. 显示器的切换能保持正常工作</h3>\n<p>多年以来，我都是使用一个带有扩展坞的笔记本电脑连接到双显示器，这是使用 Linux 唯一的最令人沮丧的地方。我也数不清丢失作业的次数了，因为我的笔记本电脑使用扩展坞与显示器进行连接时会出现死机的情况，或 Xorg Server 崩溃。我几乎习惯了 Linux 上混乱的扩展坞使用体验，直到切换至 GNOEM 3。</p>\n<p>到目前为止，GNOME 3 是我使用过的唯一一个对扩展坞是完全可靠的桌面环境。当我卸下扩展坞时，GNOME 会切换回笔记本电脑，并将所有在两个显示器上运行的应用程序移至单个的内置显示器上，GNOME 不仅可以在不锁定的情况下处理扩展坞，还可以在锁定前十分智能地将应用程序重新移动至启动的显示器上。对我而言，这是十分完美的 —— 没有死机或崩溃。因为我使用扩展坞，所以 GNOME 似乎是我最好的选择。</p>\n<h3 id=\"h2_3\">4. 大量的扩展</h3>\n<p>有人说 GNOME 3 的默认界面是十分有限的，你不能做太多的工作来进行定制。但是默认的设置已经可以很好地为我服务了，不能说 GNOME 不可以定制。它的界面可以通过扩展进行自定义，允许你按照自己的喜欢的方式调整桌面环境。这些扩展可以显示当前的天气状况，在 NetworkManager 的无线网络列表中添加一个刷新图标，插入新菜单，以及更多的其他事情。可通过 <a href=\"https://extensions.gnome.org/\" target=\"_blank\" rel=\"nofollow\">extensions.gnome.org</a> 获取扩展，也可以通过 <a href=\"https://git.gnome.org/browse/gnome-tweak-tool/\" target=\"_blank\" rel=\"nofollow\">GNOME Tweak</a> 工具来管理他们。</p>\n<p>但扩展既是天使也是魔鬼，因为不同的扩展有不同的程度的稳定性和质量。<a href=\"https://opensource.com/article/17/2/top-gnome-shell-extensions\" target=\"_blank\" rel=\"nofollow\">最好的扩展</a>能帮助你完成一些通常不能完成的事情，而糟糕的扩展可能会拖慢桌面环境的运行速度或导致其崩溃。我的建议是适量地使用扩展（质量比数量重要），因为太多的扩展可能会导致稳定性问题或混论的桌面环境。平均来说，我尽量不会安装超过三个以上的扩展。因为我发现大多数扩展只是稍微增强了使用的体验，并不是必需品。我个人最喜欢的三个扩展是 OpenWeather, TopIcons Plus, 和 Workspace Indicator。虽然 Dash to Dock 可能是最受欢迎的扩展，但我不使用它，因为 GNOME 3 默认的体验已经足够满足我的使用需求。</p>\n<p>虽然扩展可以使得体验更好，但在大多数情况下，我并不是真的需要它们。GNOME 3 的默认布局不仅适合我的需要，而且我安装的任何扩展只是增强了体验，但不是我完成工作所必需的。</p>\n<h3 id=\"h2_4\">5. 动态的工作区</h3>\n<p>动态的工作区(workspaces)是使我离不开 GNOME 3 的功能之一。它的概念十分简单，你可以从单个工作区开始，然后会根据需要自动添加更多的工作区。你可以通过按下 Super 键轻松查看在工作区上运行的所有应用程序。看起来这并没解决什么大的问题，但如果你是那种在将一个又一个的窗口叠加在一起的人，你可以使用此功能轻松查看正在运行的内容，并关闭未使用的应用程序。按住 Ctrl+Alt 键并同时按向上或向下的箭头可以在活动的工作区之间切换。当在工作区上打开应用时，会自动创建一个新的空白工作区以便开始使用。当关闭工作区中的所有应用程序时，它们也将被删除。</p>\n<p>这似乎与我们一直以来管理运行的应用程序的方式有很大的区别，但如果你尝试过之后，你可能会喜欢这种方式。我通常在每个工作区中运行一个应用程序，因为我发现使用 Ctrl+Alt+上/下箭头来进行切换比单击面板中的应用程序要快得多，而且效率更高。如果我需要在工作区中运行多个应用程序，我会将它们贴在显示器的左右边缘。</p>\n<p>关于 GNOME 3 处理工作区的方式的另一件事是，如果有多个显示器连接到计算机，默认情况下只有一个显示器启用了工作区。这意味着当我切换工作区时，只有左侧的显示器在它们之间循环，右侧的显示器则保持静止。这允许我在右边的显示器打开一个终端窗口，当我想检查我的消息时，我可以切换工作区以使用我的电子邮件客户端，而不会错过终端中发生的情况。</p>\n<h3 id=\"h2_5\">6. 自定义主题</h3>\n<p>老实说，GNOME 3 的默认主题不是我用过的桌面环境中最好看的（当然也不是最差的）。它的简洁性很好，但对于像我这种喜欢主题并修饰主题的人，可以自定义视觉效果以适应我的口味是十分重要的。</p>\n<p>幸运的是，在 GNOME 中安装主题十分容易。要安装新的主题，只需下载主题（<a href=\"https://www.opendesktop.org/s/Gnome\" target=\"_blank\" rel=\"nofollow\">gnome-look.org</a> 是一个不错的下载源），并将下载的文件解压到主目录的 <strong>.themes </strong>目录中。通过使用 GNOME Tweak 工具，可以在安装的主题之间进行循环。它允许你更改应用程序的外观以及 GNOME Shell 本身。</p>\n<p>最近还没有太多可用的 GNOME 3 主题，Arc 和 Numix 主题几乎占据了所有的焦点。这些主题当然是很好的，但有更多的选择就更好了。幸运的是，自从 Ubuntu 宣布将 GNOME 切换为默认的桌面环境之后，主题社区似乎正在加班工作，现在出现了更多的主题。我个人最喜欢的主题是 Vimix Dark，你的是什么？</p>\n<p>虽然我通常会尝试其他的桌面环境以与桌面 Linux 的发展同步，但我最后总会回归到 GNOME。GNOME 3.x 可能不适用于每个人，但我建议可以给它一次尝试的机会。GNOME 处理某些问题的方式初次看起来可能很奇怪，但它是一个很好的桌面环境，与其他我使用过的任何图形用户界面相比，它使得我更高效地完成我的工作。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112167\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112167votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112167\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/16", "fav_nums": 3, "tags": "IT技术,GNOME,Linux", "url": "http://blog.jobbole.com/112167/", "front_image_path": "full/92195357d24493250ceca135476203662d9775e6.jpg", "praise_nums": "1", "title": "6 个理由，为什么 GNOME 仍然是最好的 Linux 桌面环境", "comment_nums": 3}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/d5e765a446f9f0cf17c21b596186d3b9.png"], "url_object_id": "20f251db4302493feab2277f2e28cf93", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/c4d0837e9439\">ZPPenny</a>   </div><p>在计算机科学中，树是一种很重要的数据结构，比如我们最为熟悉的二叉查找树（Binary Search Tree），红黑树（Red-Black Tree）等，通过引入树这种数据结构，我们可以很快地缩小问题规模，实现高效的查找。</p>\n<p>在监督学习中，面对样本中复杂多样的特征，选取什么样的策略可以实现较高的学习效率和较好的分类效果一直是科学家们探索的目标。那么，树这种结构到底可以如何用于机器学习中呢？我们先从一个游戏开始。</p>\n<p>我们应该都玩过或者听过这么一种游戏：游戏中，出题者写下一个明星的名字，其他人需要猜出这个人是谁。当然，如果游戏规则仅此而已的话，几乎是无法猜出来的，因为问题的规模太大了。为了降低游戏的难度，答题者可以向出题者问问题，而出题者必须准确回答是或者否，答题者依据回答提出下一个问题，如果能够在指定次数内确定谜底，即为胜出。加入了问答规则之后，我们是否有可能猜出谜底呢？我们先实验一下，现在我已经写下了一个影视明星的名字，而你和我的问答记录如下：</p>\n<ol>\n<li>是男的吗？Y</li>\n<li>是亚洲人吗？Y</li>\n<li>是中国人吗？N</li>\n<li>是印度人吗？Y</li>\n<li> ……</li>\n</ol>\n<p>虽然只有短短四个问题，但是我们已经把答案的范围大大缩小了，那么接下，第5个问题你应该如何问呢？我相信你应该基本可以锁定答案了，因为我看过的印度电影就那么几部。我们将上面的信息结构化如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d5e765a446f9f0cf17c21b596186d3b9.png\"><img class=\"aligncenter wp-image-112208 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d5e765a446f9f0cf17c21b596186d3b9.png\" alt=\"2119554-bfc7f93e51ee6786\" width=\"521\" height=\"257\"></a></p>\n<p>在上面的游戏中，我们针对性的提出问题，每一个问题都可以将我们的答案范围缩小，在提问中和回答者有相同知识背景的前提下，得出答案的难度比我们想象的要小很多。</p>\n<p>回到我们最初的问题中，如何将树结构用于机器学习中？结合上面的图，我们可以看出，在每一个节点，依据问题答案，可以将答案划分为左右两个分支，左分支代表的是Yes，右分支代表的是No，虽然为了简化，我们只画出了其中的一条路径，但是也可以明显看出这是一个树形结构，这便是决策树的原型。</p>\n<h1>1. 决策树算法简介</h1>\n<p>我们面对的样本通常具有很多个特征，正所谓对事物的判断不能只从一个角度，那如何结合不同的特征呢？决策树算法的思想是，先从一个特征入手，就如同我们上面的游戏中一样，既然无法直接分类，那就先根据一个特征进行分类，虽然分类结果达不到理想效果，但是通过这次分类，我们的问题规模变小了，同时分类后的子集相比原来的样本集更加易于分类了。然后针对上一次分类后的样本子集，重复这个过程。在理想的情况下，经过多层的决策分类，我们将得到完全纯净的子集，也就是每一个子集中的样本都属于同一个分类。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4e67fca8490cef73a42855761c896291.png\"><img class=\"aligncenter wp-image-112209 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4e67fca8490cef73a42855761c896291.png\" alt=\"2119554-bfc7f93e51ee6786\" width=\"395\" height=\"376\"></a>比如上图中，平面坐标中的六个点，我们无法通过其x坐标或者y坐标直接就将两类点分开。采用决策树算法思想：我们先依据y坐标将六个点划分为两个子类（如水平线所示），水平线上面的两个点是同一个分类，但是水平线之下的四个点是不纯净的。但是没关系，我们对这四个点进行再次分类，这次我们以x左边分类（见图中的竖线），通过两层分类，我们实现了对样本点的完全分类。这样，我们的决策树的伪代码实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a738124013517913\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif y &gt; a:\r\n    output dot\r\nelse:\r\n    if x &lt; b:\r\n          output cross\r\n    else:\r\n          output dot</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a738124013517913-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738124013517913-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738124013517913-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738124013517913-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738124013517913-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738124013517913-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738124013517913-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a738124013517913-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738124013517913-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">output </span><span class=\"crayon-e\">dot</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738124013517913-3\"><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738124013517913-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738124013517913-5\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">output </span><span class=\"crayon-e\">cross</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738124013517913-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738124013517913-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">output </span><span class=\"crayon-v\">dot</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>由这个分类的过程形成一个树形的判决模型，树的每一个非叶子节点都是一个特征分割点，叶子节点是最终的决策分类。如下图所示：<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/7c7879e3286895e28cdd65ffa0da4740.png\"><img class=\"aligncenter wp-image-112210 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7c7879e3286895e28cdd65ffa0da4740.png\" alt=\"2119554-bfc7f93e51ee6786\" width=\"423\" height=\"298\"></a>将新样本输入决策树进行判决时，就是将样本在决策树上自顶向下，依据决策树的节点规则进行遍历，最终落入的叶子节点就是该样本所属的分类。</p>\n<h1>2 决策树算法流程</h1>\n<p>上面我们介绍决策树算法的思想，可以简单归纳为如下两点：</p>\n<ol>\n<li>每次选择其中一个特征对样本集进行分类</li>\n<li>对分类后的子集递归进行步骤1</li>\n</ol>\n<p>看起来是不是也太简单了呢？实际上每一个步骤我们还有很多考虑的。在第一个步骤中，我们需要考虑的一个最重要的策略是，选取什么样的特征可以实现最好的分类效果，而所谓的分类效果好坏，必然也需要一个评价的指标。在上文中，我们都用纯净来说明分类效果好，那何为纯净呢？直观来说就是集合中样本所属类别比较集中，最理想的是样本都属于同一个分类。样本集的纯度可以用<a href=\"https://en.wikipedia.org/wiki/Entropy_(information_theory)\" target=\"_blank\">熵</a>来进行衡量。</p>\n<p>在信息论中，熵代表了一个系统的混乱程度，熵越大，说明我们的数据集纯度越低，当我们的数据集都是同一个类别的时候，熵为0，熵的计算公式如下：</p>\n<p><a href=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/9017e7f5171f1770f8bd702487f297b77df8a907\"><img class=\"aligncenter\" src=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/9017e7f5171f1770f8bd702487f297b77df8a907\" width=\"390\" height=\"56\"></a></p>\n<p>其中，P(xi)表示概率，b在此处取2。比如抛硬币的时候，正面的概率就是1/2，反面的概率也是1/2，那么这个过程的熵为：<a href=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/0d5eab2ab8165e547d69a5fb49db1c18cb1518ef\"><img class=\"aligncenter\" src=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/0d5eab2ab8165e547d69a5fb49db1c18cb1518ef\" width=\"649\" height=\"59\"></a>可见，由于抛硬币是一个完全随机事件，其结果正面和反面是等概率的，所以具有很高的熵。假如我们观察的是硬币最终飞行的方向，那么硬币最后往下落的概率是1，往天上飞的概率是0，带入上面的公式中，可以得到这个过程的熵为0，所以，熵越小，结果的可预测性就越强。在决策树的生成过程中，我们的目标就是要划分后的子集中其熵最小，这样后续的的迭代中，就更容易对其进行分类。</p>\n<p>既然是递归过程，那么就需要制定递归的停止规则。在两种情况下我们停止进一步对子集进行划分，其一是划分已经达到可以理想效果了，另外一种就是进一步划分收效甚微，不值得再继续了。用专业术语总结终止条件有以下几个：</p>\n<ol>\n<li>子集的熵达到阈值</li>\n<li>子集规模够小</li>\n<li>进一步划分的增益小于阈值</li>\n</ol>\n<p style=\"text-align: left\">其中，条件3中的增益代表的是一次划分对数据纯度的提升效果，也就是划分以后，熵减少越多，说明增益越大，那么这次划分也就越有价值，增益的计算公式如下：<a href=\"//upload-images.jianshu.io/upload_images/2119554-ed959b962943ebaf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"><img class=\"aligncenter\" src=\"//upload-images.jianshu.io/upload_images/2119554-ed959b962943ebaf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Gain\" width=\"316\" height=\"60\"></a></p>\n<p style=\"text-align: center\">Gain</p>\n<p>上述公式可以理解为：计算这次划分之后两个子集的熵之和相对划分之前的熵减少了多少，需要注意的是，计算子集的熵之和需要乘上各个子集的权重，权重的计算方法是子集的规模占分割前父集的比重，比如划分前熵为e，划分为子集A和B，大小分别为m和n，熵分别为e1和e2，那么增益就是<strong><span style=\"color: #ff0000\"><code>e - m/(m + n) * e1 - n/(m + n) * e2</code>。</span></strong></p>\n<h1>3. 决策树算法实现</h1>\n<p>有了上述概念，我们就可以开始开始决策树的训练了，训练过程分为：</p>\n<ol>\n<li>选取特征，分割样本集</li>\n<li>计算增益，如果增益够大，将分割后的样本集作为决策树的子节点，否则停止分割</li>\n<li>递归执行上两步</li>\n</ol>\n<p>上述步骤是依照ID3的算法思想（依据信息增益进行特征选取和分裂），除此之外还有C4.5以及CART等决策树算法。</p>\n<p>算法框架如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a738131994161259\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass DecisionTree(object):\r\n    def fit(self, X, y):\r\n        # 依据输入样本生成决策树\r\n        self.root = self._build_tree(X, y)\r\n\r\n    def _build_tree(self, X, y, current_depth=0):\r\n        #1. 选取最佳分割特征，生成左右节点\r\n        #2. 针对左右节点递归生成子树\r\n      \r\n    def predict_value(self, x, tree=None):\r\n        # 将输入样本传入决策树中，自顶向下进行判定\r\n        # 到达叶子节点即为预测值</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a738131994161259-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738131994161259-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738131994161259-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738131994161259-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738131994161259-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738131994161259-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738131994161259-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738131994161259-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738131994161259-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738131994161259-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738131994161259-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738131994161259-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a738131994161259-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DecisionTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738131994161259-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738131994161259-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 依据输入样本生成决策树</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738131994161259-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_build_tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738131994161259-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738131994161259-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_build_tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">current_depth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738131994161259-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">#1. 选取最佳分割特征，生成左右节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738131994161259-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">#2. 针对左右节点递归生成子树</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738131994161259-9\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738131994161259-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">predict_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738131994161259-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 将输入样本传入决策树中，自顶向下进行判定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738131994161259-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 到达叶子节点即为预测值</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>在上述代码中，实现决策树的关键是递归构造子树的过程，为了实现这个过程，我们需要做好三件事：分别是节点的定义，最佳分割特征的选择，递归生成子树。</p>\n<h2>3.1 节点定义</h2>\n<p>决策树的目的是用于分类预测，即各个节点需要选取输入样本的<strong>特征</strong>，进行<strong>规则</strong>判定，最终决定样本归属到哪一棵<strong>子树</strong>，基于这个目的，决策树的每一个节点需要包含以下几个关键信息：</p>\n<ol>\n<li>判决特征：当前节点针对哪一个特征进行判决</li>\n<li>判决规则：对于二类问题，这个规则一般是一个布尔表达式</li>\n<li>左子树：判决为TRUE的样本</li>\n<li>右子树：判决为FALSE的样本</li>\n</ol>\n<p>决策树节点的定义代码如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a738136079014185\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass DecisionNode():\r\n    \r\n    def __init__(self, feature_i=None, threshold=None,\r\n                 value=None, true_branch=None, false_branch=None):\r\n        self.feature_i = feature_i  # 用于测试的特征对应的索引\r\n        self.threshold = threshold  # 判断规则：&gt;=threshold为true\r\n        self.value = value  # 如果是叶子节点，用于保存预测结果\r\n        self.true_branch = true_branch  # 左子树\r\n        self.false_branch = false_branch  # 右子树</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a738136079014185-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738136079014185-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738136079014185-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738136079014185-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738136079014185-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738136079014185-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738136079014185-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738136079014185-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738136079014185-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a738136079014185-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DecisionNode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738136079014185-2\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-599f87a738136079014185-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738136079014185-4\"><span class=\"crayon-h\">                 </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">true_branch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">false_branch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738136079014185-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 用于测试的特征对应的索引</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738136079014185-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">threshold</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 判断规则：&gt;=threshold为true</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738136079014185-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 如果是叶子节点，用于保存预测结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738136079014185-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">true_branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">true_branch</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 左子树</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738136079014185-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">false_branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">false_branch</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 右子树</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h2>3.2 特征选取</h2>\n<p>特征选取是构造决策树最关键的步骤，其目的是选出能够实现分割结果最纯净的那个特征，其操作流程的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a73813a614592297\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 遍历样本集中的所有特征，针对每一个特征计算最佳分割点\r\n# 再选取最佳的分割特征\r\nfor feature_i in range(n_features):\r\n    # 遍历集合中某个特征的所有取值\r\n    for threshold in unique_values:\r\n        # 以当前特征值作为阈值进行分割\r\n        Xy1, Xy2 = divide_on_feature(X_y, feature_i, threshold)\r\n        # 计算分割后的增益\r\n        gain = gain(y, y1, y2)\r\n        # 记录最佳分割特征，最佳分割阈值\r\n        if gain &gt; largest_gain:\r\n        largest_gain = gain\r\n            best_criteria = {\r\n                \"feature_i\": feature_i, \r\n                \"threshold\": threshold \r\n                }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a73813a614592297-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813a614592297-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813a614592297-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813a614592297-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813a614592297-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813a614592297-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813a614592297-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813a614592297-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813a614592297-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813a614592297-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813a614592297-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813a614592297-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813a614592297-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813a614592297-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813a614592297-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813a614592297-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a73813a614592297-1\"><span class=\"crayon-p\"># 遍历样本集中的所有特征，针对每一个特征计算最佳分割点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813a614592297-2\"><span class=\"crayon-p\"># 再选取最佳的分割特征</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813a614592297-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">feature_i </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n_features</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813a614592297-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 遍历集合中某个特征的所有取值</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813a614592297-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">threshold </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unique_values</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813a614592297-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 以当前特征值作为阈值进行分割</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813a614592297-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">Xy1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">divide_on_feature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813a614592297-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 计算分割后的增益</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813a614592297-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813a614592297-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 记录最佳分割特征，最佳分割阈值</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813a614592297-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813a614592297-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813a614592297-13\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">best_criteria</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813a614592297-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"feature_i\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813a614592297-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"threshold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">threshold</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813a614592297-16\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p></p>\n<h2>3.3 节点分裂</h2>\n<p>节点分裂的时候有两条处理分支，如果增益够大，就分裂为左右子树，如果增益很小，就停止分裂，将这个节点直接作为叶子节点。节点分裂和Gain（分割后增益）的计算可以做一个优化，在上一个步骤中，我们寻找最优分割点的时候其实就可以将最佳分裂子集和Gain计算并保存下来，将上一步中的for循环改写为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a73813e391673720\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 以当前特征值作为阈值进行分割\r\nXy1, Xy2 = divide_on_feature(X_y, feature_i, threshold)\r\n# 计算分割后的熵\r\ngain = gain(y, y1, y2)\r\n# 记录最佳分割特征，最佳分割阈值\r\nif gain &gt; largest_gain:\r\n    largest_gain = gain\r\n        best_criteria = {\r\n        \"feature_i\": feature_i, \r\n        \"threshold\": threshold ,\r\n        }\r\n    best_sets = {\r\n        \"left\": Xy1,\r\n        \"right\": Xy2,\r\n        \"gain\": gain\r\n        }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a73813e391673720-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813e391673720-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813e391673720-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813e391673720-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813e391673720-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813e391673720-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813e391673720-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813e391673720-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813e391673720-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813e391673720-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813e391673720-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813e391673720-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813e391673720-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813e391673720-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73813e391673720-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73813e391673720-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a73813e391673720-1\"><span class=\"crayon-p\"># 以当前特征值作为阈值进行分割</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813e391673720-2\"><span class=\"crayon-v\">Xy1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">divide_on_feature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813e391673720-3\"><span class=\"crayon-p\"># 计算分割后的熵</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813e391673720-4\"><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813e391673720-5\"><span class=\"crayon-p\"># 记录最佳分割特征，最佳分割阈值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813e391673720-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813e391673720-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813e391673720-8\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">best_criteria</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813e391673720-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"feature_i\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813e391673720-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"threshold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">threshold</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813e391673720-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813e391673720-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">best_sets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813e391673720-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"left\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813e391673720-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"right\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73813e391673720-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"gain\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73813e391673720-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>为了防止过拟合，需要设置合适的停止条件，比如设置Gain的阈值，如果Gain比较小，就没有必要继续进行分割，所以接下来，我们就可以依据gain来决定分割策略：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a738141926146884\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif best_sets[\"gain\"] &gt; MIN_GAIN:\r\n    # 对best_sets[\"left\"]进一步构造子树，并作为父节点的左子树\r\n    # 对best_sets[\"right\"]进一步构造子树，并作为父节点的右子树\r\n    ...\r\nelse:\r\n    # 直接将父节点作为叶子节点\r\n    ...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a738141926146884-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738141926146884-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738141926146884-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738141926146884-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738141926146884-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738141926146884-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738141926146884-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a738141926146884-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">best_sets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"gain\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MIN_GAIN</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738141926146884-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 对best_sets[\"left\"]进一步构造子树，并作为父节点的左子树</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738141926146884-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 对best_sets[\"right\"]进一步构造子树，并作为父节点的右子树</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738141926146884-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738141926146884-5\"><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738141926146884-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 直接将父节点作为叶子节点</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738141926146884-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>下面，我们结合一组实验数据来学习决策树的训练方法。实验数据来源于<a href=\"http://www.onlamp.com/pub/a/python/2006/02/09/ai_decision_trees.html\" target=\"_blank\">这里</a>，下表中的数据是一组消费调查结果，我们训练决策树的目的，就是构造一个分类算法，使得有新的用户数据时，我们依据训练结果去推断一个用户是否购买这个商品：</p>\n<table>\n<thead>\n<tr>\n<th>AGE</th>\n<th>EDUCATION</th>\n<th>INCOME</th>\n<th>MARITAL STATUS</th>\n<th>PURCHASE?</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>high school</td>\n<td>low</td>\n<td>single</td>\n<td>no</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>single</td>\n<td>no</td>\n</tr>\n<tr>\n<td> &lt; 18</td>\n<td>high school</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>bachelor’s</td>\n<td>low</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>low</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>master’s</td>\n<td>low</td>\n<td>married</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>master’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18</td>\n<td>high school</td>\n<td>high</td>\n<td>single</td>\n<td>no</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>high school</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td> &lt; 18</td>\n<td>high school</td>\n<td>low</td>\n<td>married</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>high school</td>\n<td>high</td>\n<td>married</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>bachelor’s</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>high school</td>\n<td>high</td>\n<td>married</td>\n<td>no</td>\n</tr>\n</tbody>\n</table>\n<p>从表中可以看出，我们一共有20组调查样本，每一组样本包含四个特征，分别是年龄段，学历，收入，婚姻状况，而最后一列是所属分类，在这个问题中就代表是否购买了该产品。</p>\n<p>监督学习就是在每一个样本都有正确答案的前提下，用算法预测结果，然后根据预测情况的好坏，调整算法参数。在决策树中，预测的过程就是依据各个特征划分样本集，评价预测结果的好坏标准是划分结果的纯度。</p>\n<p>为了方便处理，我们对样本数据进行了简化，将年龄特征按照样本的特点，转化为离散的数据，比如小于18对应0，18对应1，18-35对应2，36-55对应3，大于55对应4，以此类推，同样其他的特征也一样最数字化处理，教育水平分别映射为0(hight school)，1(bachelor’s)，2(master’s)，收入映射为0(low)和1(hight), 婚姻状况同样映射为0(single), 1(married)，最终处理后的样本，放到一个numpy矩阵中，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a738147156799193\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX_y = np.array(\r\n        [[3, 2, 1, 0, 1],\r\n         [2, 0, 0, 0, 0],\r\n         [3, 2, 0, 0, 1],\r\n         [2, 1, 1, 0, 0],\r\n         [0, 0, 0, 0, 1],\r\n         [2, 1, 1, 1, 0],\r\n         [3, 1, 0, 1, 0],\r\n         [4, 1, 1, 0, 1],\r\n         [3, 2, 0, 1, 0],\r\n         [4, 2, 0, 1, 1],\r\n         [3, 2, 1, 0, 1],\r\n         [4, 2, 1, 0, 1],\r\n         [1, 0, 1, 0, 0],\r\n         [3, 2, 0, 0, 1],\r\n         [3, 0, 0, 0, 1],\r\n         [0, 0, 0, 1, 1],\r\n         [2, 1, 1, 1, 0],\r\n         [4, 0, 1, 1, 1],\r\n         [4, 1, 0, 0, 1],\r\n         [3, 0, 1, 1, 0]]\r\n    )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738147156799193-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738147156799193-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-1\"><span class=\"crayon-v\">X_y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-11\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-12\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-13\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-14\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-15\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-16\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-17\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-18\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-19\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-20\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738147156799193-21\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738147156799193-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0061 seconds] -->\r\n<p></p>\n<h1>4. 新样本预测</h1>\n<p>依照上面的算法构造决策树，我们将决策树打印出来，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a73814c934982044\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n-- Classification Tree --\r\n0 : 4? \r\n   T -&gt; 1\r\n   F -&gt; 3 : 1? \r\n      T -&gt; 0 : 2? \r\n            T -&gt; 0\r\n            F -&gt; 1\r\n      F -&gt; 0 : 3? \r\n            T -&gt; 1\r\n            F -&gt; 0 : 1? \r\n                        T -&gt; 0\r\n                        F -&gt; 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a73814c934982044-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73814c934982044-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73814c934982044-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73814c934982044-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73814c934982044-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73814c934982044-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73814c934982044-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73814c934982044-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73814c934982044-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73814c934982044-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f87a73814c934982044-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a73814c934982044-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a73814c934982044-1\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Classification </span><span class=\"crayon-v\">Tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73814c934982044-2\"><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f87a73814c934982044-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73814c934982044-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f87a73814c934982044-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73814c934982044-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-599f87a73814c934982044-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73814c934982044-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f87a73814c934982044-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73814c934982044-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f87a73814c934982044-11\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a73814c934982044-12\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>其中，冒号前代表选择的分割特征，冒号后面代表判别规则，二者组合起来就是一个决策树的非叶子节点，每个非叶子节点进一步分割为分为True和False分支，对于叶子节点箭头后面表示最终分类，0表示不购买，1表示购买。由于我们的数据做过简化，所以上述结果不太直观，我们将对应的特征以及判断规则翻译一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a738150916478441\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n年龄 : 大于55? \r\n   是 -&gt; 购买\r\n   否 -&gt; 收入 : 高? \r\n      是 -&gt; 年龄 : 大于18? \r\n            是 -&gt; 不购买\r\n            否 -&gt; 购买\r\n      否 -&gt; 年龄 : 大于36? \r\n            是 -&gt; 购买\r\n            否 -&gt; 年龄 : 大于等于18? \r\n                        是 -&gt; 不购买\r\n                        否 -&gt; 购买</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a738150916478441-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738150916478441-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738150916478441-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738150916478441-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738150916478441-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738150916478441-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738150916478441-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738150916478441-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738150916478441-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738150916478441-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738150916478441-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a738150916478441-1\">年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于<span class=\"crayon-cn\">55</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738150916478441-2\"><span class=\"crayon-h\">   </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div><div class=\"crayon-line\" id=\"crayon-599f87a738150916478441-3\"><span class=\"crayon-h\">   </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>收入<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>高<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738150916478441-4\"><span class=\"crayon-h\">      </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于<span class=\"crayon-cn\">18</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f87a738150916478441-5\"><span class=\"crayon-h\">            </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>不购买</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738150916478441-6\"><span class=\"crayon-h\">            </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div><div class=\"crayon-line\" id=\"crayon-599f87a738150916478441-7\"><span class=\"crayon-h\">      </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于<span class=\"crayon-cn\">36</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738150916478441-8\"><span class=\"crayon-h\">            </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div><div class=\"crayon-line\" id=\"crayon-599f87a738150916478441-9\"><span class=\"crayon-h\">            </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于等于<span class=\"crayon-cn\">18</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738150916478441-10\"><span class=\"crayon-h\">                        </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>不购买</div><div class=\"crayon-line\" id=\"crayon-599f87a738150916478441-11\"><span class=\"crayon-h\">                        </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>决策树构造完之后，我们就可以用来进行新样本的分类了。决策树的预测过程十分容易理解，只需要将从根节点开始，按照节点定义的规则进行判决，选择对应的子树，并重复这个过程，直到叶子节点即可。决策树的预测功能实现代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f87a738153749605184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef predict_value(self, x, tree=None):\r\n        # 如果当前节点是叶子节点，直接输出其值\r\n        if tree.value is not None:\r\n            return tree.value\r\n        # 否则将x按照当前节点的规则进行判决\r\n        # 如果判决为true选择左子树，否则选择右子树，\r\n        feature_value = x[tree.feature_i]\r\n        if feature_value &gt;= tree.threshold:\r\n            branch = tree.true_branch\r\n        else:\r\n            branch = tree.false_branch\r\n        # 在选中的子树上递归进行判断\r\n        return self.predict_value(x, branch)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f87a738153749605184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738153749605184-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738153749605184-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738153749605184-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738153749605184-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738153749605184-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738153749605184-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738153749605184-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738153749605184-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738153749605184-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738153749605184-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f87a738153749605184-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f87a738153749605184-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f87a738153749605184-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">predict_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738153749605184-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 如果当前节点是叶子节点，直接输出其值</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738153749605184-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">value </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738153749605184-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738153749605184-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 否则将x按照当前节点的规则进行判决</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738153749605184-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 如果判决为true选择左子树，否则选择右子树，</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738153749605184-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">feature_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738153749605184-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">threshold</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738153749605184-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">true_branch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738153749605184-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738153749605184-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">false_branch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f87a738153749605184-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 在选中的子树上递归进行判断</span></div><div class=\"crayon-line\" id=\"crayon-599f87a738153749605184-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">predict_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">branch</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<h1>5. 总结</h1>\n<p>决策树是一种简单常用的分类器，通过训练好的决策树可以实现对未知的数据进行高效分类。从我们的例子中也可以看出，决策树模型具有较好的可读性和描述性，有助于辅助人工分析；此外，决策树的分类效率高，一次构建后可以反复使用，而且每一次预测的计算次数不超过决策树的深度。</p>\n<p>当然，决策树也有其缺点。对于连续的特征，比较难以处理，对于多分类问题，计算量和准确率都不理想。此外，在实际应用中，由于其最底层叶子节点是通过父节点中的单一规则生成的，所以通过手动修改样本特征比较容易欺骗分类器，比如在拦击邮件识别系统中，用户可能通过修改某一个关键特征，就可以骗过垃圾邮件识别系统。从实现上来讲，由于树的生成采用的是递归，随着样本规模的增大，计算量以及内存消耗会变得越来越大。</p>\n<p>此外，过拟合也是决策树面临的一个问题，完全训练的决策树(未进行剪纸，未限制Gain的阈值)能够100%准确地预测训练样本，因为其是对训练样本的完全拟合，但是，对与训练样本以外的样本，其预测效果可能会不理想，这就是过拟合。解决决策树的过拟合，除了上文说到的通过设置Gain的阈值作为停止条件之外，通常还需要对决策树进行剪枝，常用的剪枝策略有：</p>\n<ol>\n<li>Pessimistic Error Pruning：悲观错误剪枝</li>\n<li>Minimum Error Pruning：最小误差剪枝</li>\n<li>Cost-Complexity Pruning：代价复杂剪枝</li>\n<li> Error-Based Pruning：基于错误的剪枝，即对每一个节点，都用一组测试数据集进行测试，如果分裂之后，能够降低错误率，再继续分裂为两棵子树，否则直接作为叶子节点。</li>\n<li>Critical Value Pruning：关键值剪枝，这就是上文中提到的设置Gain的阈值作为停止条件。</li>\n</ol>\n<p>我们以最简单的方式展示了ID3决策树的实现方式，如果想要了解不同类型的决策树的差别，可以参考<a href=\"https://www.quora.com/What-are-the-differences-between-ID3-C4-5-and-CART\" target=\"_blank\">这个链接</a>。</p>\n<p>另外，关于各种机器学习算法的实现，强烈推荐参考Github仓库<a href=\"https://github.com/eriklindernoren/ML-From-Scratch.git\" target=\"_blank\">ML-From-Scratch</a>，下载代码之后，通过<strong><span style=\"color: #ff0000\"><code>pip install -r requirements.txt</code></span></strong>安装依赖库即可运行代码。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112206\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112206votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112206\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/16", "fav_nums": 2, "tags": "IT技术,决策树,算法", "url": "http://blog.jobbole.com/112206/", "front_image_path": "full/1e981633d3d633f8ac4523b786bb76f0251e8b5e.jpg", "praise_nums": "2", "title": "决策树算法及实现", "comment_nums": 2}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/3f0fc87336415b5dec8a04dc523db2ac.png"], "url_object_id": "1b94069f855b02965e7341f1f26e4ce2", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2106382253\">Anne90</a> 翻译，<a href=\"http://www.jobbole.com/members/oliverpp\">蒋生武</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://machinelearnings.co/text-classification-using-neural-networks-f5cd7b8765c6#.eessps9io\">machinelearnings</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>理解聊天机器人的工作原理是非常重要的。聊天机器人内部一个非常重要的组件就是文本分类器。我们看一下文本分类器的神经网络（ANN）的内部工作原理。</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3f0fc87336415b5dec8a04dc523db2ac.png\"><img class=\"alignnone size-full wp-image-112152\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3f0fc87336415b5dec8a04dc523db2ac.png\" alt=\"1-DpMaU1p85ZSgamwYDkzL-A\"></a></p>\n<p style=\"text-align: center;\">多层神经网络</p>\n<p>我们将会使用2层网络（1个隐层）和一个“词包”的方法来组织我们的训练数据。文本分类有3个特点：模式匹配、算法、神经网络。虽然使用多项朴素贝叶斯算法的方法非常有效，但是它有3个致命的缺陷：</p>\n<ul>\n<li>这个算法输出一个分数而不是一个概率。我们可以使用概率来忽略特定阈值以下的预测结果。这类似于忽略收音机中的噪声。</li>\n<li>这个算法从一个样本中学习一个分类中包含什么，而不是一个分类中不包含什么。一个分类中不包含什么的的学习模式往往也很重要。</li>\n<li>不成比例的大训练集的分类将会导致扭曲的分类分数，迫使算法相对于分类规模来调整输出分数，这并不理想。</li>\n</ul>\n<p>和它“天真”的对手一样，这种分类器并不试图去理解句子的含义，而仅仅对它进行分类。事实上，所谓的“人工智能聊天机器人”并不理解语言，但那是<a href=\"https://medium.com/@gk_/the-ai-label-is-bullshit-559b171867ff#.cqbwy3eb7\">另一个故事</a>。</p>\n<p>如果你刚接触人工神经网络，这是它的<a href=\"https://medium.com/@gk_/how-neural-networks-work-ff4c7ad371f7\">工作原理</a>。</p>\n<p>理解分类算法，请看<a href=\"https://chatbotslife.com/text-classification-using-algorithms-e4d50dcba45\">这里</a>。</p>\n<p>我们来逐个分析文本分类器的每个部分。我们将按照以下顺序：</p>\n<ol>\n<li><strong>引用需要的库</strong></li>\n<li><strong>提供训练集</strong></li>\n<li>整理数据</li>\n<li>迭代：编写代码+测试预测结果+调整模型</li>\n<li>抽象</li>\n</ol>\n<p>代码在这里，我们使用ipython notebook这个在数据科学项目上非常高效的工具。代码语法是python。</p>\n<p>我们首先导入自然语言工具包。我们需要一个可靠的方法将句子切分成词并且将单词词干化处理。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b106106794414\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# use natural language toolkit\r\nimport nltk\r\nfrom nltk.stem.lancaster import LancasterStemmer\r\nimport os\r\nimport json\r\nimport datetime\r\nstemmer = LancasterStemmer()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b106106794414-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b106106794414-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b106106794414-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b106106794414-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b106106794414-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b106106794414-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b106106794414-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b106106794414-1\"><span class=\"crayon-p\"># use natural language toolkit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b106106794414-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">nltk</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b106106794414-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">nltk</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lancaster </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">LancasterStemmer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b106106794414-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">os</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b106106794414-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b106106794414-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">datetime</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b106106794414-7\"><span class=\"crayon-v\">stemmer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LancasterStemmer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>下面是我们的训练集，12个句子属于3个类别（“意图”）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b111489849640\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 3 classes of training data\r\ntraining_data = []\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"how are you?\"})\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"how is your day?\"})\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"good day\"})\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"how is it going today?\"})\r\n\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"have a nice day\"})\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"see you later\"})\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"have a nice day\"})\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"talk to you soon\"})\r\n\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"make me a sandwich\"})\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"can you make a sandwich?\"})\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"having a sandwich today?\"})\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"what's for lunch?\"})\r\nprint (\"%s sentences in training data\" % len(training_data))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b111489849640-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b111489849640-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b111489849640-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b111489849640-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b111489849640-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b111489849640-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b111489849640-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b111489849640-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b111489849640-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b111489849640-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b111489849640-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b111489849640-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b111489849640-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b111489849640-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b111489849640-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b111489849640-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b111489849640-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b111489849640-1\"><span class=\"crayon-p\"># 3 classes of training data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b111489849640-2\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b111489849640-3\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"how are you?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b111489849640-4\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"how is your day?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b111489849640-5\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"good day\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b111489849640-6\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"how is it going today?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b111489849640-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b111489849640-8\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"have a nice day\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b111489849640-9\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"see you later\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b111489849640-10\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"have a nice day\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b111489849640-11\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"talk to you soon\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b111489849640-12\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b111489849640-13\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"make me a sandwich\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b111489849640-14\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"can you make a sandwich?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b111489849640-15\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"having a sandwich today?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b111489849640-16\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"what's for lunch?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b111489849640-17\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%s sentences in training data\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b116661193178\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n12 sentences in training data</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b116661193178-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b116661193178-1\"><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sentences </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">training </span><span class=\"crayon-v\">data</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在我们可以将数据结构组织为：<em>documents</em>, <em>classes</em> 和<em>words</em>.</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b11c780413361\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwords = []\r\nclasses = []\r\ndocuments = []\r\nignore_words = ['?']\r\n# loop through each sentence in our training data\r\nfor pattern in training_data:\r\n    # tokenize each word in the sentence\r\n    w = nltk.word_tokenize(pattern['sentence'])\r\n    # add to our words list\r\n    words.extend(w)\r\n    # add to documents in our corpus\r\n    documents.append((w, pattern['class']))\r\n    # add to our classes list\r\n    if pattern['class'] not in classes:\r\n        classes.append(pattern['class'])\r\n\r\n# stem and lower each word and remove duplicates\r\nwords = [stemmer.stem(w.lower()) for w in words if w not in ignore_words]\r\nwords = list(set(words))\r\n\r\n# remove duplicates\r\nclasses = list(set(classes))\r\n\r\nprint (len(documents), \"documents\")\r\nprint (len(classes), \"classes\", classes)\r\nprint (len(words), \"unique stemmed words\", words)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b11c780413361-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b11c780413361-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-1\"><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-2\"><span class=\"crayon-v\">classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-3\"><span class=\"crayon-v\">documents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-4\"><span class=\"crayon-v\">ignore_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-5\"><span class=\"crayon-p\"># loop through each sentence in our training data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pattern </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">training_data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># tokenize each word in the sentence</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nltk</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">word_tokenize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sentence'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># add to our words list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># add to documents in our corpus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">documents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># add to our classes list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classes</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-16\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-17\"><span class=\"crayon-p\"># stem and lower each word and remove duplicates</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-18\"><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">words </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ignore_words</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-19\"><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-20\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-21\"><span class=\"crayon-p\"># remove duplicates</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-22\"><span class=\"crayon-v\">classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-24\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">documents</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"documents\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b11c780413361-25\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"classes\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b11c780413361-26\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unique stemmed words\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b121443711502\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n12 documents\r\n3 classes ['greeting', 'goodbye', 'sandwich']\r\n26 unique stemmed words ['sandwich', 'hav', 'a', 'how', 'for', 'ar', 'good', 'mak', 'me', 'it', 'day', 'soon', 'nic', 'lat', 'going', 'you', 'today', 'can', 'lunch', 'is', \"'s\", 'see', 'to', 'talk', 'yo', 'what']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b121443711502-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b121443711502-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b121443711502-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b121443711502-1\"><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">documents</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b121443711502-2\"><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'goodbye'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b121443711502-3\"><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unique </span><span class=\"crayon-e\">stemmed </span><span class=\"crayon-i\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hav'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'for'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'good'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mak'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'me'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'it'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'day'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'soon'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nic'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lat'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'going'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'today'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'can'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lunch'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'is'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"'s\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'see'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'to'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yo'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'what'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>注意每个单词都是词根并且小写。词根有助于机器将“have”和“having”等同起来。同时我们也不关心大小写。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/339dcac37e068d2783eff6ec4e21eb24.png\"><img class=\"alignnone size-full wp-image-112153 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/339dcac37e068d2783eff6ec4e21eb24.png\" alt=\"1-eUedufAl7_sI_QWSEIstZg\"></a></p>\n<p>我们将训练集中的每个句子转换为词包。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b124396411404\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# create our training data\r\ntraining = []\r\noutput = []\r\n# create an empty array for our output\r\noutput_empty = [0] * len(classes)\r\n\r\n# training set, bag of words for each sentence\r\nfor doc in documents:\r\n    # initialize our bag of words\r\n    bag = []\r\n    # list of tokenized words for the pattern\r\n    pattern_words = doc[0]\r\n    # stem each word\r\n    pattern_words = [stemmer.stem(word.lower()) for word in pattern_words]\r\n    # create our bag of words array\r\n    for w in words:\r\n        bag.append(1) if w in pattern_words else bag.append(0)\r\n\r\n    training.append(bag)\r\n    # output is a '0' for each tag and '1' for current tag\r\n    output_row = list(output_empty)\r\n    output_row[classes.index(doc[1])] = 1\r\n    output.append(output_row)\r\n\r\n# sample training/output\r\ni = 0\r\nw = documents[i][0]\r\nprint ([stemmer.stem(word.lower()) for word in w])\r\nprint (training[i])\r\nprint (output[i])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b124396411404-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b124396411404-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-1\"><span class=\"crayon-p\"># create our training data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-2\"><span class=\"crayon-v\">training</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-3\"><span class=\"crayon-v\">output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-4\"><span class=\"crayon-p\"># create an empty array for our output</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-5\"><span class=\"crayon-v\">output_empty</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-6\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-7\"><span class=\"crayon-p\"># training set, bag of words for each sentence</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-8\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doc </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">documents</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># initialize our bag of words</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">bag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># list of tokenized words for the pattern</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pattern_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># stem each word</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pattern_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pattern_words</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># create our bag of words array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pattern_words </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-18\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">training</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># output is a '0' for each tag and '1' for current tag</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output_empty</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output_row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-24\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-25\"><span class=\"crayon-p\"># sample training/output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-26\"><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-27\"><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">documents</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-28\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b124396411404-29\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">training</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b124396411404-30\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p></p>\n<figure id=\"29a3\" class=\"graf graf--figure graf--iframe graf-after--p\">\n<div class=\"aspectRatioPlaceholder is-locked\"></div>\n</figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b129209631701\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['how', 'ar', 'you', '?']\r\n[0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\r\n[1, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b129209631701-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b129209631701-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b129209631701-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b129209631701-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b129209631701-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b129209631701-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>上面的步骤是文本分类中的一个经典步骤：每个训练句子被转化为一个包含0和1的数组，而不是语料库中包含独特单词的数组。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b12c754876284\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['how', 'are', 'you', '?']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b12c754876284-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b12c754876284-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'are'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>被词干化为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b130171332113\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['how', 'ar', 'you', '?']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b130171332113-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b130171332113-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>然后转换为输入词包的形式：<em>1</em>代表单词存在于词包中（忽略问号？）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b133957008486\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b133957008486-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b133957008486-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>输出：第一类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b136181006229\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[1, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b136181006229-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b136181006229-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p style=\"text-align: center;\">注意：一个句子可以有多个分类，也可以没有。确保理解上面的内容，仔细阅读代码直到你理解它。</p>\n<h4>机器学习的第一步是要有干净的数据</h4>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3abe8c32b873ad8ffa8c728a59102d.png\"><img class=\"alignnone size-full wp-image-112154\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3abe8c32b873ad8ffa8c728a59102d.png\" alt=\"1-CcQPggEbLgej32mVF2lalg\"></a></p>\n<figure id=\"62c0\" class=\"graf graf--figure graf--layoutOutsetLeft graf-after--h4\">\n<div class=\"aspectRatioPlaceholder is-locked\"></div>\n</figure>\n<p>接下来我们的学习2层神经网络的核心功能。</p>\n<p>如果你是人工神经网络新手，这里是它的工作原理</p>\n<p>我们使用<a href=\"http://www.numpy.org/\">numpy</a>，原因是它可以提供快速的矩阵乘法运算。</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/f397d71e69f5ebeaf6a3bf0522861d69.png\"><img class=\"alignnone size-full wp-image-112155\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/f397d71e69f5ebeaf6a3bf0522861d69.png\" alt=\"1-8SJcWjxz8j7YtY6K-DWxKw\"></a></p>\n<figure id=\"4f9a\" class=\"graf graf--figure graf--layoutOutsetLeft graf-after--p\">\n<div class=\"aspectRatioPlaceholder is-locked\"></div>\n</figure>\n<p>我们使用sigmoid函数对值进行归一化，用其导数来衡量错误率。通过不断迭代和调整，直到错误率低到一个可以接受的值。</p>\n<p>下面我们也实现了bag-of-words函数，将输入的一个句子转化为一个包含0和1的数组。这就是转换训练数据，得到正确的转换数据至关重要。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b13a878334834\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport numpy as np\r\nimport time\r\n\r\n# compute sigmoid nonlinearity\r\ndef sigmoid(x):\r\n    output = 1/(1+np.exp(-x))\r\n    return output\r\n\r\n# convert output of sigmoid function to its derivative\r\ndef sigmoid_output_to_derivative(output):\r\n    return output*(1-output)\r\n\r\ndef clean_up_sentence(sentence):\r\n    # tokenize the pattern\r\n    sentence_words = nltk.word_tokenize(sentence)\r\n    # stem each word\r\n    sentence_words = [stemmer.stem(word.lower()) for word in sentence_words]\r\n    return sentence_words\r\n\r\n# return bag of words array: 0 or 1 for each word in the bag that exists in the sentence\r\ndef bow(sentence, words, show_details=False):\r\n    # tokenize the pattern\r\n    sentence_words = clean_up_sentence(sentence)\r\n    # bag of words\r\n    bag = [0]*len(words)  \r\n    for s in sentence_words:\r\n        for i,w in enumerate(words):\r\n            if w == s: \r\n                bag[i] = 1\r\n                if show_details:\r\n                    print (\"found in bag: %s\" % w)\r\n\r\n    return(np.array(bag))\r\n\r\ndef think(sentence, show_details=False):\r\n    x = bow(sentence.lower(), words, show_details)\r\n    if show_details:\r\n        print (\"sentence:\", sentence, \"n bow:\", x)\r\n    # input layer is our bag of words\r\n    l0 = x\r\n    # matrix multiplication of input and hidden layer\r\n    l1 = sigmoid(np.dot(l0, synapse_0))\r\n    # output layer\r\n    l2 = sigmoid(np.dot(l1, synapse_1))\r\n    return l2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b13a878334834-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b13a878334834-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">time</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-4\"><span class=\"crayon-p\"># compute sigmoid nonlinearity</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-5\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-8\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-9\"><span class=\"crayon-p\"># convert output of sigmoid function to its derivative</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">sigmoid_output_to_derivative</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">output*</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-12\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-13\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">clean_up_sentence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># tokenize the pattern</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nltk</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">word_tokenize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># stem each word</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence_words</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-20\"><span class=\"crayon-p\"># return bag of words array: 0 or 1 for each word in the bag that exists in the sentence</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-21\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">bow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># tokenize the pattern</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">clean_up_sentence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># bag of words</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">bag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-29\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-31\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"found in bag: %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-32\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-34\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-35\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">think</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"sentence:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"n bow:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># input layer is our bag of words</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># matrix multiplication of input and hidden layer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># output layer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b13a878334834-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b13a878334834-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0062 seconds] -->\r\n<p>现在我们对神经网络训练函数进行编码，创造连接权重。别太激动，这主要是矩阵乘法——来自中学数学课堂。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/02/e0e648def4862d31563d98fa1d9e60a4.jpg\"><img class=\"alignnone size-medium wp-image-64665 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/e0e648def4862d31563d98fa1d9e60a4.jpg\" alt=\"2017-06-03_151025\"></a></p>\n<p>我们现在准备去构建我们的神经网络<em>模型</em>，我们将连接权重保存为json文件。</p>\n<p>你应该尝试不同的“α”（梯度下降参数），看看它是如何影响错误率。此参数有助于错误调整，并找到最低错误率：</p>\n<p>synapse_0 += <strong>alpha</strong> * synapse_0_weight_update</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/41e84709aaf122cd41527923403b8e99.png\"><img class=\"alignnone size-full wp-image-112156\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/41e84709aaf122cd41527923403b8e99.png\" alt=\"1-HZ-YQpdBM4hDbh4Q5FcsMA\"></a></p>\n<p>我们在隐藏层使用了20个神经元，你可以很容易地调整。这些参数将随着于您的训练数据规模的不同而不同，将错误率调整到低于10 ^ – 3是比较合理的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b141966309726\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX = np.array(training)\r\ny = np.array(output)\r\n\r\nstart_time = time.time()\r\n\r\ntrain(X, y, hidden_neurons=20, alpha=0.1, epochs=100000, dropout=False, dropout_percent=0.2)\r\n\r\nelapsed_time = time.time() - start_time\r\nprint (\"processing time:\", elapsed_time, \"seconds\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b141966309726-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b141966309726-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b141966309726-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b141966309726-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b141966309726-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b141966309726-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b141966309726-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b141966309726-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b141966309726-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b141966309726-1\"><span class=\"crayon-v\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b141966309726-2\"><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b141966309726-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b141966309726-4\"><span class=\"crayon-v\">start_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b141966309726-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b141966309726-6\"><span class=\"crayon-e\">train</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hidden_neurons</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alpha</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">epochs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dropout</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dropout_percent</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b141966309726-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b141966309726-8\"><span class=\"crayon-v\">elapsed_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_time</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b141966309726-9\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"processing time:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elapsed_time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"seconds\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b147686031995\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nTraining with 20 neurons, alpha:0.1, dropout:False \r\nInput matrix: 12x26    Output matrix: 1x3\r\ndelta after 10000 iterations:0.0062613597435\r\ndelta after 20000 iterations:0.00428296074919\r\ndelta after 30000 iterations:0.00343930779307\r\ndelta after 40000 iterations:0.00294648034566\r\ndelta after 50000 iterations:0.00261467859609\r\ndelta after 60000 iterations:0.00237219554105\r\ndelta after 70000 iterations:0.00218521899378\r\ndelta after 80000 iterations:0.00203547284581\r\ndelta after 90000 iterations:0.00191211022401\r\ndelta after 100000 iterations:0.00180823798397\r\nsaved synapses to: synapses.json\r\nprocessing time: 6.501226902008057 seconds</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b147686031995-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b147686031995-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b147686031995-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b147686031995-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b147686031995-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b147686031995-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b147686031995-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b147686031995-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b147686031995-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b147686031995-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b147686031995-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b147686031995-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b147686031995-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b147686031995-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b147686031995-1\"><span class=\"crayon-e\">Training </span><span class=\"crayon-i\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">neurons</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alpha</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dropout</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">False</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b147686031995-2\"><span class=\"crayon-e\">Input </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12x26</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Output </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1x3</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b147686031995-3\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.0062613597435</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b147686031995-4\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00428296074919</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b147686031995-5\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00343930779307</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b147686031995-6\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00294648034566</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b147686031995-7\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00261467859609</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b147686031995-8\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00237219554105</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b147686031995-9\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">70000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00218521899378</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b147686031995-10\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00203547284581</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b147686031995-11\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00191211022401</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b147686031995-12\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00180823798397</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b147686031995-13\"><span class=\"crayon-e\">saved </span><span class=\"crayon-e\">synapses </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b147686031995-14\"><span class=\"crayon-e\">processing </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.501226902008057</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seconds</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>synapse.json文件中包含了全部的连接权重，<strong>这就是我们的模型</strong>。</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/8b07f3b20cfc25210fcad980aebab930.jpeg\"><img class=\"alignnone size-full wp-image-112157\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8b07f3b20cfc25210fcad980aebab930.jpeg\" alt=\"1-qYkCgPE3DD26VD-qDwsicA\"></a></p>\n<p>一旦连接权重已经计算完成，对于分类来说只需要classify()函数了：大约15行代码</p>\n<p>备注：如果训练集有变化，我们的模型需要重新计算。对于非常大的数据集，这需要较长的时间。</p>\n<p>现在我们可以生成一个句子属于一个或者多个分类的概率了。它的速度非常快，这是因为我们之前定义的think()函数中的点积运算。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b14b314233899\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# probability threshold\r\nERROR_THRESHOLD = 0.2\r\n# load our calculated synapse values\r\nsynapse_file = 'synapses.json' \r\nwith open(synapse_file) as data_file: \r\n    synapse = json.load(data_file) \r\n    synapse_0 = np.asarray(synapse['synapse0']) \r\n    synapse_1 = np.asarray(synapse['synapse1'])\r\n\r\ndef classify(sentence, show_details=False):\r\n    results = think(sentence, show_details)\r\n\r\n    results = [[i,r] for i,r in enumerate(results) if r&gt;ERROR_THRESHOLD ] \r\n    results.sort(key=lambda x: x[1], reverse=True) \r\n    return_results =[[classes[r[0]],r[1]] for r in results]\r\n    print (\"%s n classification: %s\" % (sentence, return_results))\r\n    return return_results\r\n\r\nclassify(\"sudo make me a sandwich\")\r\nclassify(\"how are you today?\")\r\nclassify(\"talk to you tomorrow\")\r\nclassify(\"who are you?\")\r\nclassify(\"make me some lunch\")\r\nclassify(\"how was your lunch today?\")\r\nprint()\r\nclassify(\"good day\", show_details=True)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14b314233899-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14b314233899-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-1\"><span class=\"crayon-p\"># probability threshold</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-2\"><span class=\"crayon-v\">ERROR_THRESHOLD</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.2</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-3\"><span class=\"crayon-p\"># load our calculated synapse values</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-4\"><span class=\"crayon-v\">synapse_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'synapses.json'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-5\"><span class=\"crayon-e\">with </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data_file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'synapse0'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'synapse1'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">think</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-12\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">ERROR</span><span class=\"crayon-sy\">_</span>THRESHOLD<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reverse</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">return_results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%s n classification: %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">return_results</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">return_results</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-18\"> </div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-19\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"sudo make me a sandwich\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-20\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"how are you today?\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-21\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"talk to you tomorrow\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-22\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"who are you?\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-23\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"make me some lunch\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-24\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"how was your lunch today?\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14b314233899-25\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14b314233899-26\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"good day\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0048 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b14f079860821\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;strong&gt;sudo make me a sandwich &lt;/strong&gt;\r\n [['sandwich', 0.99917711814437993]]\r\n&lt;strong&gt;how are you today? &lt;/strong&gt;\r\n [['greeting', 0.99864563257858363]]\r\n&lt;strong&gt;talk to you tomorrow &lt;/strong&gt;\r\n [['goodbye', 0.95647479275905511]]\r\n&lt;strong&gt;who are you? &lt;/strong&gt;\r\n [['greeting', 0.8964283843977312]]\r\n&lt;strong&gt;make me some lunch&lt;/strong&gt; \r\n [['sandwich', 0.95371924052636048]]\r\n&lt;strong&gt;how was your lunch today? &lt;/strong&gt;\r\n [['greeting', 0.99120883810944971], ['sandwich', 0.31626066870883057]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b14f079860821-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14f079860821-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14f079860821-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14f079860821-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14f079860821-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14f079860821-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14f079860821-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14f079860821-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14f079860821-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14f079860821-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b14f079860821-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b14f079860821-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b14f079860821-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">me</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sandwich</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14f079860821-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99917711814437993</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14f079860821-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">how </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">you </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14f079860821-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99864563257858363</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14f079860821-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">talk </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-v\">tomorrow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14f079860821-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'goodbye'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95647479275905511</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14f079860821-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">who </span><span class=\"crayon-e\">are </span><span class=\"crayon-v\">you</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14f079860821-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.8964283843977312</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14f079860821-9\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">make </span><span class=\"crayon-e\">me </span><span class=\"crayon-e\">some </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14f079860821-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95371924052636048</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b14f079860821-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">how </span><span class=\"crayon-e\">was </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">lunch </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b14f079860821-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99120883810944971</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.31626066870883057</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>你可以用其它语句、不同概率来试验几次，也可以添加训练数据来改进／扩展当前的模型。尤其注意用很少的训练数据就得到稳定的预测结果。</p>\n<p>有一些句子将会产生多个预测结果（高于阈值）。你需要给你的程序设定一个合适的阈值。并非所有的文本分类方案都是相同的：<em>一些预测情况比其他预测需要更高的置信水平</em>。</p>\n<p>最后这个分类结果展示了一些内部的细节：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b154675239436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfound in bag: good\r\nfound in bag: day\r\nsentence: **good day** \r\n bow: [0 0 0 0 0 0 1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\r\ngood day \r\n [['greeting', 0.99664077655648697]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b154675239436-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b154675239436-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b154675239436-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b154675239436-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b154675239436-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b154675239436-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b154675239436-1\"><span class=\"crayon-e\">found </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">good</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b154675239436-2\"><span class=\"crayon-e\">found </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">day</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b154675239436-3\"><span class=\"crayon-v\">sentence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">good </span><span class=\"crayon-e \">day*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b154675239436-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bow</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b154675239436-5\"><span class=\"crayon-e\">good </span><span class=\"crayon-i\">day</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b154675239436-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99664077655648697</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>从这个句子的词包中可以看到，有两个单词和我们的词库是匹配的。同时我们的神经网络从这些 0 代表的非匹配词语中学习了。</p>\n<p>如果提供一个仅仅有一个常用单词 ‘a’ 被匹配的句子，那我们会得到一个低概率的分类结果A：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41807b15a626023647\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfound in bag: a\r\nsentence: **a burrito! **\r\n bow: [0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\r\na burrito! \r\n [['sandwich', 0.61776860634647834]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41807b15a626023647-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b15a626023647-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b15a626023647-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41807b15a626023647-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f41807b15a626023647-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41807b15a626023647-1\"><span class=\"crayon-e\">found </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b15a626023647-2\"><span class=\"crayon-v\">sentence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">burrito</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line\" id=\"crayon-599f41807b15a626023647-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bow</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41807b15a626023647-4\"><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">burrito</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-599f41807b15a626023647-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.61776860634647834</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>现在你已经掌握了构建聊天机器人的一些基础知识结构，它能处理大量不同的意图，并且对于有限或者海量的训练数据都能很好的适配。想要为某个意图添加一个或者多个响应实在轻而易举，就不必多讲了。</p>\n<h4>Enjoy!</h4>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/9d1537dc33c0a291a88e68a8d61b1cd2.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/ac2801b765615f93574f10b0ac15990b.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112049\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112049votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112049\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2106382253\">Anne90</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2106382253\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/ee02ba031bee9222a2878fe9565d65a6.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            软件开发测试工程师，关注互联网/软件测试相关        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2106382253\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2106382253/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2106382253/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2106382253\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/10", "fav_nums": 4, "tags": "IT技术,机器学习", "url": "http://blog.jobbole.com/112049/", "front_image_path": "full/dc3f3abe02d5786d6d2caa044b15d4e14cafdcfa.jpg", "praise_nums": "3", "title": "用神经网络训练一个文本分类器", "comment_nums": 4}
{"front_image_url": ["http://www.tkc8.com/images/sucai/img_crontab_1.png"], "url_object_id": "919eee6bab5d88995a4efb5f71a1e9de", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/3381391/blog/1510260\">大弹簧</a>   </div><p id=\"h3_0\">页面交互效果</p>\n<p>下面是写好的示例前端交互页面，主要是列表页面，编辑页面。</p>\n<p>主要交互有：</p>\n<p>1 开启定时任务进程<br>\n2 关闭定时任务进程<br>\n3 新增一项定时任务<br>\n4 编辑已有的定时任务<br>\n5 删除定时任务<br>\n6 开始一项定时任务<br>\n7 停止一项定时任务</p>\n<p>定时任务分两种：</p>\n<p>1 执行一次<br>\n2 循环执行</p>\n<p>定时任务执行的内容：</p>\n<p>定时任务执行的内容其实还是一个http请求。 通过定时的方式，指定时间执行或者循执行。</p>\n<h4 id=\"h4_1\">1 列表页面</h4>\n<p><img class=\"aligncenter\" src=\"http://www.tkc8.com/images/sucai/img_crontab_1.png\" alt=\"图片名称\"></p>\n<h4 id=\"h4_2\">2 新建\\编辑页面</h4>\n<p><img class=\"aligncenter\" src=\"http://www.tkc8.com/images/sucai/img_crontab_2.png\" alt=\"图片名称\"></p>\n<h3 id=\"h3_3\">代码地址，演示地址</h3>\n<p>示例代码是基于Laravel，Alpaca-spa框架编写，并且作为 ‘Alpaca-Spa-Laravel后台管理平台’的一个模块儿集成于系统中。</p>\n<p>代码 ： <a href=\"http://git.oschina.net/cc-sponge/Alpaca-Spa-Laravel\">http://git.oschina.net/cc-sponge/Alpaca-Spa-Laravel</a></p>\n<p>代码 ： <a href=\"https://github.com/big-sponge/Alpaca-Spa-Laravel\">https://github.com/big-sponge/Alpaca-Spa-Laravel</a></p>\n<p>Alpaca-Spa-Laravel ： <a href=\"http://full.tkc8.com/\">http://full.tkc8.com</a></p>\n<p>Alpaca-Spa ： <a href=\"http://www.tkc8.com/\">http://www.tkc8.com</a></p>\n<h3 id=\"h3_4\">适用范围</h3>\n<p>定时精确时间不低于1秒。web服务重启、或者php重启。该定时任务不会自动重启。</p>\n<h3 id=\"h3_5\">实现原理</h3>\n<p>用PHP实现定时任务（非linux-shell方式，与操作系统平台无关），主要两个技术点：</p>\n<p>1）PHP后台进程<br>\n2）PHP异步处理</p>\n<h4 id=\"h4_6\">1 PHP后台进程</h4>\n<p>一般情况，用命令行可以开启一个php后台进程。而在浏览器中通过HTTP请求一个php处理，会因为浏览器关闭，或者请求超时，使得后台的php处理中断。但是php提供了两个方法可以会忽略浏览器关闭、请求超时：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5a2581752672\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nignore_user_abort(true);     // 忽略客户端断开\r\nset_time_limit(0);           // 设置执行不超时</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5a2581752672-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5a2581752672-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5a2581752672-1\"><span class=\"crayon-e\">ignore_user_abort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// 忽略客户端断开</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5a2581752672-2\"><span class=\"crayon-e\">set_time_limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 设置执行不超时</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>因此，我们可以使用这两个函数从浏览器以HTTP请求的方式开启一个php后台进程。</p>\n<h4 id=\"h4_7\">2 PHP异步处理</h4>\n<p>php语言本身没有可以跨平台好用异步处理方法，但是可以通过curl或者fsockopen创建一个请求来实现异步处理。这里我们用fsockopen方法实现：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5ac551004009\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$fp = fsockopen(\"$ip\", $port, $errno, $errstr,1);\r\n        if (!$fp) {\r\n            return 'worker error:'.\"$errstr ($errno)&lt;br /&gt;\\n\";\r\n        } else {\r\n            $out = \"POST $url HTTP/1.1\\r\\n\";\r\n            $out .= \"Host: $ip\\r\\n\";\r\n            $out .= \"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\";\r\n            $out .= \"Content-Length: \" . strlen($postData) . \"\\r\\n\";\r\n            $out .= \"Connection: close\\r\\n\";\r\n            $out .=\"\\r\\n\";\r\n            $out .=$postData;\r\n            fputs($fp, $out);\r\n            fclose($fp);\r\n        }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5ac551004009-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5ac551004009-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5ac551004009-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5ac551004009-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5ac551004009-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5ac551004009-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5ac551004009-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5ac551004009-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5ac551004009-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5ac551004009-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5ac551004009-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5ac551004009-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5ac551004009-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5ac551004009-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5ac551004009-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fsockopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"$ip\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errno</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errstr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5ac551004009-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5ac551004009-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker error:'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"$errstr ($errno)&lt;br /&gt;\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5ac551004009-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5ac551004009-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"POST $url HTTP/1.1\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5ac551004009-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Host: $ip\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5ac551004009-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5ac551004009-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Length: \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5ac551004009-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Connection: close\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5ac551004009-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5ac551004009-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5ac551004009-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fputs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5ac551004009-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5ac551004009-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p></p>\n<h3 id=\"h3_8\">前台交互控制器</h3>\n<p>为了在前端界面方便控制定时任务的开启关闭，新增、编辑、删除，查看执行状态。 同时也可以添加权限控制。 主要有8个操作接口(下面是以Laravel 路由示例)：</p>\n<p>1 查看定时任务进程状态<br>\n2 开始定时任务进程 3 停止定时任务进程<br>\n4 添加,或者编辑定时任务<br>\n5 设置定时任务状态<br>\n6 获取指定定时任务明细<br>\n7 删除定时任务<br>\n8 获取定时任务列表</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5b1023627779\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/* crontab - status 查看定时任务守护进程状态 */\r\nRoute::any('crontab/status', \"CrontabController@status\");\r\n\r\n/* crontab - start 开始定时任务 */\r\nRoute::any('crontab/start', \"CrontabController@start\");\r\n\r\n/* crontab - stop  停止定时任务守护进程*/\r\nRoute::any('crontab/stop', \"CrontabController@stop\");\r\n\r\n/* crontab - editTask  添加,或者编辑定时任务*/\r\nRoute::any('crontab/editTask', \"CrontabController@editTask\");\r\n\r\n/* crontab - changeTaskStatus  设置定时任务状态 */\r\nRoute::any('crontab/changeTaskStatus', \"CrontabController@changeTaskStatus\");\r\n\r\n/* crontab - getIndexTask  获取指定定时任务 */\r\nRoute::any('crontab/getIndexTask', \"CrontabController@getIndexTask\");\r\n\r\n/* crontab - removeTask  删除定时任务 */\r\nRoute::any('crontab/removeTask', \"CrontabController@removeTask\");\r\n\r\n/* crontab - listTask  获取定时任务列表 */\r\nRoute::any('crontab/listTask', \"CrontabController@listTask\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b1023627779-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b1023627779-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-1\"><span class=\"crayon-c\">/* crontab - status 查看定时任务守护进程状态 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-2\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/status'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@status\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-4\"><span class=\"crayon-c\">/* crontab - start 开始定时任务 */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-5\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/start'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@start\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-6\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-7\"><span class=\"crayon-c\">/* crontab - stop  停止定时任务守护进程*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-8\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/stop'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@stop\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-10\"><span class=\"crayon-c\">/* crontab - editTask  添加,或者编辑定时任务*/</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-11\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/editTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@editTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-12\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-13\"><span class=\"crayon-c\">/* crontab - changeTaskStatus  设置定时任务状态 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-14\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/changeTaskStatus'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@changeTaskStatus\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-16\"><span class=\"crayon-c\">/* crontab - getIndexTask  获取指定定时任务 */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-17\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/getIndexTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@getIndexTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-18\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-19\"><span class=\"crayon-c\">/* crontab - removeTask  删除定时任务 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-20\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/removeTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@removeTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b1023627779-22\"><span class=\"crayon-c\">/* crontab - listTask  获取定时任务列表 */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b1023627779-23\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/listTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@listTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>完整的类代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5b5978112410\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace App\\Modules\\Manage\\Controllers;\r\n\r\nuse Crontab\\Library\\Crontab\\AlpacaCrontab;\r\nuse Crontab\\Library\\Crontab\\AlpacaDaemon;\r\nuse Crontab\\Library\\Crontab\\AlpacaWorker;\r\nuse App\\Modules\\Manage\\Controllers\\Base\\BaseController;\r\nuse App\\Common\\Code;\r\nuse App\\Common\\Msg;\r\n\r\n/**\r\n * 定时任务管理控制器\r\n * @author Chengcheng\r\n * @date 2016-10-19 15:50:00\r\n */\r\nclass CrontabController extends BaseController\r\n{\r\n    /**\r\n     * 设置不需要登录的的Action,不加Action前缀\r\n     * @author Chengcheng\r\n     * @date   2016年10月23日 20:39:25\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    protected function noLogin()\r\n    {\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * 设置不需要权限验证的Action,不加Action前缀\r\n     * @author Chengcheng\r\n     * @date   2016年10月23日 20:39:25\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    protected function noAuth()\r\n    {\r\n        // 以下Action不需要角色权限\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * 查看定时任务守护进程状态\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function status()\r\n    {\r\n        //查看守护进程状态\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaDaemon::daemon()-&gt;status();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 开始定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function start()\r\n    {\r\n        //异步开启守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaWorker::worker()-&gt;action(['REQUEST_URI' =&gt; \"/crontab/index/start\"]);\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 停止定时任务守护进程\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function stop()\r\n    {\r\n        //停止守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaDaemon::daemon()-&gt;stop();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 添加,或者编辑定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function editTask()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * BEGIN_TIME        开始时间\r\n         * END_TIME          结束时间\r\n         * INTERVAL          时间间隔\r\n         * NAME              名称\r\n         * STATUS            状态 1-ENABLED,   2-DISABLE\r\n         * TASK_TYPE         类型 1-ONCE,      2-LOOP\r\n         * ACTION            要执行的Action\r\n         * INDEX             索引，null或者0时候，表示新建\r\n         * */\r\n        $this-&gt;requestData['NAME']       = $this-&gt;input('NAME', null);\r\n        $this-&gt;requestData['BEGIN_TIME'] = $this-&gt;input('BEGIN_TIME', null);\r\n        $this-&gt;requestData['END_TIME']   = $this-&gt;input('END_TIME', null);\r\n        $this-&gt;requestData['INTERVAL']   = $this-&gt;input('INTERVAL', null);\r\n        $this-&gt;requestData['TASK_TYPE']  = $this-&gt;input('TASK_TYPE', '1');\r\n        $this-&gt;requestData['ACTION']     = $this-&gt;input('ACTION', null);\r\n        $this-&gt;requestData['STATUS']     = $this-&gt;input('STATUS', '2');\r\n        $this-&gt;requestData['INDEX']      = $this-&gt;input('INDEX', null);\r\n        $this-&gt;requestData['LAST_TIME']  = $this-&gt;input('LAST_TIME', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['BEGIN_TIME'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'BEGIN_TIME');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if ($this-&gt;requestData['TASK_TYPE'] == 2 &amp;&amp; empty($this-&gt;requestData['END_TIME'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'END_TIME');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if (empty($this-&gt;requestData['ACTION'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'ACTION');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if ($this-&gt;requestData['TASK_TYPE'] == 2 &amp;&amp; empty($this-&gt;requestData['INTERVAL'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INTERVAL');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 设置结束时间\r\n        $now      = date('Y-m-d H:i:s', time());\r\n        $nextTime = date('Y-m-d H:i:s', strtotime($this-&gt;requestData['INTERVAL'], strtotime($this-&gt;requestData['BEGIN_TIME'])));\r\n        if ($this-&gt;requestData['TASK_TYPE'] == \"1\" || strtotime($now) &lt; strtotime($this-&gt;requestData['BEGIN_TIME'])) {\r\n            $nextTime = $this-&gt;requestData['BEGIN_TIME'];\r\n        }\r\n\r\n        //4 创建任务\r\n        $task = array(\r\n            'NAME'       =&gt; $this-&gt;requestData['NAME'],           //NAME\r\n            'STATUS'     =&gt; $this-&gt;requestData['STATUS'],         // 1-ENABLED,   2-DISABLE\r\n            'TYPE'       =&gt; $this-&gt;requestData['TASK_TYPE'],      // 1-ONCE,      2-LOOP\r\n            'INTERVAL'   =&gt; $this-&gt;requestData['INTERVAL'],       //year（年），month（月），hour（小时）minute（分），second（秒）\r\n            'BEGIN_TIME' =&gt; $this-&gt;requestData['BEGIN_TIME'],     //开始时间\r\n            'NEXT_TIME'  =&gt; $nextTime,                            //下次执行时间\r\n            'LAST_TIME'  =&gt; $this-&gt;requestData['LAST_TIME'],      //上次执行时间\r\n            'ACTION'     =&gt; $this-&gt;requestData['ACTION'],         //执行的ACTION\r\n            'END_TIME'   =&gt; $this-&gt;requestData['END_TIME'],       //截止时间2\r\n        );\r\n\r\n        //5 判断是新建还是修改\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            //新建\r\n            $info = AlpacaCrontab::crontab()-&gt;addTask($task);\r\n        } else {\r\n            $this-&gt;requestData['INDEX'] -= 1;\r\n            $info = AlpacaCrontab::crontab()-&gt;editTask($this-&gt;requestData['INDEX'], $task);\r\n        }\r\n\r\n        //5 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $info;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 设置定时任务状态\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function changeTaskStatus()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * STATUS            状态 1-ENABLED,   2-DISABLE\r\n         * INDEX             索引\r\n         * */\r\n        $this-&gt;requestData['STATUS'] = $this-&gt;input('STATUS', '2');\r\n        $this-&gt;requestData['INDEX']  = $this-&gt;input('INDEX', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['STATUS'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'STATUS');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INDEX');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 修改状态\r\n        $this-&gt;requestData['INDEX'] -= 1;\r\n        $data = AlpacaCrontab::crontab()-&gt;editTaskStatus($this-&gt;requestData['INDEX'], $this-&gt;requestData['STATUS']);\r\n\r\n        //4 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 查找单条定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function getIndexTask()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * INDEX             索引\r\n         * */\r\n        $this-&gt;requestData['INDEX'] = $this-&gt;input('INDEX', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INDEX');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 删除\r\n        $this-&gt;requestData['INDEX'] -= 1;\r\n        $data = AlpacaCrontab::crontab()-&gt;getIndexTask($this-&gt;requestData['INDEX']);\r\n\r\n        //4 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 删除定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function removeTask()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * INDEX             索引\r\n         * */\r\n        $this-&gt;requestData['INDEX'] = $this-&gt;input('INDEX', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INDEX');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 删除\r\n        $this-&gt;requestData['INDEX'] -= 1;\r\n        $data = AlpacaCrontab::crontab()-&gt;removeTask($this-&gt;requestData['INDEX']);\r\n\r\n        //4 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 查看定时任务列表\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function listTask()\r\n    {\r\n        //查找\r\n        $data['task']   = AlpacaCrontab::crontab()-&gt;listTask();\r\n        $data['total']  = count($data['task']);\r\n        $data['status'] = AlpacaDaemon::daemon()-&gt;status();\r\n\r\n        //返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-262\">262</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-263\">263</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-264\">264</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-265\">265</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-266\">266</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-267\">267</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-268\">268</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-269\">269</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-270\">270</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-271\">271</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-272\">272</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-273\">273</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-274\">274</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-275\">275</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-276\">276</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-277\">277</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-278\">278</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-279\">279</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-280\">280</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-281\">281</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-282\">282</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-283\">283</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-284\">284</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-285\">285</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-286\">286</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-287\">287</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-288\">288</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-289\">289</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-290\">290</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-291\">291</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-292\">292</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5b5978112410-293\">293</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5b5978112410-294\">294</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-2\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Modules</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Manage</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-4\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-5\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-6\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-7\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-8\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Modules</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Manage</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">BaseController</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-9\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Code</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-10\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-12\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-13\"><span class=\"crayon-c\"> * 定时任务管理控制器</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-14\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-15\"><span class=\"crayon-c\"> * @date 2016-10-19 15:50:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-16\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-17\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CrontabController</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BaseController</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-20\"><span class=\"crayon-c\">     * 设置不需要登录的的Action,不加Action前缀</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-21\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-22\"><span class=\"crayon-c\">     * @date   2016年10月23日 20:39:25</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-23\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-24\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">noLogin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-31\"><span class=\"crayon-c\">     * 设置不需要权限验证的Action,不加Action前缀</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-32\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-33\"><span class=\"crayon-c\">     * @date   2016年10月23日 20:39:25</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-34\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-35\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">noAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 以下Action不需要角色权限</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-43\"><span class=\"crayon-c\">     * 查看定时任务守护进程状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-44\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-45\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-46\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//查看守护进程状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-53\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-57\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-59\"><span class=\"crayon-c\">     * 开始定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-60\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-61\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-62\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//异步开启守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/crontab/index/start\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-73\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-75\"><span class=\"crayon-c\">     * 停止定时任务守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-76\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-77\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-78\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//停止守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-83\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-85\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-87\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-89\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-91\"><span class=\"crayon-c\">     * 添加,或者编辑定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-92\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-93\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-94\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-97\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-98\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-99\"><span class=\"crayon-c\">         * BEGIN_TIME        开始时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-100\"><span class=\"crayon-c\">         * END_TIME          结束时间</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-101\"><span class=\"crayon-c\">         * INTERVAL          时间间隔</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-102\"><span class=\"crayon-c\">         * NAME              名称</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-103\"><span class=\"crayon-c\">         * STATUS            状态 1-ENABLED,   2-DISABLE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-104\"><span class=\"crayon-c\">         * TASK_TYPE         类型 1-ONCE,      2-LOOP</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-105\"><span class=\"crayon-c\">         * ACTION            要执行的Action</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-106\"><span class=\"crayon-c\">         * INDEX             索引，null或者0时候，表示新建</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-107\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-108\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-109\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-110\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-114\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-115\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-116\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-117\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-118\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-119\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-120\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-121\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-122\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-123\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-125\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-126\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-127\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-130\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-131\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-132\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-133\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-134\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-135\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-136\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-137\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-138\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-139\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-140\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 设置结束时间</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-141\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-142\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nextTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-143\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-144\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nextTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-146\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-147\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 创建任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-149\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">//NAME</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-150\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">// 1-ENABLED,   2-DISABLE</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-151\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// 1-ONCE,      2-LOOP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-152\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">//year（年），month（月），hour（小时）minute（分），second（秒）</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-153\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">//开始时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-154\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nextTime</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">                            </span><span class=\"crayon-c\">//下次执行时间</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-155\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">//上次执行时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-156\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">//执行的ACTION</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-157\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">//截止时间2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-158\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-159\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-160\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//5 判断是新建还是修改</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-161\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-162\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//新建</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-163\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-164\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-165\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-166\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">editTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-167\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-168\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-169\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//5 返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-170\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-171\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-172\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">info</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-173\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-174\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-175\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-176\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-177\"><span class=\"crayon-c\">     * 设置定时任务状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-178\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-179\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-180\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-181\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">changeTaskStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-182\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-183\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-184\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-185\"><span class=\"crayon-c\">         * STATUS            状态 1-ENABLED,   2-DISABLE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-186\"><span class=\"crayon-c\">         * INDEX             索引</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-187\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-188\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-189\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-190\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-191\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-192\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-193\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-194\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-195\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-196\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-197\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-198\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-200\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-201\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-202\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-203\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 修改状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-204\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-205\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">editTaskStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-206\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-207\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-208\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-209\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-210\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-211\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-212\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-213\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-214\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-215\"><span class=\"crayon-c\">     * 查找单条定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-216\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-217\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-218\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-219\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getIndexTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-221\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-222\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-223\"><span class=\"crayon-c\">         * INDEX             索引</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-224\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-225\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-226\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-227\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-228\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-229\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-230\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-231\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-232\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-233\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-234\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 删除</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-235\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-236\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getIndexTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-237\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-238\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 返回结果</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-239\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-240\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-241\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-242\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-243\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-244\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-245\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-246\"><span class=\"crayon-c\">     * 删除定时任务</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-247\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-248\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-249\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-250\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">removeTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-251\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-252\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-253\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-254\"><span class=\"crayon-c\">         * INDEX             索引</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-255\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-256\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-257\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-258\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-259\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-260\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-261\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-262\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-263\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-264\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-265\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 删除</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-266\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-267\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">removeTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-268\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-269\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-270\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-271\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-272\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-273\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-274\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-275\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-276\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-277\"><span class=\"crayon-c\">     * 查看定时任务列表</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-278\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-279\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-280\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-281\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-282\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-283\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-284\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'task'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">listTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-285\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'total'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'task'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-286\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'status'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-287\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-288\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-289\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-290\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-291\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-292\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5b5978112410-293\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5b5978112410-294\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0385 seconds] -->\r\n<p></p>\n<h3 id=\"h3_9\">实现后台进程类</h3>\n<p>使用 ignore_user_abort(true); set_time_limit(0); 可以从浏览器开启一个php后台进程。为了避免出现多个后台进程，需要借助一个配置来标识该后台进程是否已经启动</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5c6355496274\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\"code\":\"1001\",\"message\":\"Stop at:2017-02-24 11:29:43\"}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5c6355496274-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5c6355496274-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"Stop at:2017-02-24 11:29:43\"</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>当code是1001时候，表示后台进程未启动，这时通过http请求开启后台进程时，正常启动</p>\n<p>当code是1000时候，表示后台进程已经启动，这时通过http请求开启后台进程时，不做任何操作，以为进程已经启动</p>\n<p>当开启后台进程的请求到达后台时候，读取配置文件，如果code是1001，则启动进程，并且设置code为1000，保存配置文件。</p>\n<p>当关闭后台进程的请求到达后台时候，读取配置文件，设置code为1001，保存配置文件。</p>\n<p>后台进程在运行时候，每隔一秒读取配置文件，判断code状态，如果是1001，则结束执行； 如果是1000，则继续执行</p>\n<p>完整类的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5cb449265412\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Library\\Crontab;\r\n/**\r\n * 守护进程\r\n * @author Chengcheng\r\n * @date 2016年10月21日 17:04:44\r\n */\r\nclass AlpacaDaemon\r\n{\r\n    private $daemon_json = __DIR__ . '/deamon.json';\r\n\r\n    private static $instance;\r\n\r\n    private $events = [];\r\n\r\n    public static function daemon()\r\n    {\r\n        return self::getInstance();\r\n    }\r\n\r\n    private static function getInstance()\r\n    {\r\n        if(!self::$instance){\r\n            self::$instance = new self();\r\n            self::$instance-&gt;daemon_json = base_path('storage') . '/crontab/deamon.json';\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    public function setDaemon($daemon_json)\r\n    {\r\n        $this-&gt;daemon_json = $daemon_json;\r\n        return $this;\r\n    }\r\n\r\n    public function setEvents(array $events)\r\n    {\r\n        $this-&gt;events = $events;\r\n        return $this;\r\n    }\r\n\r\n    public function status()\r\n    {\r\n        $data = json_decode(file_get_contents($this-&gt;daemon_json),true);\r\n        if(empty($data)){\r\n            $data = array();\r\n        }\r\n        return $data;\r\n    }\r\n\r\n    public function stop()\r\n    {\r\n        $data =new \\stdClass();\r\n        $data-&gt;code=\"1001\";\r\n        $data-&gt;message=\"Stop at:\".date(\"Y-m-d H:i:s\" ,time());\r\n        file_put_contents($this-&gt;daemon_json,json_encode($data),LOCK_EX);\r\n\r\n        $result[\"result_code\"] = \"1\";\r\n        $result[\"result_message\"] = \"操作成功\";\r\n        return $result;\r\n    }\r\n\r\n    public function start()\r\n    {\r\n        $data = json_decode(file_get_contents($this-&gt;daemon_json) , true);\r\n        if(empty($data)){\r\n            $data['code']=\"1001\";\r\n        }\r\n\r\n        if($data['code'] == \"1000\" ){\r\n            //die(\"Error - exit,   Already running !\");\r\n            return;\r\n        }\r\n\r\n        $data['code']=\"1000\";\r\n        $data['message']=\"Start\";\r\n        file_put_contents($this-&gt;daemon_json,json_encode($data),LOCK_EX);\r\n\r\n        ignore_user_abort(true);     // 忽略客户端断开\r\n        set_time_limit(0);           // 设置执行不超时\r\n\r\n\r\n        while(true){\r\n            $data = json_decode(file_get_contents($this-&gt;daemon_json) , true);\r\n            if(empty($data) || empty($data['code']) || $data['code'] == \"1001\" ){\r\n                break;\r\n            }\r\n\r\n            if(!empty($this-&gt;events)){\r\n                foreach ($this-&gt;events as $e){\r\n                    $e();\r\n                }\r\n            }\r\n\r\n            $data['message'] = date(\"Y-m-d H:i:s\" ,time()).\" : Working ...\";\r\n            file_put_contents($this-&gt;daemon_json, json_encode($data), LOCK_EX);\r\n            sleep(1);\r\n        }\r\n        $this-&gt;stop();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5cb449265412-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5cb449265412-102\">102</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-2\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-4\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-5\"><span class=\"crayon-c\"> * 守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-6\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-7\"><span class=\"crayon-c\"> * @date 2016年10月21日 17:04:44</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-8\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AlpacaDaemon</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__DIR_</span><span class=\"crayon-sy\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/deamon.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-12\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-14\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-16\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">base_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'storage'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/crontab/deamon.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-30\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setDaemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-36\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-42\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e\">stdClass</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">message</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Stop at:\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Y-m-d H:i:s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-58\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"操作成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-68\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-70\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1000\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-72\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//die(\"Error - exit,   Already running !\");</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-73\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-75\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1000\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Start\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-78\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-79\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-80\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ignore_user_abort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// 忽略客户端断开</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">set_time_limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 设置执行不超时</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-82\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-83\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-85\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-86\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-87\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-88\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-89\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-90\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-91\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">events </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-92\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">e</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-93\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-94\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-95\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-96\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Y-m-d H:i:s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\" : Working ...\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-98\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-99\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-100\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5cb449265412-101\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5cb449265412-102\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0122 seconds] -->\r\n<p></p>\n<h3 id=\"h3_10\">实现异步处理的类</h3>\n<p>完整类的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5d1629871030\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Library\\Crontab;\r\nclass AlpacaWorker\r\n{        \r\n    private static $instance;\r\n\r\n    private $accessToken = '';\r\n\r\n    public static function worker()\r\n    {\r\n        return self::getInstance();\r\n    }\r\n\r\n    private static function getInstance()\r\n    {\r\n        if(!self::$instance){\r\n            self::$instance = new self();\r\n            self::$instance-&gt;accessToken= 'VyKfohBbwlkTOqp2jvIWPW92';\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    public function action(array $worker = null)\r\n    {\r\n        //获取参数\r\n        $ip   = empty($worker['SERVER_ADDR']) ? $_SERVER['SERVER_NAME'] : $worker['SERVER_ADDR'];     //服务器IP地址\r\n        $port = empty($worker['SERVER_PORT']) ? $_SERVER['SERVER_PORT'] : $worker['SERVER_PORT'];     //服务器端口\r\n        $url  = empty($worker['REQUEST_URI']) ? '/' :$worker['REQUEST_URI'];                          //服务器URL\r\n        $data = empty($worker['REQUEST_DATA']) ? '' :$worker['REQUEST_DATA'];                         //请求参数\r\n\r\n        //格式化请求参数\r\n        $postData = \"\";\r\n        $needChar = false;\r\n        if(is_array($data)){\r\n            foreach($data as $key =&gt; $val) {\r\n                $postData .= ($needChar ? \"&amp;\" : \"\") . urlencode($key) . \"=\" . urlencode($val);\r\n                $needChar = true;\r\n            }\r\n        }else{\r\n            $postData = $data;\r\n        }\r\n\r\n        $url=$url.\"?accessToken=\".$this-&gt;accessToken;\r\n\r\n        //使用fsockopen方式异步调用action\r\n        $fp = fsockopen(\"$ip\", $port, $errno, $errstr,1);\r\n        if (!$fp) {\r\n            return 'worker error:'.\"$errstr ($errno)&lt;br /&gt;\\n\";\r\n        } else {\r\n            $out = \"POST $url HTTP/1.1\\r\\n\";\r\n            $out .= \"Host: $ip\\r\\n\";\r\n            $out .= \"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\";\r\n            $out .= \"Content-Length: \" . strlen($postData) . \"\\r\\n\";\r\n            $out .= \"Connection: close\\r\\n\";\r\n            $out .=\"\\r\\n\";\r\n            $out .=$postData;\r\n            fputs($fp, $out);\r\n            fclose($fp);\r\n        }       \r\n        return 'worker success!';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5d1629871030-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d1629871030-63\">63</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-2\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AlpacaWorker</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-5\"><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">accessToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-14\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">accessToken</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'VyKfohBbwlkTOqp2jvIWPW92'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//获取参数</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">ip</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_ADDR'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">_SERVER</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_NAME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_ADDR'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">//服务器IP地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_PORT'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">_SERVER</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_PORT'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_PORT'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">//服务器端口</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">url</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                          </span><span class=\"crayon-c\">//服务器URL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_DATA'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_DATA'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                         </span><span class=\"crayon-c\">//请求参数</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//格式化请求参数</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">needChar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">is_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">data </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">postData</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">needChar</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">urlencode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">urlencode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">needChar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-43\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"?accessToken=\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">accessToken</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//使用fsockopen方式异步调用action</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fsockopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"$ip\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errno</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errstr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker error:'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"$errstr ($errno)&lt;br /&gt;\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"POST $url HTTP/1.1\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-52\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Host: $ip\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Length: \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-55\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Connection: close\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-58\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fputs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">       </span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker success!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5d1629871030-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5d1629871030-63\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0102 seconds] -->\r\n<p></p>\n<h3 id=\"h3_11\">定时任务处理类</h3>\n<p>定时任务处理类 主要是实现新增、编辑、删除定时任务，执行定时任务要处理的方法</p>\n<p>定时任务的信息以json格式存放在下面的配置文件中</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5d7441402774\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[{\"NAME\":\"\\u6d4b\\u8bd5\\u5b9a\\u65f6\\u4efb\\u52a12\",\"STATUS\":\"2\",\"TYPE\":\"1\",\"INTERVAL\":\"5 second\",\"BEGIN_TIME\":\"2017-02-21 11:55:00\",\"NEXT_TIME\":\"2017-02-21 11:55:00\",\"LAST_TIME\":null,\"ACTION\":\"\\/main\\/crontab\\/index2\",\"END_TIME\":\"2017-02-10 15:55:00\"},{\"NAME\":\"TEST - log\",\"STATUS\":\"2\",\"TYPE\":\"2\",\"INTERVAL\":\"5 second\",\"BEGIN_TIME\":\"2017-08-10 09:00:53\",\"NEXT_TIME\":\"2017-08-10 09:59:00\",\"LAST_TIME\":\"2017-08-10 09:58:55\",\"ACTION\":\"\\/crontab\\/task\\/test\",\"END_TIME\":\"2017-08-11 09:25:53\"}]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5d7441402774-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5d7441402774-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"NAME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"\\u6d4b\\u8bd5\\u5b9a\\u65f6\\u4efb\\u52a12\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"STATUS\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"TYPE\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"INTERVAL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"5 second\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"BEGIN_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-02-21 11:55:00\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"NEXT_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-02-21 11:55:00\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"LAST_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"ACTION\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"\\/main\\/crontab\\/index2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"END_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-02-10 15:55:00\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"NAME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"TEST - log\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"STATUS\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"TYPE\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"INTERVAL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"5 second\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"BEGIN_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-10 09:00:53\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"NEXT_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-10 09:59:00\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"LAST_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-10 09:58:55\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"ACTION\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"\\/crontab\\/task\\/test\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"END_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-11 09:25:53\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>主要的字段为：</p>\n<p>INDEX 索引<br>\nBEGIN_TIME 开始时间<br>\nEND_TIME 结束时间<br>\nINTERVAL 时间间隔<br>\nNAME 名称<br>\nSTATUS 状态 1-ENABLED, 2-DISABLE<br>\nTASK_TYPE 类型 1-ONCE, 2-LOOP<br>\nACTION 要执行的Action</p>\n<p>类中主要有7个方法：</p>\n<p>listTask() 查看定时任务列表 addTask() 添加定时任务 editTask() 编辑定时任务 editTaskStatus() 编辑定时任务状态 getIndexTask() 获取指定定时任务信息 removeTask() 删除定时任务 doTask() 执行定时任务指定的任务</p>\n<p>完整类的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5db705392496\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Library\\Crontab;\r\n/**\r\n * 定时任务\r\n * @author Chengcheng\r\n * @date 2016年10月21日 17:04:44\r\n */\r\nclass AlpacaCrontab\r\n{\r\n    //定时任务文件\r\n    private $task_json = __DIR__ .'/crontab.json';\r\n\r\n    //单例\r\n    private static $instance;\r\n\r\n    //单例\r\n    public static function crontab()\r\n    {\r\n        return self::getInstance();\r\n    }\r\n\r\n    //单例\r\n    private static function getInstance()\r\n    {\r\n        if(!self::$instance){\r\n            self::$instance = new self();\r\n            self::$instance-&gt;task_json = base_path('storage') . '/crontab/crontab.json';\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    /**\r\n     * 配置\r\n     * @author Chengcheng\r\n     * @param array $crontab\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function setConfig($crontab)\r\n    {\r\n        $this-&gt;task_json = $crontab;\r\n        return $this;\r\n    }\r\n\r\n    /**\r\n     * 查看定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function listTask()\r\n    {\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $i = 0;\r\n        foreach ($tasks as $task)\r\n        {\r\n            $tasks[$i]-&gt;INTERVAL = $this-&gt;timeToStr($tasks[$i]-&gt;INTERVAL);\r\n            $i++;\r\n        }\r\n        return $tasks;\r\n    }\r\n\r\n    /**\r\n     * 添加定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function addTask($task)\r\n    {\r\n        $result[\"result_code\"] = \"1\";\r\n        $result[\"result_message\"] = \"添加成功\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json),true);\r\n        $tasks[count($tasks)] = $task;\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result;\r\n    }\r\n\r\n    /**\r\n     * 编辑定时任务\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @param string $task\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function editTask($index,$task)\r\n    {\r\n        $result[\"result_code\"] = \"1\";\r\n        $result[\"result_message\"] = \"修改成功\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $tasks[$index] = $task;\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result;\r\n    }\r\n\r\n    /**\r\n     * 编辑定时任务状态\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @param string $status\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function editTaskStatus($index,$status)\r\n    {\r\n        $result_data[\"result_code\"] = \"1\";\r\n        $result_data[\"result_message\"] = \"修改状态成功[\".$status.\"]\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $tasks[$index]-&gt;STATUS = $status;\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result_data;\r\n    }\r\n\r\n    /**\r\n     * 获取定时任务\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function getIndexTask($index)\r\n    {\r\n        $result_data[\"result_code\"] = \"1\";\r\n        $result_data[\"result_message\"] = \"获取任务成功【\".$index.\"】\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $result_data[\"result_data\"] = $tasks[$index];\r\n        return $result_data;\r\n    }\r\n\r\n    /**\r\n     * 删除定时任务\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function removeTask($index)\r\n    {\r\n        $result_data[\"result_code\"] = \"1\";\r\n        $result_data[\"result_message\"] = \"删除任务【\".$index.\"】成功\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        array_splice($tasks, $index, 1);\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result_data;\r\n    }\r\n\r\n    /**\r\n     * 执行定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function doTask()\r\n    {\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json) ,true);      \r\n        if(empty($tasks)){ return ;}\r\n\r\n        $now = date('Y-m-d H:i:s',time());\r\n        foreach ($tasks as &amp;$task){\r\n            if(empty($task['STATUS']) || empty($task['TYPE'])  || empty($task['BEGIN_TIME']) || empty($task['ACTION']) )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if($task['STATUS'] != 1)\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if(!empty($task['END_TIME']) &amp;&amp; strtotime($now)&gt;=strtotime($task['END_TIME'])){\r\n                $task['NEXT_TIME']='END';\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 1 &amp;&amp; empty($task['NEXT_TIME']) )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 2 &amp;&amp; empty($task['INTERVAL']) )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if(!empty($task['NEXT_TIME']) &amp;&amp; $task['NEXT_TIME']=='END' )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 1 &amp;&amp; (strtotime($now)&gt;=strtotime($task['NEXT_TIME'])))\r\n            {\r\n                $task['LAST_TIME']= $now;\r\n                $task['NEXT_TIME']='END';\r\n                $task['STATUS']=2;\r\n                AlpacaWorker::worker()-&gt;action(['REQUEST_URI'=&gt;\"{$task['ACTION']}\"]);\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 2)\r\n            {\r\n                if(empty($task['NEXT_TIME'])){\r\n                    $task['NEXT_TIME'] = $task['BEGIN_TIME'];\r\n                }\r\n\r\n                if(strtotime($now)&gt;=strtotime($task['NEXT_TIME'])){\r\n                    $task['LAST_TIME']= $now;\r\n                    $task['NEXT_TIME']= date('Y-m-d H:i:s',strtotime($task['INTERVAL']));\r\n                    AlpacaWorker::worker()-&gt;action(['REQUEST_URI'=&gt;\"{$task['ACTION']}\"]);\r\n                }\r\n                continue;\r\n            }\r\n        }\r\n\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $tasks;\r\n    }\r\n\r\n    /**\r\n     * 格式化时间\r\n     * @author Chengcheng\r\n     * @param string $interval\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    private function timeToStr($interval)\r\n    {\r\n        $result = \"\";\r\n        if($interval != null &amp;&amp; $interval != \"\"){\r\n            $temp = explode(\" \", $interval);\r\n            $iNumTemp = $temp[0];\r\n            $iType = $temp[1];\r\n            $iNum = str_replace(\"+\", \"\", $iNumTemp);\r\n            $str = \"\";\r\n            switch ($iType){\r\n                case \"year\":\r\n                    $str = \"（年）\";\r\n                    break;\r\n                case \"month\":\r\n                    $str = \"（月）\";\r\n                    break;\r\n                case \"day\":\r\n                    $str = \"（日）\";\r\n                    break;\r\n                case \"hour\":\r\n                    $str = \"（小时）\";\r\n                    break;\r\n                case \"minute\":\r\n                    $str = \"（分）\";\r\n                    break;\r\n                case \"second\":\r\n                    $str = \"（秒）\";\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n           $result = $iNum. $str;\r\n        }\r\n        return $result;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5db705392496-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5db705392496-262\">262</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-2\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-4\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-5\"><span class=\"crayon-c\"> * 定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-6\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-7\"><span class=\"crayon-c\"> * @date 2016年10月21日 17:04:44</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-8\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AlpacaCrontab</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//定时任务文件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__DIR_</span><span class=\"crayon-sy\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">'/crontab.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//单例</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-16\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//单例</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-22\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//单例</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">base_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'storage'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/crontab/crontab.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-32\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-34\"><span class=\"crayon-c\">     * 配置</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-35\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-36\"><span class=\"crayon-c\">     * @param array $crontab</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-37\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-38\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-39\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">crontab</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-47\"><span class=\"crayon-c\">     * 查看定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-48\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-49\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-50\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-51\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">tasks </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-58\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">INTERVAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">timeToStr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">INTERVAL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-65\"><span class=\"crayon-c\">     * 添加定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-66\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-67\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-68\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-69\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"添加成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-75\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-79\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-81\"><span class=\"crayon-c\">     * 编辑定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-82\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-83\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-84\"><span class=\"crayon-c\">     * @param string $task</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-85\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-86\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-87\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-90\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"修改成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-93\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-94\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-97\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-99\"><span class=\"crayon-c\">     * 编辑定时任务状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-100\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-101\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-102\"><span class=\"crayon-c\">     * @param string $status</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-103\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-104\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-105\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-106\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editTaskStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-107\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-108\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-109\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"修改状态成功[\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"]\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-110\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">STATUS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-114\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-115\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-116\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-117\"><span class=\"crayon-c\">     * 获取定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-118\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-119\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-120\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-121\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-122\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-123\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getIndexTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-124\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-125\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-126\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"获取任务成功【\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"】\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-127\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_data\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-130\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-131\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-132\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-133\"><span class=\"crayon-c\">     * 删除定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-134\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-135\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-136\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-137\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-138\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-139\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">removeTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-140\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-141\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-142\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"删除任务【\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"】成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-143\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-144\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">array_splice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-146\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-147\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-148\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-149\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-150\"><span class=\"crayon-c\">     * 执行定时任务</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-151\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-152\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-153\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-154\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-155\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-156\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-157\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-158\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-159\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-160\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-161\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">tasks </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-162\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-163\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-164\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-165\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-166\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-167\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-168\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-169\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-170\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-171\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-172\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-173\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'END'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-174\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-175\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-176\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-177\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-178\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-179\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-180\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-181\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-183\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-184\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-185\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-186\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-187\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">'END'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-188\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-189\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-190\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-191\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-192\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-193\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-194\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-195\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'END'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-196\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-197\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"{$task['ACTION']}\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-198\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-200\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-201\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-202\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-203\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-204\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-205\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-206\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-207\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-208\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-209\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-210\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"{$task['ACTION']}\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-211\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-212\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-213\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-214\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-215\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-216\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-217\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-218\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-219\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-221\"><span class=\"crayon-c\">     * 格式化时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-222\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-223\"><span class=\"crayon-c\">     * @param string $interval</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-224\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-225\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-226\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-227\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timeToStr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-228\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-229\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-230\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-231\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">explode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-232\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNumTemp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-233\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-234\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str_replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"+\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNumTemp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-235\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-236\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iType</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-237\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"year\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-238\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（年）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-239\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-240\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"month\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-241\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（月）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-242\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-243\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"day\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-244\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（日）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-245\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-246\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"hour\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-247\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（小时）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-248\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-249\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"minute\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-250\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（分）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-251\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-252\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"second\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-253\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（秒）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-254\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-255\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">default</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-256\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-257\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-258\"><span class=\"crayon-h\">           </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNum</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-259\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-260\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5db705392496-261\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5db705392496-262\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0289 seconds] -->\r\n<p></p>\n<h3 id=\"h3_12\">定时任务进程入口控制器</h3>\n<p>主要是为了实现异步开启后台进程</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f86af3e5e7964344491\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Controllers;\r\n\r\nuse Crontab\\Common\\Code;\r\nuse Crontab\\Common\\Msg;\r\nuse Crontab\\Controllers\\Base\\BaseController;\r\nuse Crontab\\Library\\Crontab\\AlpacaCrontab;\r\nuse Crontab\\Library\\Crontab\\AlpacaDaemon;\r\nuse Crontab\\Library\\Crontab\\AlpacaWorker;\r\n\r\n/**\r\n * index\r\n * @author Chengcheng\r\n * @date 2017-02-22 15:50:00\r\n */\r\nclass IndexController extends BaseController\r\n{\r\n    /**\r\n     * 设置不需要登录的的Action,不加Action前缀\r\n     * @author Chengcheng\r\n     * @date   2016年10月23日 20:39:25\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    protected function withoutLoginActions()\r\n    {\r\n\r\n    }\r\n\r\n    /**\r\n     * 开始定时任务的守护进程\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function start()\r\n    {\r\n\r\n        //开始守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n\r\n        //在守护进程中注入定时任务\r\n        $events = ['0'=&gt;function(){\r\n            AlpacaWorker::worker()-&gt;action(['REQUEST_URI'=&gt;\"/crontab/index/task\"]);\r\n        }];\r\n        AlpacaDaemon::daemon()-&gt;setEvents($events);\r\n        AlpacaDaemon::daemon()-&gt;start();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 停止定时任务的守护进程\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function stop()\r\n    {\r\n        //停止守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaDaemon::daemon()-&gt;stop();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 执行定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function task()\r\n    {\r\n        //执行定时任务\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaCrontab::crontab()-&gt;doTask();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-599f86af3e5e7964344491-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f86af3e5e7964344491-84\">84</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-2\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-4\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-5\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Code</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-6\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-7\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">BaseController</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-8\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-9\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-10\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-12\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-13\"><span class=\"crayon-c\"> * index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-14\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-15\"><span class=\"crayon-c\"> * @date 2017-02-22 15:50:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-16\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-17\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IndexController</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BaseController</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-20\"><span class=\"crayon-c\">     * 设置不需要登录的的Action,不加Action前缀</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-21\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-22\"><span class=\"crayon-c\">     * @date   2016年10月23日 20:39:25</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-23\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-24\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">withoutLoginActions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-31\"><span class=\"crayon-c\">     * 开始定时任务的守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-32\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-33\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-34\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//开始守护进程</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//在守护进程中注入定时任务</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'0'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"/crontab/index/task\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-48\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-52\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-54\"><span class=\"crayon-c\">     * 停止定时任务的守护进程</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-55\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-56\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-57\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//停止守护进程</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-64\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-68\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-70\"><span class=\"crayon-c\">     * 执行定时任务</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-71\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-72\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-73\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">task</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//执行定时任务</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-78\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">doTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-80\"> </div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-599f86af3e5e7964344491-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f86af3e5e7964344491-84\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0073 seconds] -->\r\n<p>以上是PHP实现定时任务的核心类与方法， 完整的代码请参看代码服务器中提供的源码。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112214\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112214votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112214\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/16", "fav_nums": 2, "tags": "IT技术", "url": "http://blog.jobbole.com/112214/", "front_image_path": "full/d37aff70183dd816975d0900846be5d88def1c7a.jpg", "praise_nums": "2", "title": "PHP实现定时任务（非linux-shell方式，与操作系统无关）", "comment_nums": 2}
{"front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "url_object_id": "1e031f3dac72715c8de661ef03cc6ef1", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.digitalocean.com/community/tutorials/package-management-basics-apt-yum-dnf-pkg\">Brennen Bearnes</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8782-1.html\">Linux中国/Snapcrafter</a>   </div><h3 id=\"toc_1\">介绍</h3>\n<p>大多数现代的类 Unix 操作系统都提供了一种中心化的机制用来搜索和安装软件。软件通常都是存放在存储库中，并通过包的形式进行分发。处理包的工作被称为包管理。包提供了操作系统的基本组件，以及共享的库、应用程序、服务和文档。</p>\n<p>包管理系统除了安装软件外，它还提供了工具来更新已经安装的包。包存储库有助于确保你的系统中使用的代码是经过审查的，并且软件的安装版本已经得到了开发人员和包维护人员的认可。</p>\n<p>在配置服务器或开发环境时，我们最好了解下包在官方存储库之外的情况。某个发行版的稳定版本中的包有可能已经过时了，尤其是那些新的或者快速迭代的软件。然而，包管理无论对于系统管理员还是开发人员来说都是至关重要的技能，而已打包的软件对于主流 Linux 发行版来说也是一笔巨大的财富。</p>\n<p>本指南旨在快速地介绍下在多种 Linux 发行版中查找、安装和升级软件包的基础知识，并帮助您将这些内容在多个系统之间进行交叉对比。</p>\n<h3 id=\"toc_2\">包管理系统：简要概述</h3>\n<p>大多数包系统都是围绕包文件的集合构建的。包文件通常是一个存档文件，它包含已编译的二进制文件和软件的其他资源，以及安装脚本。包文件同时也包含有价值的元数据，包括它们的依赖项，以及安装和运行它们所需的其他包的列表。</p>\n<p>虽然这些包管理系统的功能和优点大致相同，但打包格式和工具却因平台而异：</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>操作系统</th>\n<th>格式</th>\n<th>工具</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian</td>\n<td><code>.deb</code></td>\n<td><code>apt</code>, <code>apt-cache</code>, <code>apt-get</code>, <code>dpkg</code></td>\n</tr>\n<tr>\n<td>Ubuntu</td>\n<td><code>.deb</code></td>\n<td><code>apt</code>, <code>apt-cache</code>, <code>apt-get</code>, <code>dpkg</code></td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>.rpm</code></td>\n<td><code>yum</code></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>.rpm</code></td>\n<td><code>dnf</code></td>\n</tr>\n<tr>\n<td>FreeBSD</td>\n<td>Ports, <code>.txz</code></td>\n<td><code>make</code>, <code>pkg</code></td>\n</tr>\n</tbody>\n</table>\n<p>Debian 及其衍生版，如 Ubuntu、Linux Mint 和 Raspbian，它们的包格式是 <code>.deb</code>。APT 这款先进的包管理工具提供了大多数常见的操作命令：搜索存储库、安装软件包及其依赖项，并管理升级。在本地系统中，我们还可以使用 <code>dpkg</code> 程序来安装单个的 <code>deb</code> 文件，APT 命令作为底层 <code>dpkg</code> 的前端，有时也会直接调用它。</p>\n<p>最近发布的 debian 衍生版大多数都包含了 <code>apt</code> 命令，它提供了一个简洁统一的接口，可用于通常由 <code>apt-get</code> 和 <code>apt-cache</code> 命令处理的常见操作。这个命令是可选的，但使用它可以简化一些任务。</p>\n<p>CentOS、Fedora 和其它 Red Hat 家族成员使用 RPM 文件。在 CentOS 中，通过 <code>yum</code> 来与单独的包文件和存储库进行交互。</p>\n<p>在最近的 Fedora 版本中，<code>yum</code> 已经被 <code>dnf</code> 取代，<code>dnf</code> 是它的一个现代化的分支，它保留了大部分 <code>yum</code> 的接口。</p>\n<p>FreeBSD 的二进制包系统由 <code>pkg</code> 命令管理。FreeBSD 还提供了 <code>Ports</code> 集合，这是一个存在于本地的目录结构和工具，它允许用户获取源码后使用 Makefile 直接从源码编译和安装包。</p>\n<h3 id=\"toc_3\">更新包列表</h3>\n<p>大多数系统在本地都会有一个和远程存储库对应的包数据库，在安装或升级包之前最好更新一下这个数据库。另外，<code>yum</code> 和 <code>dnf</code> 在执行一些操作之前也会自动检查更新。当然你可以在任何时候对系统进行更新。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get update</code></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt update</code></td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>yum check-update</code></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>dnf check-update</code></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg update</code></td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>sudo portsnap fetch update</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_4\">更新已安装的包</h3>\n<p>在没有包系统的情况下，想确保机器上所有已安装的软件都保持在最新的状态是一个很艰巨的任务。你将不得不跟踪数百个不同包的上游更改和安全警报。虽然包管理器并不能解决升级软件时遇到的所有问题，但它确实使你能够使用一些命令来维护大多数系统组件。</p>\n<p>在 FreeBSD 上，升级已安装的 ports 可能会引入破坏性的改变，有些步骤还需要进行手动配置，所以在通过 <code>portmaster</code> 更新之前最好阅读下 <code>/usr/ports/UPDATING</code> 的内容。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get upgrade</code></td>\n<td>只更新已安装的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get dist-upgrade</code></td>\n<td>可能会增加或删除包以满足新的依赖项</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt upgrade</code></td>\n<td>和 <code>apt-get upgrade</code> 类似</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt full-upgrade</code></td>\n<td>和 <code>apt-get dist-upgrade</code> 类似</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum update</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf upgrade</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg upgrade</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>less /usr/ports/UPDATING</code></td>\n<td>使用 <code>less</code> 来查看 ports 的更新提示（使用上下光标键滚动，按 q 退出）。</td>\n</tr>\n<tr>\n<td></td>\n<td><code>cd /usr/ports/ports-mgmt/portmaster &amp;&amp; sudo make install &amp;&amp; sudo portmaster -a</code></td>\n<td>安装 <code>portmaster</code> 然后使用它更新已安装的 ports</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_5\">搜索某个包</h3>\n<p>大多数发行版都提供针对包集合的图形化或菜单驱动的工具，我们可以分类浏览软件，这也是一个发现新软件的好方法。然而，查找包最快和最有效的方法是使用命令行工具进行搜索。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>apt-cache search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>apt search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>yum search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>yum search all search_string</code></td>\n<td>搜索所有的字段，包括描述</td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>dnf search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>dnf search all search_string</code></td>\n<td>搜索所有的字段，包括描述</td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>pkg search search_string</code></td>\n<td>通过名字进行搜索</td>\n</tr>\n<tr>\n<td></td>\n<td><code>pkg search -f search_string</code></td>\n<td>通过名字进行搜索并返回完整的描述</td>\n</tr>\n<tr>\n<td></td>\n<td><code>pkg search -D search_string</code></td>\n<td>搜索描述</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>cd /usr/ports &amp;&amp; make search name=package</code></td>\n<td>通过名字进行搜索</td>\n</tr>\n<tr>\n<td></td>\n<td><code>cd /usr/ports &amp;&amp; make search key=search_string</code></td>\n<td>搜索评论、描述和依赖</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_6\">查看某个软件包的信息</h3>\n<p>在安装软件包之前，我们可以通过仔细阅读包的描述来获得很多有用的信息。除了人类可读的文本之外，这些内容通常包括像版本号这样的元数据和包的依赖项列表。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>apt-cache show package</code></td>\n<td>显示有关包的本地缓存信息</td>\n</tr>\n<tr>\n<td></td>\n<td><code>apt show package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>dpkg -s package</code></td>\n<td>显示包的当前安装状态</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>yum info package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>yum deplist package</code></td>\n<td>列出包的依赖</td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>dnf info package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>dnf repoquery --requires package</code></td>\n<td>列出包的依赖</td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>pkg info package</code></td>\n<td>显示已安装的包的信息</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>cd /usr/ports/category/port &amp;&amp; cat pkg-descr</code></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_7\">从存储库安装包</h3>\n<p>知道包名后，通常可以用一个命令来安装它及其依赖。你也可以一次性安装多个包，只需将它们全部列出来即可。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get install -y package</code></td>\n<td>在 <code>apt</code> 提示是否继续的地方直接默认 <code>yes</code></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt install package</code></td>\n<td>显示一个彩色的进度条</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo yum install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo yum install -y package</code></td>\n<td>在 <code>yum</code> 提示是否继续的地方直接默认 <code>yes</code></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo dnf install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo dnf install -y package</code></td>\n<td>在 <code>dnf</code> 提示是否继续的地方直接默认 <code>yes</code></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo pkg install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>cd /usr/ports/category/port &amp;&amp; sudo make install</code></td>\n<td>从源码构建安装一个 port</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_8\">从本地文件系统安装一个包</h3>\n<p>对于一个给定的操作系统，有时有些软件官方并没有提供相应的包，那么开发人员或供应商将需要提供包文件的下载。你通常可以通过 web 浏览器检索这些包，或者通过命令行 <code>curl</code> 来检索这些信息。将包下载到目标系统后，我们通常可以通过单个命令来安装它。</p>\n<p>在 Debian 派生的系统上，<code>dpkg</code> 用来处理单个的包文件。如果一个包有未满足的依赖项，那么我们可以使用 <code>gdebi</code> 从官方存储库中检索它们。</p>\n<p>在 CentOS 和 Fedora 系统上，<code>yum</code> 和 <code>dnf</code> 用于安装单个的文件，并且会处理需要的依赖。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo dpkg -i package.deb</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get install -y gdebi &amp;&amp; sudo gdebi package.deb</code></td>\n<td>安装 <code>gdebi</code>，然后使用 <code>gdebi</code> 安装 <code>package.deb</code> 并处理缺失的依赖</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum install package.rpm</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf install package.rpm</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg add package.txz</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo pkg add -f package.txz</code></td>\n<td>即使已经安装的包也会重新安装</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_9\">删除一个或多个已安装的包</h3>\n<p>由于包管理器知道给定的软件包提供了哪些文件，因此如果某个软件不再需要了，它通常可以干净利落地从系统中清除这些文件。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get remove package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt remove package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get autoremove</code></td>\n<td>删除不需要的包</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum remove package</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf erase package</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg delete package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo pkg autoremove</code></td>\n<td>删除不需要的包</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>sudo pkg delete package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>cd /usr/ports/path_to_port &amp;&amp; make deinstall</code></td>\n<td>卸载 port</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_10\"><code>apt</code> 命令</h3>\n<p>Debian 家族发行版的管理员通常熟悉 <code>apt-get</code> 和 <code>apt-cache</code>。较少为人所知的是简化的 <code>apt</code> 接口，它是专为交互式使用而设计的。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>传统命令</th>\n<th>等价的 <code>apt</code> 命令</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>apt-get update</code></td>\n<td><code>apt update</code></td>\n</tr>\n<tr>\n<td><code>apt-get dist-upgrade</code></td>\n<td><code>apt full-upgrade</code></td>\n</tr>\n<tr>\n<td><code>apt-cache search string</code></td>\n<td><code>apt search string</code></td>\n</tr>\n<tr>\n<td><code>apt-get install package</code></td>\n<td><code>apt install package</code></td>\n</tr>\n<tr>\n<td><code>apt-get remove package</code></td>\n<td><code>apt remove package</code></td>\n</tr>\n<tr>\n<td><code>apt-get purge package</code></td>\n<td><code>apt purge package</code></td>\n</tr>\n</tbody>\n</table>\n<p>虽然 <code>apt</code> 通常是一个特定操作的快捷方式，但它并不能完全替代传统的工具，它的接口可能会随着版本的不同而发生变化，以提高可用性。如果你在脚本或 shell 管道中使用包管理命令，那么最好还是坚持使用 <code>apt-get</code> 和 <code>apt-cache</code>。</p>\n<h3 id=\"toc_11\">获取帮助</h3>\n<p>除了基于 web 的文档，请记住我们可以通过 shell 从 Unix 手册页（通常称为 man 页面）中获得大多数的命令。比如要阅读某页，可以使用 <code>man</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-599f41f33591d920467987\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman page\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-599f41f33591d920467987-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-599f41f33591d920467987-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-599f41f33591d920467987-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-i\">page</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-599f41f33591d920467987-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在 <code>man</code> 中，你可以用箭头键导航。按 <code>/</code> 搜索页面内的文本，使用 <code>q</code> 退出。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>man apt-get</code></td>\n<td>更新本地包数据库以及与包一起工作</td>\n</tr>\n<tr>\n<td></td>\n<td><code>man apt-cache</code></td>\n<td>在本地的包数据库中搜索</td>\n</tr>\n<tr>\n<td></td>\n<td><code>man dpkg</code></td>\n<td>和单独的包文件一起工作以及能查询已安装的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>man apt</code></td>\n<td>通过更简洁，用户友好的接口进行最基本的操作</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>man yum</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>man dnf</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>man pkg</code></td>\n<td>和预先编译的二进制包一起工作</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>man ports</code></td>\n<td>和 Ports 集合一起工作</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_12\">结论和进一步的阅读</h3>\n<p>本指南通过对多个系统间进行交叉对比概述了一下包管理系统的基本操作，但只涉及了这个复杂主题的表面。对于特定系统更详细的信息，可以参考以下资源：</p>\n<ul>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/ubuntu-and-debian-package-management-essentials\">这份指南</a> 详细介绍了 Ubuntu 和 Debian 的软件包管理。</li>\n<li>这里有一份 CentOS 官方的指南 <a href=\"https://www.centos.org/docs/5/html/yum/\">使用 yum 管理软件</a></li>\n<li>这里有一个有关 Fedora 的 <code>dnf</code> 的 <a href=\"https://fedoraproject.org/wiki/Dnf\">wifi 页面</a> 以及一份有关 <code>dnf</code> <a href=\"https://dnf.readthedocs.org/en/latest/index.html\">官方的手册</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-manage-packages-on-freebsd-10-1-with-pkg\">这份指南</a> 讲述了如何使用 <code>pkg</code> 在 FreeBSD 上进行包管理</li>\n<li>这本 <a href=\"https://www.freebsd.org/doc/handbook/\">FreeBSD Handbook</a> 有一节讲述了<a href=\"https://www.freebsd.org/doc/handbook/ports-using.html\">如何使用 Ports 集合</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112219\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112219votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112219\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017/08/20", "fav_nums": 9, "tags": "IT技术,Linux", "url": "http://blog.jobbole.com/112219/", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg", "praise_nums": "1", "title": "Linux 包管理基础：apt、yum、dnf 和 pkg", "comment_nums": 9}
